(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0ca15c9e"],{"009c":function(t,e,i){"use strict";i("a80d")},"043d":function(t,e,i){},"06ff":function(t,e,i){"use strict";i("1949")},"0fd4":function(t,e,i){i("f2b5")(i("48dd"))},1:function(t,e){},"18d8":function(t,e,i){"use strict";i("043d")},1949:function(t,e,i){},2:function(t,e){},2202:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uploadFileBox"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.templateDownLoad(t.downloadData)}}},[t._v(t._s(t.downloadData.length>0?"导出":"全部导出"))])],1)},a=[],s=i("c7eb"),o=(i("6b54"),i("96cf"),i("1da1")),n=i("cd77"),l=i("18e3"),h={name:"ExcelExport",props:{downloadData:{type:Array,default:function(){return[]}},djxEditArr:{type:Array,default:function(){return[]}},djxEditArrAll:{type:Array,default:function(){return[]}}},created:function(){this.getList()},methods:{getList:function(){this.downloadData=this.djxEditArr},templateDownLoad:function(){var t=Object(o["a"])(Object(s["a"])().mark((function t(e){var i,r,a,o,h,p,d;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=[],r="电缆段批量编辑设备"+this.getCurrTime(),a=[],!(e.length>0)){t.next=8;break}return t.next=5,Object(l["r"])(JSON.stringify(e));case 5:a=t.sent,t.next=11;break;case 8:return t.next=10,Object(l["r"])(JSON.stringify(this.djxEditArrAll));case 10:a=t.sent;case 11:for(o=0;o<a.data.length;o++)"LineString"==a.data[o].layerType?(a.data[o].ddzb,a.data[o].ddzb=ddcoord):"Polygon"==a.data[o].layerType&&(h=a.data[o].ddzb[0],p=h.join(","),a.data[o].ddzb=p);i=a.data.map((function(t){return{"资源ID":t.zyId,"设备类型":t.psrTypeName,"设备名称":t.mc,"只支持大地2000坐标(x,y;x,y;x,y)":t.ddzb.toString(),"电缆段起点资源ID":t.dldFristPsrId,"电缆段起点设备名称_类型":t.dldFristNameAndType,"电缆段终点资源ID":t.dldEndPsrId,"电缆段终点设备名称_类型":t.dldEndNameAndType}})),d=[{wpx:120},{wpx:140},{wpx:180},{wpx:260},{wpx:260},{wpx:260},{wpx:260},{wpx:260}],n["a"].exportExcel(i,r,d),this.$emit("downloadExcel",r);case 16:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleXzData:function(){var t=Object(o["a"])(Object(s["a"])().mark((function t(e){var i,r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["r"])(JSON.stringify(e));case 2:i=t.sent,r=[],r=i.data.map((function(t){return{"资源ID":t.zyId,"设备类型":t.psrTypeName,"设备名称":t.mc,"经纬度(x,y),只支持大地2000坐标":t.ddzb.toString(),"电缆段起点资源ID":"","电缆段起点设备名称_类型":"","电缆段终点资源ID":"","电缆段终点设备名称_类型":""}})),console.log("mbData",r);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getCurrTime:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),a=t.getHours(),s=t.getMinutes(),o=t.getSeconds();return e+""+i+r+a+s+o}}},p=h,d=(i("3740"),i("2877")),c=Object(d["a"])(p,r,a,!1,null,"b11e20ea",null);e["a"]=c.exports},"22e9":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"app_wrapper"},[t._m(0),t.tableShow?i("saveTable",{ref:"saveTable",attrs:{isSave:t.isSave,childTableData:t.childTableData},on:{dialogTxfbQrBtn:t.dialogTxfbQrBtn,tableClose:t.tableClose}}):t._e(),[i("left-panel",{ref:"leftPanel",attrs:{ltBoxLtVal:t.ltBoxLtVal,leftTreeData:t.leftTreeData,filterText:t.filterText},on:{handleNodeClick:t.handleNodeClick,toggleLeftSideBar:t.toggleLeftSideBar}})],i("div",{staticClass:"main_container",style:{marginLeft:t.marginLeftV+"px",marginRight:t.marginRightV+"px"}},[i("div",{staticClass:"mapTop"},[i("div",{staticClass:"mapTop_lt"},[i("span",[t._v("所属设备："+t._s(t.tqName))])]),i("div",{staticClass:"mapTop_rt"},[i("div",{staticClass:"searchBox"},[i("el-popover",{attrs:{placement:"bottom",value:1==t.topMenuIndexVal,trigger:"manual",width:"200"}},[i("div",{staticClass:"searchResultBox"},[0===t.searchResult.length?i("div",[t._v("暂无数据")]):t._l(t.searchResult,(function(e,r){return i("div",{key:r,staticClass:"searchItem",on:{click:function(i){return t.searchLocation(e)}}},[i("i",{staticClass:"el-icon-location-outline"}),i("span",{staticClass:"searchType"},[t._v(t._s(e.properties.psrName)+" - ")]),i("span",{staticClass:"searchName"},[t._v(t._s(e.properties.name))])])}))],2),i("div",{attrs:{slot:"reference"},slot:"reference"},[i("el-input",{staticClass:"smallHeightInput",attrs:{type:"text",placeholder:"输入资源ID,oid或设备名称搜索",clearable:""},on:{focus:function(e){""===t.searchKey?t.topMenuIndexVal=0:t.topMenuIndexVal=1},blur:function(e){t.topMenuIndexVal=0},input:t.searchAsync},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},slot:"suffix"})])],1)])],1),i("div",{staticClass:"tuCengBox"},[i("el-popover",{attrs:{placement:"bottom",value:2==t.topMenuIndexVal,trigger:"manual"}},[i("el-tree",{ref:"tucengTree",staticClass:"topTucengTree",attrs:{data:t.tucengData,props:t.defaultProps,"check-on-click-node":!0,"show-checkbox":"","node-key":"id","default-checked-keys":t.defaultCheckedKeys,"default-expand-all":!0},on:{check:t.handleCheckChange}}),i("div",{attrs:{slot:"reference"},on:{click:t.tucengChangeFn},slot:"reference"},[i("svg-icon",{attrs:{"icon-class":"tuceng"}}),i("span",{staticClass:"menuTxt"},[t._v("图层控制")]),i("i",{staticClass:"menuArrowIcon",class:2==t.topMenuIndexVal?"el-icon-arrow-up":"el-icon-arrow-down"})],1)],1)],1),[i("screen-full")]],2)]),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.mapLoading,expression:"mapLoading"}],staticClass:"map",attrs:{id:"map","element-loading-background":"rgba(255, 255, 255, 0.3)"}}),t.layerTipsShow?i("div",{staticClass:"loadLayerTips"},[i("i",{staticClass:"el-icon-loading"}),i("span",[t._v("正在加载电网图层中···")])]):t._e(),t.jhxAutoRoutingTipsShow?i("div",{staticClass:"loadLayerTips"},[i("i",{staticClass:"el-icon-loading"}),i("span",[t._v("台区入户线布局中···")])]):t._e(),i("div",{staticClass:"mapTools2"},[i("div",{staticClass:"mapTools-item"},[i("div",{staticClass:"mapTools-item-icon",class:1==t.toolsIndex?"choosedLi":""},[i("svg-icon",{attrs:{"icon-class":"kuangxuan"}}),i("span",[t._v("框选")])],1),i("div",{staticClass:"xialalist kuangxuanBox"},[i("div",{staticClass:"kuangxuanBox-con"},[i("p",{class:1==t.toolsIndex&&"jx"==t.kxType?"choosedLi":"",on:{click:function(e){return t.boxSelect(1)}}},[i("svg-icon",{attrs:{"icon-class":"juxing",title:"矩形框选"}})],1),i("p",{class:1==t.toolsIndex&&"yx"==t.kxType?"choosedLi":"",on:{click:t.circularSelect}},[i("svg-icon",{attrs:{"icon-class":"yuanxing",title:"圆形框选"}})],1)])])]),i("div",{staticClass:"mapTools-item"},[i("div",{staticClass:"mapTools-item-icon",class:1!==t.toolsIndex&&0!==t.toolsIndex?"choosedLi":""},[i("svg-icon",{attrs:{"icon-class":"gongjuxiang"}}),i("span",[t._v("工具箱")])],1),i("div",{staticClass:"xialalist gjxList"},[i("div",{staticClass:"gjxListCon"},[t.isYxyh?t._e():i("div",{staticClass:"gjxList-item"},[i("ul",[i("li",{class:t.plEditVisible?"toolsOnlyRead":2==t.toolsIndex?"choosedLi":"",attrs:{title:"左对齐"},on:{click:t.leftAlignFn}},[i("svg-icon",{attrs:{"icon-class":"zuoduiqi"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":3==t.toolsIndex?"choosedLi":"",attrs:{title:"右对齐"},on:{click:t.rightAlignFn}},[i("svg-icon",{attrs:{"icon-class":"youduiqi"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":4==t.toolsIndex?"choosedLi":"",attrs:{title:"顶端对齐"},on:{click:t.topAlignFn}},[i("svg-icon",{attrs:{"icon-class":"dingduiqi"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":5==t.toolsIndex?"choosedLi":"",attrs:{title:"底部对齐"},on:{click:t.bottomAlignFn}},[i("svg-icon",{attrs:{"icon-class":"diduiqi"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":6==t.toolsIndex?"choosedLi":"",attrs:{title:"横向分布"},on:{click:t.traverseFn}},[i("svg-icon",{attrs:{"icon-class":"hengxiang"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":7==t.toolsIndex?"choosedLi":"",attrs:{title:"纵向分布"},on:{click:t.verticalFbFn}},[i("svg-icon",{attrs:{"icon-class":"zongxiang"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":8==t.toolsIndex?"choosedLi":"",attrs:{title:"自动布局"},on:{click:t.autoLayoutFn}},[i("svg-icon",{attrs:{"icon-class":"zdbj"}})],1)])]),i("div",{staticClass:"gjxList-item"},[i("ul",[t.isYxyh?t._e():i("li",{class:14==t.toolsIndex?"choosedLi":"",attrs:{title:"对侧飞线校验"},on:{click:t.checkDcfx}},[i("svg-icon",{attrs:{"icon-class":"jydcfx"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":9==t.toolsIndex?"choosedLi":"",attrs:{title:"飞点飞线召回"},on:{click:t.toOpenSetLineSizeDialog}},[i("svg-icon",{attrs:{"icon-class":"fensan"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":10==t.toolsIndex?"choosedLi":"",attrs:{title:"计量尺测量"},on:{click:t.drawLines}},[i("svg-icon",{attrs:{"icon-class":"jlccl"}})],1),i("li",{class:t.plEditVisible?"toolsOnlyRead":11==t.toolsIndex?"choosedLi":"",attrs:{title:"面积测量"},on:{click:t.polygonSelect}},[i("svg-icon",{attrs:{"icon-class":"mjjs"}})],1),t.isYxyh?t._e():i("li",{class:t.plEditVisible?"toolsOnlyRead":12==t.toolsIndex?"choosedLi":"",attrs:{title:"档距段拉直"},on:{click:t.lineToStraighten}},[i("svg-icon",{attrs:{"icon-class":"xllz"}})],1),t.isYxyh?t._e():i("li",{class:t.plEditVisible?"toolsOnlyRead":15==t.toolsIndex?"choosedLi":"",attrs:{title:"电缆拐点导入"},on:{click:t.inflectionPointImport}},[i("svg-icon",{attrs:{"icon-class":"dlgddr"}})],1),t.isYxyh?t._e():i("li",{class:13==t.toolsIndex?"choosedLi":"",attrs:{title:"批量设备编辑"},on:{click:t.batchToEdit}},[i("svg-icon",{attrs:{"icon-class":"plbj"}})],1)])])])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isSGYXrecognize&&!t.isYxyh&&t.bounds&&t.isJSVersion,expression:"isSGYXrecognize && !isYxyh && bounds && isJSVersion"}],staticClass:"mapTools-item"},[i("div",{staticClass:"mapTools-item-icon",on:{click:function(e){return t.ycsbDistinguish(20)}}},[i("svg-icon",{attrs:{"icon-class":"sjyxsb"}}),i("span",[t._v("AI影像识别")])],1)])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.plEditVisible,expression:"!plEditVisible"}],staticClass:"mapEditBtns"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isDragEditBx,expression:"isDragEditBx"}],staticClass:"margin-rt-10",attrs:{type:"warning"},on:{click:t.resetDragBx}},[t._v("撤销")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isDragEditBx,expression:"isDragEditBx"}],attrs:{type:"primary"},on:{click:t.updateDragBx}},[t._v("确认")])],1),i("MapStyle",{ref:"mapStyleRef",on:{changeMapStyle:t.changeMapStyle}}),[i("batch-edit-page",{ref:"BatchEditPage",attrs:{editVisible:t.plEditVisible,plEditArr:t.plEditArr},on:{kxMultiplePsr:function(e){return t.boxSelect(13)},plEditConfirm:t.sbplEditConfirm,plEditCancel:t.sbplEditCancel,uploadFileByExcel:t.uploadFileByExcel}})],[t.ycsbDistinguishVisible?i("ycsb-distinguish",{ref:"YcsbDistinguish",attrs:{sgYxsbArr:t.sgYxsbArr,lineType:t.lineType,bounds:t.bounds,ycsbToolsType:t.ycsbToolsType,ycsbDistinguishVisible:t.ycsbDistinguishVisible},on:{jlxLocate:t.jlxLocate,jlxPullBack:t.jlxPullBack,aiDistinguishLocation:t.aiDistinguishLocation,ycsbDistinguishCancel:t.ycsbDistinguishCancel}}):t._e()]],2),[i("ul",{directives:[{name:"show",rawName:"v-show",value:t.jlxLocationInfoVisible,expression:"jlxLocationInfoVisible"}],staticClass:"jlx-location-info",attrs:{id:"jlxLocationInfo"}},[i("div",{},[t._v("省:"+t._s(t.jlxRecallAddress.addressComponent.province))]),i("div",{},[t._v("市:"+t._s(t.jlxRecallAddress.addressComponent.city))]),i("div",{},[t._v("区:"+t._s(t.jlxRecallAddress.addressComponent.district))]),i("div",{},[t._v(" 行政编码:"+t._s(t.jlxRecallAddress.addressComponent.acode)+" ")]),i("div",{},[t._v(" 思极定位详细地址:"+t._s(t.jlxRecallAddress.formattedAddress)+" ")])])],[i("ul",{directives:[{name:"show",rawName:"v-show",value:t.rightMenuVisible,expression:"rightMenuVisible"}],staticClass:"right-menu",attrs:{id:"rightMenu"}},[i("li",{directives:[{name:"show",rawName:"v-show",value:"lightBigDian"==t.rightMenuType,expression:"rightMenuType == 'lightBigDian' ? true : false"}],on:{click:t.deleteThisDian}},[t._v(" 删除 ")]),i("li",{directives:[{name:"show",rawName:"v-show",value:"lightshiLine"==t.rightMenuType||"lightxuLine"==t.rightMenuType||"lightdianLine"==t.rightMenuType||"lightdaoLine"==t.rightMenuType,expression:"\n            rightMenuType == 'lightshiLine' ||\n            rightMenuType == 'lightxuLine' ||\n            rightMenuType == 'lightdianLine' ||\n            rightMenuType == 'lightdaoLine'\n              ? true\n              : false\n          "}],on:{click:t.setZLine}},[t._v(" 设置成直线 ")]),i("li",{directives:[{name:"show",rawName:"v-show",value:"lightshiLine"==t.rightMenuType||"lightxuLine"==t.rightMenuType||"lightdianLine"==t.rightMenuType||"lightdaoLine"==t.rightMenuType,expression:"\n            rightMenuType == 'lightshiLine' ||\n            rightMenuType == 'lightxuLine' ||\n            rightMenuType == 'lightdianLine' ||\n            rightMenuType == 'lightdaoLine'\n              ? true\n              : false\n          "}],on:{click:t.recallPsrFn}},[t._v(" 召回设备 ")]),i("li",{directives:[{name:"show",rawName:"v-show",value:"stationLayer"==t.rightMenuType,expression:"rightMenuType == 'stationLayer'"}],on:{click:t.showStationPsrFn}},[t._v(" 显示站内设备 ")]),i("li",{directives:[{name:"show",rawName:"v-show",value:"jhxAutoRoutingLayer"==t.rightMenuType,expression:"rightMenuType == 'jhxAutoRoutingLayer'"}],on:{click:function(e){return t.jhxAutoRouting(2)}}},[t._v(" 入户线布局 ")]),i("li",{directives:[{name:"show",rawName:"v-show",value:"jhxAutoRoutingLayer"==t.rightMenuType,expression:"rightMenuType == 'jhxAutoRoutingLayer'"}],on:{click:function(e){return t.jhxAutoRouting(4)}}},[t._v(" 取消入户拐点 ")])])],[i("right-panel",{attrs:{isRead:t.isRead,isCome:t.isCome,rtBoxRtVal:t.rtBoxRtVal,rtBoxCanEdit:t.rtBoxCanEdit,rightBxForm:t.rightBxInf},on:{downloadFileInfo:t.downloadFileInfo,bxAngleReset:t.bxAngleReset,editThisPsr:t.editThisPsr,updateThisPsr:t.updateThisPsr,changeCurrZbType:t.changeThisZbType,gisSave:t.gisSave,uploadFile:t.uploadFileGeoJSON,toggleRightSideBar:t.toggleRightSideBar}})],[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"飞点飞线召回",visible:t.dialogSetLineSizeVisible,"close-on-click-modal":!1,width:"35%",top:"30vh"},on:{"update:visible":function(e){t.dialogSetLineSizeVisible=e},close:t.dialogCancelFdfxzh}},[i("el-form",{ref:"form",staticStyle:{padding:"10px"},attrs:{model:t.lineForm,"label-width":"210px"}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:20}},["03"==t.type?i("el-form-item",{attrs:{label:"选择上游",prop:"syPsrId"}},[i("el-button",{attrs:{type:"primary"},on:{click:t.toChooseGysyd}},[t._v("选择")]),""!==t.lineForm.syPsrId?i("span",{staticClass:"margin-l-10"},[t._v("资产ID："+t._s(t.lineForm.syPsrId))]):t._e()],1):t._e(),"03"==t.type?i("el-form-item",{attrs:{label:"飞点飞线长度（米）",prop:"zdcd"}},[i("el-input",{staticClass:"filter-item",attrs:{type:"number",placeholder:"请输入线段最短长度",clearable:""},model:{value:t.lineForm.zdcd,callback:function(e){t.$set(t.lineForm,"zdcd",e)},expression:"lineForm.zdcd"}})],1):t._e(),"03"!==t.type?i("el-form-item",{attrs:{label:"电缆段（米）",prop:"zdcdOfdl"}},[i("el-input",{staticClass:"filter-item",attrs:{type:"number",disabled:t.isDisabled1,placeholder:"请输入线段最短长度",clearable:""},model:{value:t.lineForm.zdcdOfdl,callback:function(e){t.$set(t.lineForm,"zdcdOfdl",e)},expression:"lineForm.zdcdOfdl"}})],1):t._e(),"03"!==t.type?i("el-form-item",{attrs:{label:"超连接线（米）",prop:"zdcdOfcljx"}},[i("el-input",{staticClass:"filter-item",attrs:{type:"number",disabled:t.isDisabled1,placeholder:"请输入线段最短长度",clearable:""},model:{value:t.lineForm.zdcdOfcljx,callback:function(e){t.$set(t.lineForm,"zdcdOfcljx",e)},expression:"lineForm.zdcdOfcljx"}})],1):t._e(),"03"!==t.type?i("el-form-item",{attrs:{label:"档距段（米）",prop:"zdcdOfdjd"}},[i("el-input",{staticClass:"filter-item",attrs:{type:"number",disabled:t.isDisabled1,placeholder:"请输入线段最短长度",clearable:""},model:{value:t.lineForm.zdcdOfdjd,callback:function(e){t.$set(t.lineForm,"zdcdOfdjd",e)},expression:"lineForm.zdcdOfdjd"}})],1):t._e(),"03"!==t.type?i("el-form-item",{attrs:{label:"其他线（米）",prop:"zdcd"}},[i("el-input",{staticClass:"filter-item",attrs:{type:"number",disabled:t.isDisabled1,placeholder:"请输入线段最短长度",clearable:""},model:{value:t.lineForm.zdcd,callback:function(e){t.$set(t.lineForm,"zdcd",e)},expression:"lineForm.zdcd"}})],1):t._e(),i("el-form-item",{attrs:{label:"计量箱环状召回"}},[i("el-select",{model:{value:t.selectedValue,callback:function(e){t.selectedValue=e},expression:"selectedValue"}},t._l(t.options,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t}})})),1)],1)],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-right":"10px"},on:{click:t.dialogCancelFdfxzh}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.dialogToQueryLines}},[t._v("检测")])],1)],1)],[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"图形发布",visible:t.dialogTxfbVisible,"close-on-click-modal":!1,width:"15%",top:"30vh"},on:{"update:visible":function(e){t.dialogTxfbVisible=e}}},[i("div",{staticClass:"save-warning"},[i("el-row",[t._v("是否确认修改完成,图形发布数据！")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-right":"10px"},on:{click:function(){t.dialogTxfbVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary",disabled:t.isDisabled},on:{click:t.dialogTxfbQrBtn}},[t._v("确认发布")])],1)])],[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.modalTitle,visible:t.jlxPullVisible,"close-on-click-modal":!1,width:"15%",top:"30vh"},on:{"update:visible":function(e){t.jlxPullVisible=e}}},[i("div",{staticClass:"save-warning"},[i("el-row",[t._v("是否确认召回")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-right":"10px"},on:{click:function(){t.jlxPullVisible=!1,t.resetDragBx()}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary",disabled:t.isDisabled},on:{click:t.jlxPull}},[t._v("确认召回")])],1)])],[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"台区入户线分布",visible:t.jhxAutoRoutingVisible,"close-on-click-modal":!1,width:"15%",top:"30vh"},on:{"update:visible":function(e){t.jhxAutoRoutingVisible=e}}},[i("div",{staticClass:"save-warning"},[i("el-row",[t._v("进户线自动分布，请选择操作！")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("div",[i("el-button",{staticStyle:{"margin-right":"35px"},attrs:{type:"primary"},on:{click:function(e){return t.jhxAutoRouting(1)}}},[t._v("预 览")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.jhxAutoRouting(0)}}},[t._v("确 认")])],1),i("div",[i("el-button",{staticStyle:{"margin-right":"10px","margin-top":"5px"},on:{click:t.jhxAutoRoutingCancel}},[t._v("撤销展示")]),i("el-button",{attrs:{type:"warning"},on:{click:function(e){return t.openJhxRoutingCancel()}}},[t._v("取消分布")])],1)])])],[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"取消入户线拐点",visible:t.jhxRoutingCancelVisible,"close-on-click-modal":!1,width:"15%",top:"30vh"},on:{"update:visible":function(e){t.jhxRoutingCancelVisible=e}}},[i("div",{staticClass:"save-warning"},[i("el-row",[t._v("是否取消掉所有入户线的拐点和当前的预览线路，请选择操作！")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-right":"10px"},on:{click:function(e){return t.closeJhxRoutingCancel()}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.jhxAutoRouting(3)}}},[t._v("确 认")])],1)])],[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"线路拉直",visible:t.dialogLazhiLineVisible,"close-on-click-modal":!1,"show-close":!1,width:"20%",top:"30vh"},on:{"update:visible":function(e){t.dialogLazhiLineVisible=e}}},[i("el-form",{ref:"form",staticStyle:{padding:"10px"},attrs:{model:t.lazhiForm,"label-width":"60px"}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"起点",prop:"startPsrId"}},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.toChooseLazhiPsr("start")}}},[t._v("选择")]),""!==t.lazhiForm.startPsrId?i("span",{staticClass:"margin-l-10"},[t._v("资产ID："+t._s(t.lazhiForm.startPsrId))]):t._e()],1),i("el-form-item",{attrs:{label:"终点",prop:"endPsrId"}},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.toChooseLazhiPsr("end")}}},[t._v("选择")]),""!==t.lazhiForm.endPsrId?i("span",{staticClass:"margin-l-10"},[t._v("资产ID："+t._s(t.lazhiForm.endPsrId))]):t._e()],1)],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-right":"10px"},on:{click:t.dialogCancelLazhiLine}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.dialogToLazhiLines}},[t._v("确定")])],1)],1)],[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"电缆段拐点导入",visible:t.inflectionPointImportVisible,"close-on-click-modal":!1,"show-close":!1,width:"35%",top:"30vh"},on:{"update:visible":function(e){t.inflectionPointImportVisible=e}}},[i("el-form",{ref:"form",staticStyle:{padding:"10px"},attrs:{model:t.inflectionPointForm,"label-width":"60px"}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"电缆段",prop:"inflectionPointId"}},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.toChooseinflectionPointPsr("inflectionPoint")}}},[t._v("选择 ")]),""!==t.inflectionPointForm.inflectionPointId?i("span",{staticClass:"margin-l-10"},[t._v("设备ID："+t._s(t.inflectionPointForm.inflectionPointId))]):t._e()],1)],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-right":"10px"},on:{click:t.inflectionPointCancelExport}},[t._v("取 消")]),[i("span-line-export",{ref:"SpanLineExport",staticClass:"margin-l-10",attrs:{djxEditArr:t.djxEditArr,djxEditArrAll:t.djxEditArrAll},on:{downloadExcel:t.downloadExcel}}),i("span-line-import",{attrs:{uploadData:t.djxEditArr,isBtnDisabled:t.isDrBtnDisabled},on:{uploadInflectionPointByExcel:t.uploadInflectionPointByExcel}})]],2)],1)]],2)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"watermarker"},[i("span",[t._v("Copyright © 2024 Nari. All Rights Reserved")])])}],s=(i("20d6"),i("2909")),o=(i("c5f6"),i("6762"),i("2fdb"),i("7f7f"),i("6b54"),i("a481"),i("ac6a"),i("456d"),i("c7eb")),n=(i("96cf"),i("1da1")),l=(i("7514"),i("53ca")),h=(i("28a5"),i("cd77")),p=i("276f"),d=i("6c31"),c=i("874b"),g=i("9fd2"),y=i("29d5"),f=i("e886"),u=i("f773"),m=i("ca3d"),D=i("2202"),b=i("c0de"),x=i("9e28"),v=i("5831"),L=i("a2e1c"),I=i("18e3"),P=i("ed08");i("0fd4");var F={name:"Home",components:{saveTable:m["a"],rightPanel:d["a"],LeftPanel:c["a"],ScreenFull:f["a"],ETable:u["a"],MapStyle:g["a"],BatchEditPage:y["a"],SpanLineExport:D["a"],SpanLineImport:b["a"],YcsbDistinguish:x["a"]},data:function(){return{modalTitle:"",jlxPullVisible:!1,isDisabled:!1,zbzhflag:!1,zbzhBounds:null,tableShow:!1,childTableData:[],host:"",gisName:null,gisData:{},gisOldData:{},gisDataAll:{},psrId:"",psrIds:[],branchPsrid:"",psrType:"",lineId:null,lineType:null,loading:!0,map:null,zoom:17.5,drawRectangle:null,drawCircle:null,drawPolyline:null,drawLinePopList:[],drawPolygon:null,drawPolygonPop:null,tqName:"",colorVal:"",lightColorVal:"#00ffff",greyLineColorVal:"#ccc",greyPsrOpacity:.7,lightData:{},mapChangeLightData:{},ltBoxLtVal:0,ltBoxWid:200,leftTreeData:[{id:1,label:"设备资源列表",children:[]}],rtBoxRtVal:0,rtBoxWid:400,rtChoosedLayerId:"",rightBxInf:{sbId:"",zcbh:"",mc:"",zbType:"1",ddzb:"",wz:"",layerId:"",onItemIndex:null,oldAngle:null,layerType:""},rtBoxCanEdit:!1,marginLeftV:0,marginRightV:0,topMenuIndexVal:0,canvasDOM:null,tucengData:[],operateLayer:[],deviceLayer:[],zhoubianTucentData:[{id:"zbtc",label:"周边线路",type:"jlx",children:[]}],defaultCheckedKeys:[],operateCheckedKeys:[],zhoubianCheckedKeys:["zbtc"],defaultProps:{children:"children",label:"label"},jhxAutoRoutingVisible:!1,jhxAutoRoutingTipsShow:!1,jhxAutoRoutingArr:[],jhxAutoRoutingArrCopy:[],jhxRoutingCancelVisible:!1,awalkingRoutesLayerArray:[],searchResultVisible:!1,searchResult:[],searchKey:"",oldBxVal:{bxIndex:"",itemName:""},isDragEditBx:!1,oldLineVal:{lng:"",lat:""},tqData:null,tqDataFl:{},oldTqDataFl:null,originalTqData:null,oldLineToDian:{byq:[],dlq:[],xnrs:[]},picsData:{},zhoubianShow:!1,keyCodeV:"",styleChangeFlag:!1,currentMapStyle:"aegis://styles/aegis/Streets",dianData:{BigDian:[],SmallDian:[]},currDian:{onArrIndex:"",dianItem:"",lineData:"",lineKey:""},tongganJSON:null,toolsIndex:0,isDrawing:!1,kxType:"",rightMenuVisible:!1,rightMenuType:"",rightClickData:{},kxAllMove:!1,isCanDragBx:!1,noPrefixItem:"",byqBaseNum:1.2,isLeftTreeNodeClick:!1,jlxLocationInfoVisible:!1,ycsbToolsType:0,type:"02",layerMinZoom:0,iconSize:.45,canDragPrs:[],needRecallDataArr:[],recallPositon:{lng:"",lat:"",layerPros:{}},isLoopEnd:!1,point:[],loaclMapCenter:[119.03298459719383,31.62307779195943],isJSVersion:!1,isJHXFaction:!1,longLineSize:500,dialogSetLineSizeVisible:!1,lineForm:{zdcd:0,zdcdOfdl:0,zdcdOfcljx:0,zdcdOfdjd:0,syPsrId:"",isRound:""},beChangeData:[],otherTqTreeData:[],defaultOtherTqCheckedKeys:[],otherTqGeoData:[],otherTqGeoFl:{},zhoubianTqGeoFl:{},currOtherTqData:{},currentZhoubianTqData:{},dialogTxfbVisible:!1,psrChangeColumns:[{label:"设备编号",prop:"sbbh"},{label:"设备名称",prop:"sbmc"},{label:"设备类型",prop:"sblx"},{label:"操作",prop:"active",width:100,elType:"button",activeOption:[{label:"",type:"text",icon:"el-icon-location",methods:"thisPsrLocation"}]}],psrChangeTableData:[],psrChangeDataTypeTj:{},txfbTableHeight:0,dragStepArr:[],filterText:"",mapLoading:!1,vectorSource:null,layerTipsShow:!1,gyRecallVal:"",isChooseSy:!1,marketData:[],stepCancelData:{lightTqData:[],stepTqData:[]},dataSubType:0,dataNewJeoInfo:0,flyingTableData:[],dialogLazhiLineVisible:!1,inflectionPointImportVisible:!1,dialogExportDlgdisible:!1,toChooseDlgdType:"",lazhiForm:{startPsrId:"",startPsrItem:"",startPsrIndex:"",endPsrId:"",endPsrItem:"",endPsrIndex:""},inflectionPointForm:{inflectionPointId:"",inflectionPointItem:"",inflectionPointIndex:"",inflectionPointCoordinates:""},choosedLzPsrType:"",needLazhiData:{},isQueryEndPsrLoop:!1,hasStartAndEndDataArr:[],fxLineColorVal:"#e602f5",needLazhiGroup:"",psrIconSize:{},ycsbDistinguishVisible:!1,plEditVisible:!1,plEditArr:[],djxEditArr:[],djxEditArrAll:[],zbLoopBaseNum:200,fValNum:0,isClearDsq:!1,checkConfigInfo:{ds:{cljx:400,djd:400,dld:800,ljx:400},td:{all:500}},isYxyh:!1,isNeedRetestLongLine:!1,samePoleData:null,samePoleArr:[],sameGtItem:"tonggan",sameTagZbDx:3e-6,outLineTqGeoFl:{},attchsTqGeoFl:{},switchTqGeoFl:{},preDcGeoFlName:"",dcLongLineArr:[],setIntervalId:"",isLock:!1,isAuditLock:!1,znsbOnStation:{item:"",index:0},wlgtPsrStretchStr:"3cd5a098995e,5eab3768a97a,0328ec81b525,0360f1546903,354187fb41ae,a70d5d4e02a3,b2a1dd60d97d,d5fd5b224391,e679342e9a7b,f970b1dbfe8a,74dce86f42a1,0b520ba681b2,bee89acff711,fa2413f03903,5d8b84edb919,97848b539afa",rightClickItem:"",rightClickIndex:null,basePicWid:200,zsbPsrStretchStr:"2c708396bf3a,9d4cf8c3d031,bd4dd6930e56,0cdaa339c3e3,0f03a9c324d8,c7a496a6b111,95b9d649ec55,8cabd9535236,dbfc86d8838a,0558a9d47875,9974088bbd22,7b6ea965ac7f,bd4dd6930e56,2c708396bf3a",zdtAndJtPsrStretchStr:"faf5ecda63ba,54223aa22168,93829f0e57c2,2675bac4444e,989195e9beca,bad2d9de9ded;7a7c43b048e8,c08cf4140406,eb2b7fc7a373,3e43f9374f12,5dc5a73b9ff0,b6b5c1273b83,2fb7522f8beb",psrStretchStr1:"11f065ea0095,b5f94576d3c9,e0dd99878d4a,3c2f83c77080,b40dd24c2fa5,ce09f43df4cc,a911119c32fd,c0007b79fe1e,98a7fd0397d4,4847a4415d45,c752336425df,4256c7903521,f20d287aae4a",psrStretchStr2:"790a01e2d0c6",psrStretchStr3:"d0abfdcc8ac1,geo006c4c426de0d,92d4cbbb0eba",psrStretchStr4:"61ff90ea5c5b",isStop:!1,isRead:!1,isCome:!0,isComeMassage:"",exValue:"",isDrBtnDisabled:!0,isSGYXrecognize:!1,sgYxsbArr:[],sgYxsbArrCopy:[],jlxOffsetPiont:[],centreCoord:[],isJlxAddress:!1,bounds:[],jlxRecallAddress:{addressComponent:{}},targerCoor:[],selectedValue:null,options:[{value:"false",label:"否",default:!0},{value:"true",label:"是"}],isDisabled1:!1}},created:function(){var t=this;document.onkeydown=function(e){var i=e||window.event;t.keyCodeV=i.keyCode,t.keyCodeV>36&&t.keyCodeV<41&&"{}"!==JSON.stringify(t.lightData)&&t.onMoveBx(e,i.keyCode)},document.onkeyup=function(e){var i=e||window.event;t.keyCodeV="",i.keyCode>36&&i.keyCode<41&&"{}"!==JSON.stringify(t.lightData)&&t.onUpBx(e)},this.getIsIncrement(),this.getIsNewGeoJsonInfo();var e=Object(P["d"])(null);console.log("请求参数：",JSON.stringify(e),e),e.hasOwnProperty("psrId")&&e.hasOwnProperty("psrType")&&(this.psrId=e.psrId,this.psrType=e.psrType,this.type=e.psrType,e.exValue&&(this.exValue=e.exValue),console.info("=================exValue",this.exValue)),e.hasOwnProperty("isRead")&&(this.isRead=!0,this.$message({showClose:!0,message:"馈线批量召回查看所属台区图纸，只支持只读自定义查看！",type:"warning",duration:3e3})),e.hasOwnProperty("lineId")&&(this.lineId=e.lineId),e.hasOwnProperty("lineType")&&(this.lineType=e.lineType),e.hasOwnProperty("isLoadLocal")&&(this.isLoadLocal=e.isLoadLocal),e.hasOwnProperty("shebeiId")&&(this.shebeiId=e.shebeiId),e.hasOwnProperty("sbmc")&&(this.tqName=decodeURI(e.sbmc)),e.hasOwnProperty("psrIds")&&(this.psrIds=decodeURI(e.psrIds).split(","),console.log("=============>",Object(l["a"])(this.psrIds),this.psrIds)),e.hasOwnProperty("isYxyh")&&("true"==e.isYxyh&&(this.isYxyh=!0),console.log("==================角色赋值isYxyh=========="+this.isYxyh)),e.hasOwnProperty("isSGYXrecognize")&&("true"==e.isSGYXrecognize&&(this.isSGYXrecognize=!0),console.log("==================影像赋值isSGYXrecognize=========="+this.isSGYXrecognize)),e.hasOwnProperty("isJlxAddress")&&"true"==e.isJlxAddress&&(this.isJlxAddress=!0),"02"==this.type?this.layerMinZoom=0:"01"!=this.type&&"03"!=this.type||(this.layerMinZoom=0),this.isRead||this.startInterval()},mounted:function(){var t=this;this.getWhiteList_(),this.inflectionPointCancelExport(),console.log("=============================================2==================================3=4=5="),"02"==this.type?this.colorVal="#00ccff":"01"!=this.type&&"03"!=this.type||(this.colorVal="#ba4740"),this.getUrlForEpGis((function(e,i){console.log("1231=====21312="),t.getGisTokenTask(e,i)})),this.txfbTableHeight=.67*window.innerHeight,this.marginLeftV=this.ltBoxWid,this.marginRightV=this.rtBoxWid,window.addEventListener("beforeunload",(function(e){return t.beforeunloadHandler(e)})),this.selectedValue=this.options.find((function(t){return t.default}))},beforeDestroy:function(){this.endInterval()},methods:{getFdfxSetting:function(){var t=this;console.log("-----页面加载前-----"),Object(I["s"])().then((function(e){console.log("=====res>",e),"true"==e.data.isDisabled?t.isDisabled1=!0:"false"==e.data.isDisabled&&(t.isDisabled1=!1),t.lineForm.zdcd=e.data.zdcd,t.lineForm.zdcdOfcljx=e.data.zdcdOfcljx,t.lineForm.zdcdOfdjd=e.data.zdcdOfdjd,t.lineForm.zdcdOfdl=e.data.zdcdOfdl})),console.log("-----飞点飞线设置结束-----")},getWhiteList_:function(){var t=this,e={key:document.referrer};console.log("---------页面加载前----------",e),Object(I["B"])(e).then((function(e){var i=e.data;i||t.$router.push({path:"/404"}),console.log("---------白名单----------",e)})).catch((function(t){console.log("---------白名单获取失败---------",t)})),console.log("---------白名单-----加载完成------")},downloadFileInfo:function(){saveAs(new Blob([this.isComeMassage],{type:"text/plain;charset=utf-8"}),"图纸数据获取异常报错信息.txt")},closeTab:function(){console.info("============================closeTab"),window.open("about:blank","_top").close()},startInterval:function(){},endInterval:function(){clearInterval(this.setIntervalId)},getAuditLockByPsr:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(){var e=this;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:Object(I["l"])(this.psrId,"dytq",this.exValue).then((function(t){console.log("审核校验======》",t);var i=t.data;return(!i||"false"===i)&&(e.isAuditLock=!0,!0)}));case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getDiagramLockByPsr:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(){var e,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(I["q"])(this.psrId,this.lineType,this.exValue);case 2:if(e=t.sent,i=JSON.parse(e.data.hasDiagramLock),!i){t.next=10;break}return this.endInterval(),this.$message({showClose:!0,onClose:this.closeTab,message:"该图纸已被用户: '".concat(e.data.userName,"' 于 '").concat(new Date(e.data.lockTime).toLocaleString(),"' 锁定!,\n                                请在客户端完成对应图模信息维护后进行治理操作,\n                                目前无法进行'图形发布'动作，并将在告警提示点击关闭后同时关闭当前浏览器页面!"),type:"error",duration:0}),this.loading=!0,this.isLock=i,t.abrupt("return",!0);case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),downloadExcel:function(t){"模板"==t?console.log("导出模板"):this.isDrBtnDisabled=!1},tableClose:function(t){this.tableShow=!1},getGisTokenTask:function(t,e){var i=this;null==t||null==e?-1!=this.host.indexOf("pms25gzkf")?("undefined"!==typeof SGMap?this.gisName=SGMap:(this.loading=!1,this.$message.error("GIS 地图加载失败,请核对思极地址配置信息！")),this.gisName.tokenTask.login("aeb20318f0103e49bb19f309df95a3e3","0975f16ca3013b488b0913c287824772").then((function(){setTimeout((function(){i.initMap()}),200)})).catch((function(){i.loading=!1,i.$message.error("GIS 地图注册失败,请核对思极登录配置信息！")}))):("undefined"!==typeof epgis?this.gisName=epgis:(this.loading=!1,this.$message.error("GIS 地图加载失败,请核对思极地址配置信息！")),this.gisName.tokenTask.login("642ad9c0c0a232c988d2962148b4fc16","be5205bc8312305f8b7b443abf6091fc").then((function(){setTimeout((function(){i.initMap()}),200)})).catch((function(){i.loading=!1,i.$message.error("GIS 地图注册失败,请核对思极登录配置信息！")}))):("undefined"!==typeof epgis?this.gisName=epgis:(this.loading=!1,this.$message.error("GIS 地图加载失败,请核对思极地址配置信息！")),this.gisName.tokenTask.login(t,e).then((function(){setTimeout((function(){i.initMap()}),200)})).catch((function(){i.loading=!1,i.$message.error("GIS 地图注册失败 ,请核对思极登录配置信息！")})))},initMap:function(){var t=this,e=new this.gisName.Map({container:"map",style:this.currentMapStyle,zoom:this.zoom,maxZoom:23.2,doubleClickZoom:!1,center:this.loaclMapCenter?this.loaclMapCenter:[119.03298459719383,31.62307779195943],localIdeographFontFamily:"Microsoft YoHei",trackResize:!0,keyboard:!1,bearing:0,pitch:0,readerWorldCopies:!1,maxBounds:[[71,1],[135,54]]});this.map=e,this.loading=!1,e.on("load",(function(i){e.style.stylesheet.glyphs||(e.style.stylesheet.glyphs="aegis://fonts/aegis/{fontstack}/{range}.pbf",e.style.glyphManager.setURL("aegis://fonts/aegis/{fontstack}/{range}.pbf")),e.addControl(new t.gisName.NavigationControl,"top-left"),e.addControl(new t.gisName.PitchControl,"top-left"),e.addControl(new t.gisName.ScaleControl({maxWidth:80,unit:"metric"}),"bottom-left"),e.addControl(new p["a"],"top-left"),"{}"==JSON.stringify(t.tqDataFl)?t.getDetail():(t.initTqLayer(t.tqDataFl),0!==t.psrIds.length&&"{}"!==JSON.stringify(t.zhoubianTqGeoFl)&&(t.initTqLayer(t.zhoubianTqGeoFl,"zhoubian","map"),t.zhoubianShow&&t.zhoubianLayerToBottomDsq()),"{}"!==JSON.stringify(t.mapChangeLightData)&&t.initLightLayer(),"{}"!==JSON.stringify(t.outLineTqGeoFl)&&t.initTqLayer(t.outLineTqGeoFl,"outLine","map"),"{}"!==JSON.stringify(t.attchsTqGeoFl)&&t.initTqLayer(t.attchsTqGeoFl,"attchs","map"),"{}"!==JSON.stringify(t.switchTqGeoFl)&&t.initTqLayer(t.switchTqGeoFl,"switch","map"))})),this.map.on("movestart",(function(){t.rightMenuVisible=!1,t.rightMenuType=""})),this.map.on("zoomend",this.mapZoomToChangeLayer),this.map.on("dblclick",this.saveThisDrag),this.map.on("click",(function(e){console.log("-------你点击的位置是",e.lngLat.lng+","+e.lngLat.lat),t.topMenuIndexVal=0,t.rightMenuVisible=!1,t.rightMenuType="",t.jlxLocationInfoVisible=!1})),this.map.on("click","yxsbLocationLayer",(function(e){console.log(""),t.getJlxLocationInfo(e)})),this.canvasDOM=this.map.getCanvasContainer(),console.log("-------父元素",this.canvasDOM),this.canvasDOM.style.cursor="initial",console.log("-------鼠标样式",this.canvasDOM.style.cursor),this.map.on("contextmenu","lightBigDian",this.onRightClick),this.map.on("contextmenu","lightshiLine",this.onRightClick),this.map.on("contextmenu","lightxuLine",this.onRightClick),this.map.on("contextmenu","lightdianLine",this.onRightClick),this.map.on("contextmenu","lightdaoLine",this.onRightClick),this.map.on("contextmenu","light8369317be250",this.onRightClick)},zhoubianLayerToBottomDsq:function(){var t=this,e=setInterval((function(){if(console.log("setInterval定时器执行"),t.zhoubianTqGeoFl&&Object.keys(t.zhoubianTqGeoFl).length&&t.tqDataFl&&Object.keys(t.tqDataFl).length){for(var i in t.tqDataFl)void 0!==t.map.getLayer(i)&&t.map.moveLayer(i);clearInterval(e),console.log("清除定时器")}t.isClearDsq&&(clearInterval(e),console.log("清除定时器"))}),1e3)},initLightLayer:function(){for(var t in this.mapChangeLightData){var e=this.mapChangeLightData[t],i=e.length;if(i>0){for(var r=0;r<i;r++){var a=e[r].properties.dataInTypeIndex;this.addToLightData(this.tqDataFl[t][a],this.lightData)}this.loadLightLayer(this.tqDataFl[t][0],this.lightData)}}this.mapChangeLightData={}},changeMapStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"aegis=//styles/aegis/Streets";this.styleChangeFlag||(this.styleChangeFlag=!0),this.currentMapStyle=t,this.clearMapData(),this.isDragEditBx&&(this.mapChangeLightData=JSON.parse(JSON.stringify(this.lightData)),this.updateAndRemoveLightLayer()),this.map&&this.map.remove(),this.loaclMapCenter=this.map.getCenter(),this.initMap()},clearMapData:function(){this.drawLinePopList=[],this.drawPolygon=null,this.drawCircle=null,this.drawRectangle=null,this.plEditVisible?this.toolsIndex=13:this.toolsIndex=0},mapZoomToChangeLayer:function(){console.log("-------",this.tqDataFl,this.picsData),this.jlxLocationInfoVisible=!1,this.zoom=this.map.getZoom();window.bonck=this;window.bonckDone=true;var t=this.zoom;console.info("============================="+this.zoom),t<17&&this.removeZnsbLayer();var e=this.getMapPixelM("map");for(var i in console.log("当前级别：",this.zoom),console.log("当前像素比：",e),this.tqDataFl)this.tqDataFl[i].length>0&&"Point"==this.tqDataFl[i][0].geometry.type&&void 0!==this.map.getLayer(i)&&this.map.hasImage(i+"Img")&&(this.psrIconSize[i]=this.setPsrIconSize(i,0,e,"tqDataFl"),this.map.setLayoutProperty(i,"icon-size",this.psrIconSize[i]),void 0!==this.map.getLayer("light"+i)&&this.map.setLayoutProperty("light"+i,"icon-size",this.psrIconSize[i]));if(void 0!==this.map.getLayer(this.sameGtItem)&&this.map.hasImage(this.sameGtItem+"Img")){var r=132;this.psrIconSize[this.sameGtItem]=1*e/r,this.map.setLayoutProperty(this.sameGtItem,"icon-size",this.psrIconSize[this.sameGtItem])}"{}"!==JSON.stringify(this.otherTqGeoFl)&&this.toResetOtherGeoLayer("otherTqGeoFl",e),"{}"!==JSON.stringify(this.zhoubianTqGeoFl)&&this.toResetOtherGeoLayer("zhoubianTqGeoFl",e),"{}"!==JSON.stringify(this.outLineTqGeoFl)&&this.toResetOtherGeoLayer("outLineTqGeoFl",e),"{}"!==JSON.stringify(this.attchsTqGeoFl)&&this.toResetOtherGeoLayer("attchsTqGeoFl",e),"{}"!==JSON.stringify(this.switchTqGeoFl)&&this.toResetOtherGeoLayer("switchTqGeoFl",e)},toResetOtherGeoLayer:function(t,e){for(var i in this[t])this[t][i].length>0&&"Point"==this[t][i][0].geometry.type&&void 0!==this.map.getLayer(i)&&this.map.hasImage(i+"Img")&&"none"!==this.map.getLayoutProperty(i,"visibility")&&(this.psrIconSize[i]=this.setPsrIconSize(i,0,e,t),this.map.setLayoutProperty(i,"icon-size",this.psrIconSize[i]))},getMapPixelM:function(t){var e=document.getElementById(t),i=e.querySelector(".epgis-ctrl-scale2"),r=!!i;if(r){var a=i.clientWidth,s=i.innerText.replace(/[^\d\.]/g,"");-1!==i.innerText.indexOf("km")&&(s*=1e3);var o=a/s;return o}},setPsrIconSize:function(t,e,i,r){var a=1.05,s=this[r][t][e].properties.layerPrefix,o=t.replace(s,"");"jrd"==this[r][t][e].properties.psrObjFlType||"zyyhjrd"==this[r][t][e].properties.psrObjFlType?a=.5:"jlx"==this[r][t][e].properties.psrObjFlType?a=.3:-1!==this.psrStretchStr1.indexOf(o)?a=1.1:-1!==this.psrStretchStr2.indexOf(o)?a=1.25:-1!==this.psrStretchStr3.indexOf(o)?a=1.05:-1!==this.psrStretchStr4.indexOf(o)&&(a=1.3);var n=this[r][t][e].properties.symbolSize;-1!==this.wlgtPsrStretchStr.indexOf(o)&&(n=n>3.5?3.5:n);var l=.1,h=i;if(-1!==this.wlgtPsrStretchStr.indexOf(o)||-1!==o.indexOf("_dian")||-1!==o.indexOf("bdzdyd")||-1!==this.zsbPsrStretchStr.indexOf(o)||-1!==this.zdtAndJtPsrStretchStr.indexOf(o)){this.zoom<11?h=5.5:this.zoom<12&&this.zoom>=11?h=5.8:this.zoom<13&&this.zoom>=12?h=6.4:this.zoom<14&&this.zoom>=13?h=7.2:this.zoom<15&&this.zoom>=14?h=8.5:this.zoom<16&&this.zoom>=15?h=10.1:this.zoom<17&&this.zoom>=16?h=12.5:this.zoom<18&&this.zoom>=17?h=15.5:this.zoom<19&&this.zoom>=18?h=19.5:this.zoom<20&&this.zoom>=19?h=24.5:this.zoom<21&&this.zoom>=20&&(h=30.5),-1!==o.indexOf("bdzdyd")&&(h*=2),-1!==this.zdtAndJtPsrStretchStr.indexOf(o)&&(n=n>.75?.75:n);var p=h*n/this.basePicWid*a;-1!==this.wlgtPsrStretchStr.indexOf(o)&&(p/=5,this.wlgtIconSize=p),-1===this.zsbPsrStretchStr.indexOf(o)&&-1===this.zdtAndJtPsrStretchStr.indexOf(o)||"dytq"==this.lineType||this.wlgtIconSize<p<=.45*this.wlgtIconSize&&(p=.45*this.wlgtIconSize),l=p}else{var d=i*n/this.basePicWid*a;this.zoom<10?l=0:-1==t.indexOf("yxgt")&&-1==t.indexOf("zxgt")&&"dytq"==this.lineType&&d<=.075?(d=.075,l=d):l=d}return l},setIconSizeByZoom:function(t,e){var i=0;return t>=21.5?i="wlgt"==e?.7:.6:t<21.5&&t>=21?i="wlgt"==e?.6:.55:t<21&&t>=20.5?i="wlgt"==e?.48:.55:t<20.5&&t>=20.1?i="wlgt"==e?.38:.5:t<20.1&&t>=19.2?i="wlgt"==e?.28:.45:t<19.2&&t>=18.4?i="wlgt"==e?.18:.4:t<18.4&&t>=17.5?i="wlgt"==e?.16:.35:t<17.5&&t>17.1?i="wlgt"==e?.14:.3:t<17.1&&t>=15.7?i="wlgt"==e?.12:.25:t<15.7&&t>=14.9?i="wlgt"==e?.1:.2:t<14.9&&t>=14.4?i="wlgt"==e?.08:.16:t<14.4&&t>=13.5?i="wlgt"==e?.06:.12:t<13.5&&t>=12.3?i="wlgt"==e?.04:.08:t<12.3&&(i=0),i},saveThisDrag:function(t){console.log("=============>saveThisDrag:",t),0===t.originalEvent.button&&(t.preventDefault(),this.isDragEditBx=!1,this.kxAllMove=!1,this.rtBoxCanEdit=!1,this.stepCancelData={lightTqData:[],stepTqData:[]},this.removeZnsbLayer(),this.updateAndRemoveLightLayer(),this.oldTqDataFl=JSON.parse(JSON.stringify(this.tqDataFl)))},getJlxLocationInfo:function(t){if(0!=t.features.length){console.info("getJlxLocationInfo:--",t,t.features),this.jlxLocationInfoVisible=!0;var e=document.querySelector("#jlxLocationInfo");e.style.left=t.originalEvent.clientX-93+"px",e.style.top=t.originalEvent.clientY-246+"px"}},onRightClick:function(t){if(t.preventDefault(),void 0!=t.features){console.info("onRightClick:--",t,t.features[0]),this.rightClickData=t.features[0],this.rightMenuType="","fill"==t.features[0].layer.type||"bdzdyd"==t.features[0].layer.id?this.rightMenuType="stationLayer":this.rightMenuType=t.features[0].layer.id,"lightshiLine"==t.features[0].layer.id&&"yxsb"==t.features[0].properties.deviceType&&(this.rightMenuType="jhxAutoRoutingLayer"),""!==this.rightMenuType&&(this.rightMenuVisible=!0);var e=document.querySelector("#rightMenu");e.style.left=t.originalEvent.clientX+"px",e.style.top=t.originalEvent.clientY+"px",this.recallPositon.lng=t.lngLat.lng,this.recallPositon.lat=t.lngLat.lat,this.recallPositon.layerPros=t.features[0].properties}},initDrawRectangle:function(){var t=this;this.drawRectangle=new this.gisName.DrawRectangleHandler({map:this.map,enableEdit:!this.isRead,featuresList:[]}),this.drawRectangle.on("draw.rectangle.start",(function(){})),this.drawRectangle.on("draw.rectangle.addPoint",(function(t){})),this.drawRectangle.on("edit.rectangle.start",(function(){})),this.drawRectangle.on("edit.rectangle.change",(function(t){})),this.drawRectangle.on("edit.rectangle.end",(function(t){})),this.drawRectangle.on("draw.rectangle.end",(function(e){t.kxType="",t.map.doubleClickZoom.disable();var i=t.drawRectangle.getFeatures();i.length>0&&i[0].geometry.coordinates[0].length>0&&t.getRangeLayerData(i[0].geometry.coordinates[0])}))},initDrawCircle:function(){var t=this;this.drawCircle=new this.gisName.DrawCircleHandler({map:this.map,enableEdit:!this.isRead,featuresList:[]}),this.drawCircle.on("draw.circle.start",(function(){})),this.drawCircle.on("draw.circle.addPoint",(function(t){})),this.drawCircle.on("edit.circle.start",(function(){})),this.drawCircle.on("edit.circle.change",(function(t){})),this.drawCircle.on("edit.circle.end",(function(t){})),this.drawCircle.on("draw.circle.end",(function(e){t.kxType="",t.map.doubleClickZoom.disable();var i=t.drawCircle.getFeatures();i.length>0&&i[0].geometry.coordinates[0].length>0&&t.getRangeLayerDataOld(i[0].geometry.coordinates[0],t.tqDataFl)}))},initDrawPolyline:function(){var t=this,e=[],i=[];this.drawPolyline=new this.gisName.DrawPolylineHandler({map:this.map,enableEdit:!this.isRead,featuresList:e}),this.drawPolyline.on("draw.polyline.start",(function(t){})),this.drawPolyline.on("draw.polyline.addPoint",(function(r){console.log("添加节点");var a=e[0].geometry.coordinates,s=a&&a.length>1?t.gisName.GeometryUtil.distanceOfLine(a).toFixed(2)+"m":"起点",o=new t.gisName.Popup({closeButton:!1,closeOnClick:!1,className:"popup-info"}).setLngLat(a[a.length-1]).setText(s).addTo(t.map).on("close",(function(t){}));t.drawLinePopList.push(o),i=JSON.parse(JSON.stringify(a))})),this.drawPolyline.on("edit.polyline.start",(function(t){})),this.drawPolyline.on("edit.polyline.change",(function(e){for(var r=e.editFeature.geometry.coordinates,a=0,s=0;s<r.length;s++){var o=i[s],n=r[s];if(o[0]!==n[0]||o[1]!==n[1]){console.log("当前变更点的索引为：",s),a=s,t.drawLinePopList[s].setLngLat(n);break}}for(var l=a;l<r.length;l++){var h=0===l?"起点":t.gisName.GeometryUtil.distanceOfLine(r.slice(0,l+1)).toFixed(2)+"m";t.drawLinePopList[l].setText(h)}i=JSON.parse(JSON.stringify(r))})),this.drawPolyline.on("edit.polyline.end",(function(t){})),this.drawPolyline.on("draw.polyline.end",(function(e){if(!t.drawLinePopList||!t.drawLinePopList.length)return!1;t.drawLinePopList[t.drawLinePopList.length-1].remove();var r=e.feature.geometry.coordinates,a=t.gisName.GeometryUtil.distanceOfLine(r).toFixed(2)+"m";t.drawLinePopList[t.drawLinePopList.length-1]=new t.gisName.Popup({closeButton:!0,closeOnClick:!1,className:"popup-info"}).setLngLat(i[i.length-1]).setText(a).addTo(t.map).on("close",(function(e){t.clearDrawPolyline(!0)})),t.toolsIndex=0}))},clearDrawPolyline:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(console.log("清除画线工具",this.drawLinePopList),!this.drawLinePopList||!this.drawLinePopList.length)return!0;if(t){for(var e=0;e<this.drawLinePopList.length-1;e++)this.drawLinePopList[e].remove();this.drawLinePopList=[],this.drawPolyline&&this.drawPolyline.clearData(),console.log("清除完成")}else this.drawLinePopList[this.drawLinePopList.length-1].remove()},initDrawPolygon:function(){var t=this;this.drawPolygon=new this.gisName.DrawPolygonHandler({map:this.map,enableEdit:!this.isRead,featuresList:[]}),this.drawPolygon.on("draw.polygon.start",(function(){})),this.drawPolygon.on("draw.polygon.addPoint",(function(t){})),this.drawPolygon.on("edit.polygon.start",(function(){})),this.drawPolygon.on("edit.polygon.change",(function(t){})),this.drawPolygon.on("edit.polygon.end",(function(t){})),this.drawPolygon.on("draw.polygon.end",(function(e){console.log("画图结束");var i=e.feature.geometry.coordinates[0].concat();t.drawPolygonPop=new t.gisName.Popup({closeButton:!0,closeOnClick:!1,className:"popup-info"}).setLngLat(i[i.length-1]).setText("图中面积为："+t.gisName.GeometryUtil.ringArea(i).toFixed(2)+" 平米").addTo(t.map).on("close",(function(e){console.log("弹窗close 事件"),t.clearDrawPolygonData(!0)})),t.toolsIndex=0}))},clearDrawPolygonData:function(t){t?(this.drawPolygon&&this.drawPolygon.clearData(),console.log("清除")):this.drawPolygonPop&&this.drawPolygonPop.remove()},getUrlForEpGis:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(e){var i,r,a,s,n,l,h,p;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.host=window.location.host.toString(),i={key:"ceo_gisMapInfo"},t.next=4,Object(I["n"])(i);case 4:r=t.sent,a=r.data?JSON.parse(r.data):null,console.log("===========gisMapInfo",JSON.stringify(a)),a.loaclMapCenter&&(this.loaclMapCenter=a.loaclMapCenter),a.isJSVersion&&(this.isJSVersion=a.isJSVersion),a.isJHXFaction&&(this.isJHXFaction=a.isJHXFaction),s="http://map.js.sgcc.com.cn/api/epgis-1.5.0.css",n="http://map.js.sgcc.com.cn/api/epgis-js-1.5.0.min.js",l=document.createElement("link"),h=document.createElement("script"),null==a||"undefined"==typeof a?-1!=this.host.indexOf("localhost")&&(s="http://map.sgcc.com.cn/api/epgis-1.5.0.css",n="http://map.sgcc.com.cn/api/epgis-js-1.5.0.min.js"):(s="http://"+a.url+"/api/epgis-1.5.0.css",n="http://"+a.url+"/api/epgis-js-1.5.0.min.js"),l.setAttribute("rel","stylesheet"),l.setAttribute("href",s),document.head.insertBefore(l,document.head.lastChild),h.setAttribute("src",n),document.head.insertBefore(h,document.head.lastChild),h.onload=h.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(h.onload=h.onreadystatechange=null,e&&"function"==typeof e&&(a?e(a.appKey,a.appSecret,a.loaclMapCenter):e()))},p=this,h.onerror=function(){console.log("加载地图脚本失败-------------"),p.loading=!1,p.$message.error("GIS 地图加载失败,请核对思极地址配置信息！")},console.log("===========================>loadingEnd");case 24:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getIsIncrement:function(){var t=this,e={key:"ceo_sfzlkg"};Object(I["n"])(e).then((function(e){var i=JSON.parse(e.data);t.dataSubType="1"==i?1:0,console.log("===========是否增量发布"+t.dataSubType)})).catch((function(e){t.dataSubType=0}))},getIsNewGeoJsonInfo:function(){var t=this,e={key:"ceo_sfnewjeokg"};Object(I["n"])(e).then((function(e){var i=JSON.parse(e.data);t.dataNewJeoInfo="1"==i?1:0,console.log("===========是否新的jeo接口"+t.dataNewJeoInfo)})).catch((function(e){t.dataNewJeoInfo=0}))},getDetail:function(){var t=this;this.layerTipsShow=!0;var e="";e=1==this.dataNewJeoInfo?this.lineType:this.psrType,Object(I["f"])(this.psrId,e,this.exValue,this.isLoadLocal,this.shebeiId).then((function(e){"0"!==e.code&&(t.isCome=!1,t.isComeMassage=e.message),"自动沿布成功"==e.data&&t.$message({showClose:!0,message:"治理工具获取图纸数据异常，已完成自动沿布，请尝试刷新页面重新获取图纸信息，无法获取请查看沿布后台！",type:"warning",duration:0}),t.layerTipsShow=!1;var i=t.tqData=JSON.parse(e.data.geojson);t.gisOldData=e.data.geojson,t.shebeiId=e.data.shebeiId,t.setLayerData(i)})).catch((function(e){t.loading=!1,t.layerTipsShow=!1}))},getOtherDetail:function(){var t=this;Object(I["D"])(this.psrIds,this.lineType).then((function(e){if(console.log(),console.log("请求成功"),t.layerTipsShow=!1,""!=e.data.geojson){var i=JSON.parse(e.data.geojson);t.setLayerData(i,"zhoubian","map")}}))},getSamePoleDetail:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(){var e,i,r;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e="01"==this.psrType?"dkx":"02"==this.psrType?"dytq":"xl",t.next=3,Object(I["t"])({psrs:[{psrId:this.psrId,psrType:e}],versionId:""});case 3:i=t.sent,this.tongganJSON=i.data,console.log(i,this.psrId,i.data[this.psrId]),r=this.psrId,i&&i.data&&void 0!==i.data[r]&&(this.samePoleData=JSON.parse(JSON.stringify(i.data[r])),this.queryTongGan(),this.appendTucengKz());case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),appendTucengKz:function(){if(this.samePoleData){var t=[],e=this.$refs.tucengTree.getCheckedNodes();for(var i in this.samePoleData){var r="attchs"==i?"同杆对侧线路":"switch"==i?"同联络开关对侧线路":"同站房对侧线路";this.$refs.tucengTree.insertBefore({id:i,label:r,type:i,children:[]},e[0]),t.push(i)}t.length&&this.dcLoad(t)}},dcLoad:function(t){var e=this,i={key:"ceo_dcLoad"};Object(I["n"])(i).then((function(i){var r=JSON.parse(i.data);"1"==r&&t.forEach((function(t){e.$refs.tucengTree.setChecked(t,!0),e.getTgDcDetail(t)}))})).catch((function(t){}))},getTgDcDetail:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(e){var i,r;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=this.tongganJSON&&this.tongganJSON[this.psrId]?this.tongganJSON[this.psrId][e]:[],t.next=3,Object(I["k"])({psrType:this.psrType,list:i});case 3:r=t.sent,r.data&&r.data.geojson&&"error"!=r.data.geojson&&this.setLayerData(JSON.parse(r.data.geojson),"tonggan"+e,"map");case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),setLayerData:function(t,e,i){var r="",a=[],s="";if(null!==t)if(e)if("zhoubian"==e){if(t.hasOwnProperty("id")&&(s=t.id),this.currentZhoubianTqData=t,this.zhoubianTqGeoFl={},!this.currentZhoubianTqData.hasOwnProperty("features")||0==this.currentZhoubianTqData.features.length)return;a=this.currentZhoubianTqData.features,r="zhoubian"}else if("string"==typeof e&&-1!==e.indexOf("tonggan")){var o=e.replace("tonggan","");if(e=o,this[o+"TqGeoFl"]={},!t.hasOwnProperty("features")||0==t.features.length)return;a=t.features,r=o}else{if(t.hasOwnProperty("id")&&(s=t.id),this.currOtherTqData=t,this.otherTqGeoFl={},!this.currOtherTqData.hasOwnProperty("features")||0==this.currOtherTqData.features.length)return;a=this.currOtherTqData.features,r="other"}else{if(this.tqData=t,this.tqDataFl={},"string"==typeof this.tqData&&(this.tqData=JSON.parse(this.tqData)),!this.tqData.hasOwnProperty("features")||0==this.tqData.features.length)return void this.$message.warning("无GEOJSON数据，请重新加载");a=this.tqData.features}void 0===i&&(this.oldLineToDian={},this.beChangeData=[],this.marketData=[],this.leftTreeData[0].children=[],this.$refs.leftPanel.updateTreeChildren(this.leftTreeData[0].id,[])),console.log("前缀卫：",r),this.getDataAllZb(a,{isOtherTq:e,otherMap:i,tqPrefix:r,currTqId:s})},setZbTypeNum:function(t){return"Polygon"==t.geometry.type?3:"LineString"==t.geometry.type?2:1},getDataAllZb:function(t,e){var i=this,r=t.length,a=[],s=0,o=0;this.fValNum=0;for(var n=0,l=0,h=0,p=0,d=0;d<r;d++){var c=t[d],g=0,y=!1;if(e.otherMap&&"Polygon"==c.geometry.type&&c.properties.hasOwnProperty("dataInTypeIndex"))d==r-1&&(a.length>0?this.getCoorDataToSjzb(t,a,o,d,e):(this.fValNum++,this.appendToTqFl(c,e.isOtherTq,e.tqPrefix,e.currTqId,this.fValNum,r,e.otherMap)));else if(null!=c.geometry.type&&"null"!=c.geometry.type&&""!=c.geometry.type&&void 0!=c.geometry.type){if(null==c.geometry.coordinates||"null"==c.geometry.coordinates||""==c.geometry.coordinates||void 0==c.geometry.coordinates)return e.isOtherTq&&"string"==typeof e.isOtherTq&&("zhoubian"==e.isOtherTq&&(this.isClearDsq=!0),this[e.isOtherTq+"TqGeoFl"]={}),void this.$message.error("设备ID:"+c.properties.id+", 资源ID:"+c.properties.prsId+", 名称:"+c.properties.name+"; 对应设备坐标为空,请在客户端维护图纸！");if(e.isOtherTq||!this.queryRepeatDydDelete(c,t)||(t.splice(d,1),r--,d--,y=!0,r!=d+1)){if(!y)if("Point"==c.geometry.type){if(this.isPsrCoorError(c.geometry.coordinates[0],c.geometry.coordinates[1]))return e.isOtherTq&&"string"==typeof e.isOtherTq&&("zhoubian"==e.isOtherTq&&(this.isClearDsq=!0),this[e.isOtherTq+"TqGeoFl"]={}),void this.$message.error("设备ID: '".concat(c.properties.id?c.properties.id:"null","',\n                设备Oid: '").concat(c.properties.oid?c.properties.oid:"null","',\n                资源ID: '").concat(c.properties.prsId?c.properties.prsId:"null","',\n                名称: '").concat(c.properties.name?c.properties.name:"null","'; 对应设备坐标存在负值,请在客户端维护图纸！"));a.push(c.geometry.coordinates),s++}else if("LineString"==c.geometry.type){for(var f=c.geometry.coordinates.length,u=0;u<f;u++){if(this.isPsrCoorError(c.geometry.coordinates[u][0],c.geometry.coordinates[u][1]))return e.isOtherTq&&"string"==typeof e.isOtherTq&&("zhoubian"==e.isOtherTq&&(this.isClearDsq=!0),this[e.isOtherTq+"TqGeoFl"]={}),void this.$message.error("设备ID: '".concat(c.properties.id?c.properties.id:"null","',\n                设备Oid: '").concat(c.properties.oid?c.properties.oid:"null","',\n                资源ID: '").concat(c.properties.prsId?c.properties.prsId:"null","',\n                名称: '").concat(c.properties.name?c.properties.name:"null","'; 对应设备坐标存在负值,请在客户端维护图纸！"));for(var m=c.geometry.coordinates[u][0].toFixed(6),D=0;D<f;D++){var b=c.geometry.coordinates[D][0].toFixed(6);m==b&&D!=u&&(c.geometry.coordinates[u][0]+=5e-7,c.geometry.coordinates[u][1]+=5e-7)}a.push(c.geometry.coordinates[u])}s+=f}else if("MultiLineString"==c.geometry.type)for(var x=c.geometry.coordinates.length,v=0;v<x;v++){for(var L=c.geometry.coordinates[v].length,I=0;I<L;I++){if(this.isPsrCoorError(c.geometry.coordinates[v][I][0],c.geometry.coordinates[v][I][1]))return e.isOtherTq&&"string"==typeof e.isOtherTq&&("zhoubian"==e.isOtherTq&&(this.isClearDsq=!0),this[e.isOtherTq+"TqGeoFl"]={}),void this.$message.error("设备ID: '".concat(c.properties.id?c.properties.id:"null","',\n                设备Oid: '").concat(c.properties.oid?c.properties.oid:"null","',\n                资源ID: '").concat(c.properties.prsId?c.properties.prsId:"null","',\n                名称: '").concat(c.properties.name?c.properties.name:"null","'; 对应设备坐标存在负值,请在客户端维护图纸！"));a.push(c.geometry.coordinates[v][I])}s+=L}else if("Polygon"==c.geometry.type){for(var P=c.geometry.coordinates[0].length,F=0;F<P;F++){if(this.isPsrCoorError(c.geometry.coordinates[0][F][0],c.geometry.coordinates[0][F][1]))return e.isOtherTq&&"string"==typeof e.isOtherTq&&("zhoubian"==e.isOtherTq&&(this.isClearDsq=!0),this[e.isOtherTq+"TqGeoFl"]={}),void this.$message.error("设备ID: '".concat(c.properties.id?c.properties.id:"null","',\n                设备Oid: '").concat(c.properties.oid?c.properties.oid:"null","',\n                资源ID: '").concat(c.properties.prsId?c.properties.prsId:"null","',\n                名称: '").concat(c.properties.name?c.properties.name:"null","'; 对应设备坐标存在负值,请在客户端维护图纸！"));a.push(c.geometry.coordinates[0][F])}s+=P}if(d!==r-1){var T=t[d+1];if("Point"==T.geometry.type)g=1;else if("LineString"==T.geometry.type)g=null==T.geometry.coordinates||"null"==T.geometry.coordinates||""==T.geometry.coordinates||void 0==T.geometry.coordinates?0:T.geometry.coordinates.length;else if("MultiLineString"==T.geometry.type){for(var q=T.geometry.coordinates.length,O=0,S=0;S<q;S++){var N=T.geometry.coordinates[S].length;O+=N}g=O}else"Polygon"==T.geometry.type&&(g=5)}s+g>this.zbLoopBaseNum&&d!==r-1?(this.getCoorDataToSjzb(t,a,o,d,e),o=d+1,a=[],s=0,this.zbzhflag=!0):d==r-1&&s<=this.zbLoopBaseNum&&(this.getCoorDataToSjzb(t,a,o,d,e),this.zbzhflag=!0);for(var w=JSON.stringify(c.geometry.coordinates).split(","),A=0;A<w.length;A++)if(A%2==0){var C=parseFloat(w[A].replace(/\[|]/g,""));(0==l||C<l)&&(l=C),C>n&&(n=C)}else{var z=parseFloat(w[A].replace(/\[|]/g,""));(0==p||z<p)&&(p=z),z>h&&(h=z)}}else a.length>0?this.getCoorDataToSjzb(t,a,o,d,e):this.toLoadFlLayer(e.isOtherTq,e.otherMap)}else t.splice(d,1),r--,d--}e.isOtherTq||(this.zbzhBounds=[[l,p],[n,h]],this.zbzhflag?this.getCoorDataToFitBounds(this.zbzhBounds):setTimeout((function(){i.map.fitBounds(i.zbzhBounds,{padding:{top:20,bottom:35,left:20,right:20}})}),120))},isPsrCoorError:function(t,e){return t<0||e<0},getCoorDataToSjzb:function(t,e,i,r,a){var s=this,o=new this.gisName.ConvertTask;o.convertCoord(e,{from:1}).then((function(e){s.tqDataZbToChange(t,e,i,r,a)}))},getCoorDataToFitBounds:function(t){var e=this,i=new this.gisName.ConvertTask;i.convertCoord(t,{from:1}).then((function(t){e.map.fitBounds(t,{padding:{top:20,bottom:35,left:20,right:20}})}))},tqDataZbToChange:function(t,e,i,r,a){for(var s=0,o=t.length,n=this.colorVal,l=1,h=i;h<r+1;h++){var p=t[h];if("dytq"==this.lineType&&""==this.branchPsrid&&p.properties.hasOwnProperty("branchPsrid")&&(this.branchPsrid=p.properties.branchPsrid),p.properties.tagContent&&(p.properties.tagContent=p.properties.tagContent.replace(/\\n|\\r|\\t/g,"")),void 0===a.otherMap&&(p.properties.hasOwnProperty("ofLineArr")&&(p.properties.ofLineArr=[]),p.properties.hasOwnProperty("ofPsrArr")&&(p.properties.ofPsrArr=[]),p.properties.hasOwnProperty("onLightDataIndex")&&(p.properties.onLightDataIndex=""),p.properties.hasOwnProperty("psrPoledInf")&&(p.properties.psrPoledInf=[])),"string"==typeof a.isOtherTq&&(n=this.greyLineColorVal,l=.7),this.$set(p.properties,"customOpacity",l),this.$set(p.properties,"customLightOpacity",0),this.$set(p.properties,"layerPrefix",a.tqPrefix),p.properties.hasOwnProperty("systemType")&&5==p.properties.systemType&&"03"!==this.type&&void 0===a.otherMap&&!this.isYxyh&&(p.properties.customOpacity=0),a.otherMap&&"Polygon"==p.geometry.type&&p.properties.hasOwnProperty("dataInTypeIndex"))this.fValNum++,this.appendToTqFl(p,a.isOtherTq,a.tqPrefix,a.currTqId,this.fValNum,o,a.otherMap);else{if("Point"==p.geometry.type)p.geometry.coordinates=JSON.parse(JSON.stringify(e[s])),s++;else if("LineString"==p.geometry.type){this.$set(p.properties,"customLineColor",n),this.$set(p.properties,"customLightLineColor",this.lightColorVal);for(var d=p.geometry.coordinates.length,c=0;c<d;c++)p.geometry.coordinates[c]=JSON.parse(JSON.stringify(e[s])),s++}else if("MultiLineString"==p.geometry.type){this.$set(p.properties,"customLineColor",n),this.$set(p.properties,"customLightLineColor",this.lightColorVal);for(var g=p.geometry.coordinates.length,y=0;y<g;y++)for(var f=p.geometry.coordinates[y].length,u=0;u<f;u++)p.geometry.coordinates[y][u]=JSON.parse(JSON.stringify(e[s])),s++}else if("Polygon"==p.geometry.type){var m=p.properties.customOpacity+p.properties.customLightOpacity;this.$set(p.properties,"customSymbolOpacity",m);for(var D=p.geometry.coordinates[0].length,b=0;b<D;b++)p.geometry.coordinates[0][b]=JSON.parse(JSON.stringify(e[s])),s++}this.fValNum++,this.appendToTqFl(p,a.isOtherTq,a.tqPrefix,a.currTqId,this.fValNum,o,a.otherMap)}}},appendToTqFl:function(t,e,i,r,a,s,o){var n="",l="";switch(this.isYxyh&&""==i&&(5!==t.properties.systemType&&"02"!==this.type||"02"==this.type&&4103e5!==t.properties.objType)&&(i="yunjian"+i,t.properties.hasOwnProperty("customLineColor")&&(t.properties.customLineColor="#ccc")),t.properties.objType){case 4103e5:this.$set(t.properties,"psrName","用户-计量箱"),this.$set(t.properties,"psrNo",i+"jlx"),this.isYxyh||(t.properties.customOpacity=0),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3202e5:this.$set(t.properties,"psrName","低压-电缆终端头"),this.$set(t.properties,"psrNo",i+"zdt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3218e5:this.$set(t.properties,"psrName","低压-用户接入点"),this.$set(t.properties,"psrNo",i+"jrd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 11000002:l="柱上-变压器(专变公用)";case 11000001:l="柱上-用户变压器";case 11e6:l="柱上-变压器";case 30100002:l="主变压器-双绕组";case 30200002:"02"==this.type?n="":"01"!=this.type&&"03"!=this.type||(n="zy"),""==l&&(l="配电变压器-双绕组"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+n+"byq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30200004:this.$set(t.properties,"psrName","配电变压器-专变公用"),this.$set(t.properties,"psrNo",i+"pdbyqzbgy"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3103e5:l="低压柱上-断路器";case 321500001:""==l&&(l="低压站内-断路器"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"dlq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 32000001:l="低压站内-出线点";case 32100001:l="站内-终端头";case 321e5:""==l&&(l="站内-终端头"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"znzdt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 0:this.$set(t.properties,"psrName","连接点"),this.$set(t.properties,"psrNo",i+"ljd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 323e5:"02"==this.type?n="":"01"!=this.type&&"03"!=this.type||(n="zy"),this.$set(t.properties,"psrName","箱式变电站"),this.$set(t.properties,"psrNo",i+n+"xsb"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 326e5:this.$set(t.properties,"psrName","低压站房-电缆分支箱"),this.$set(t.properties,"psrNo",i+"fzx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 204e5:this.$set(t.properties,"psrName","站房-电缆分支箱"),this.$set(t.properties,"psrNo",i+"fzx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3114e5:this.$set(t.properties,"psrName","低压-直线运行杆塔"),this.$set(t.properties,"psrNo",i+"zxyxgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 311400001:this.$set(t.properties,"psrName","低压-耐张运行杆塔"),this.$set(t.properties,"psrNo",i+"dynzyxgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3102e5:this.$set(t.properties,"psrName","低压-直线物理杆塔"),this.$set(t.properties,"psrNo",i+"dyzxwlgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 310200001:this.$set(t.properties,"psrName","低压-耐张物理杆塔"),this.$set(t.properties,"psrNo",i+"dynzwlgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 325e5:this.$set(t.properties,"psrName","低压配电箱"),this.$set(t.properties,"psrNo",i+"pdx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30000005:this.$set(t.properties,"psrName","配电站"),this.$set(t.properties,"psrNo",i+"pds"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 14000001:l="低压站外-超连接线";case 14e6:""==l&&(l="站外-超连接线"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"xuLine"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 322e5:l="站内-电缆";case 3201e5:l="低压-电缆段";case 201e5:""==l&&(l="站外-电缆段"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"dianLine"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3101e5:l="低压-档距段";case 101e5:""==l&&(l="档距段"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"daoLine"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30000006:this.$set(t.properties,"psrName","用户站"),this.$set(t.properties,"psrNo",i+"yhz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 324e5:"01"==this.type||"03"==this.type?n="zy":"02"==this.type&&(n=""),this.$set(t.properties,"psrName","环网柜"),this.$set(t.properties,"psrNo",i+n+"hwg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 102e5:this.$set(t.properties,"psrName","直线-运行杆塔"),this.$set(t.properties,"psrNo",i+"zxyxgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 306e5:this.$set(t.properties,"psrName","站内-隔离开关"),this.$set(t.properties,"psrNo",i+"glkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 37e6:this.$set(t.properties,"psrName","站外-中压用户接入点"),this.$set(t.properties,"psrNo",i+"zyyhjrd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 202e5:this.$set(t.properties,"psrName","站外-电缆终端头"),this.$set(t.properties,"psrNo",i+"dlzdt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 32e6:this.$set(t.properties,"psrName","站内-出线点"),this.$set(t.properties,"psrNo",i+"cxd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30700002:this.$set(t.properties,"psrName","站内-三工位负荷开关"),this.$set(t.properties,"psrNo",i+"sgwfhkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30200003:this.$set(t.properties,"psrName","配电变压器-用户"),this.$set(t.properties,"psrNo",i+"yhznzyb"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 10200001:this.$set(t.properties,"psrName","耐张-运行杆塔"),this.$set(t.properties,"psrNo",i+"nzyxgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 111e5:l="柱上-断路器";case 305e5:""==l&&(l="站内-断路器"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"zydlq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 203e5:this.$set(t.properties,"psrName","站外-电缆中间接头"),this.$set(t.properties,"psrNo",i+"dlzjjt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3215e5:this.$set(t.properties,"psrName","低压站内-隔离开关"),this.$set(t.properties,"psrNo",i+"glkg3cc3"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30600007:this.$set(t.properties,"psrName","站内-三工位隔离刀闸"),this.$set(t.properties,"psrNo",i+"sgwgldz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3106e5:l="低压柱上-熔断器";case 331e6:""==l&&(l="低压站内-熔断器"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"rdskg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 331000001:this.$set(t.properties,"psrName","低压站内-熔丝"),this.$set(t.properties,"psrNo",i+"rs"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3219e5:this.$set(t.properties,"psrName","低压-墙支架"),this.$set(t.properties,"psrNo",i+"qzj"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3113e5:this.$set(t.properties,"psrName","低压-熔丝"),this.$set(t.properties,"psrNo",i+"dyrs"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 311e6:this.$set(t.properties,"psrName","低压-无功补偿箱"),this.$set(t.properties,"psrNo",i+"wgbcx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 399000001:this.$set(t.properties,"psrName","低压-站内无功补偿器"),this.$set(t.properties,"psrNo",i+"znwgbcq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 4102e5:this.$set(t.properties,"psrName","用户-虚拟表箱"),this.$set(t.properties,"psrNo",i+"xnbx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 19000002:"02"==this.type?n="dy":"01"!=this.type&&"03"!=this.type||(n=""),this.$set(t.properties,"psrName","站外-变电站出、进线点"),this.$set(t.properties,"psrNo",i+n+"bdzcjxd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000008:this.$set(t.properties,"psrName","站内-电力电阻器"),this.$set(t.properties,"psrNo",i+"dldzq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000002:this.$set(t.properties,"psrName","站内-电力电感器"),this.$set(t.properties,"psrNo",i+"dldgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000004:this.$set(t.properties,"psrName","站内-接地间隙"),this.$set(t.properties,"psrNo",i+"jdjx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000001:this.$set(t.properties,"psrName","站内-带电指示器"),this.$set(t.properties,"psrNo",i+"ddzsq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000006:this.$set(t.properties,"psrName","站内-无功补偿器"),this.$set(t.properties,"psrNo",i+"wgbcq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 303e5:this.$set(t.properties,"psrName","站内-所用变"),this.$set(t.properties,"psrNo",i+"syb"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 307e5:this.$set(t.properties,"psrName","站内-负荷开关"),this.$set(t.properties,"psrNo",i+"fhkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 112e5:this.$set(t.properties,"psrName","柱上-负荷开关"),this.$set(t.properties,"psrNo",i+"fhkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30600001:this.$set(t.properties,"psrName","站内-接地刀闸"),this.$set(t.properties,"psrNo",i+"jddz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 316e5:this.$set(t.properties,"psrName","站内-电力电容器"),this.$set(t.properties,"psrNo",i+"drq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 317e5:this.$set(t.properties,"psrName","站内-电力电容器"),this.$set(t.properties,"psrNo",i+"drq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 119e5:this.$set(t.properties,"psrName","柱上-电容器"),this.$set(t.properties,"psrNo",i+"drq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 304e5:this.$set(t.properties,"psrName","站内-接地变"),this.$set(t.properties,"psrNo",i+"znjdb"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 309e5:this.$set(t.properties,"psrName","站内-熔断器"),this.$set(t.properties,"psrNo",i+"zyrdq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 308e5:this.$set(t.properties,"psrName","站内-接地电阻"),this.$set(t.properties,"psrNo",i+"znjddz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000007:this.$set(t.properties,"psrName","站内-放电线圈"),this.$set(t.properties,"psrNo",i+"fdxq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 314e5:this.$set(t.properties,"psrName","站内-电压互感器"),this.$set(t.properties,"psrNo",i+"srzdyhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 31300001:this.$set(t.properties,"psrName","站内-电流互感器"),this.$set(t.properties,"psrNo",i+"sxlgcjrzdlhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 312e5:this.$set(t.properties,"psrName","站内-电抗器"),this.$set(t.properties,"psrNo",i+"dkq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 116e5:l="站外-线路避雷器";case 31800001:""==l&&(l="站内-接地避雷器"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"jdblq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30600003:this.$set(t.properties,"psrName","站内-手车开关"),this.$set(t.properties,"psrNo",i+"ssc"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30100001:this.$set(t.properties,"psrName","主变压器-自耦"),this.$set(t.properties,"psrNo",i+"zobyq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000003:this.$set(t.properties,"psrName","站内-接地"),this.$set(t.properties,"psrNo",i+"jiedi"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 318e5:this.$set(t.properties,"psrName","站内-避雷器"),this.$set(t.properties,"psrNo",i+"blq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30500099:this.$set(t.properties,"psrName","配电-站内三工位断路器"),this.$set(t.properties,"psrNo",i+"sgwdlq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30100003:this.$set(t.properties,"psrName","主变压器-三绕组"),this.$set(t.properties,"psrNo",i+"srzbyq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 319e5:this.$set(t.properties,"psrName","站内-消弧装置"),this.$set(t.properties,"psrNo",i+"xhzz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 31400001:this.$set(t.properties,"psrName","站内-电容式电压互感器"),this.$set(t.properties,"psrNo",i+"drsdyhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 33e6:this.$set(t.properties,"psrName","站内-阻波器"),this.$set(t.properties,"psrNo",i+"zbq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30100005:this.$set(t.properties,"psrName","主变压器-有抽头自耦"),this.$set(t.properties,"psrNo",i+"srzzoktbyq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30900001:this.$set(t.properties,"psrName","站内-手车熔丝"),this.$set(t.properties,"psrNo",i+"scrs"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30600008:this.$set(t.properties,"psrName","站内-二工位刀闸"),this.$set(t.properties,"psrNo",i+"egwgldz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30900002:this.$set(t.properties,"psrName","站内-熔丝"),this.$set(t.properties,"psrNo",i+"zyrs"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 19000001:var h="";t.properties.hasOwnProperty("tagContent")&&-1!==t.properties.tagContent.indexOf("电厂")||t.properties.hasOwnProperty("name")&&-1!==t.properties.name.indexOf("电厂")?(h="qyfjdOfDc",l="电厂"):(h="qyfjd",l="站外-区域分界点"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+h),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 19000004:"02"==this.type?n="dy":"01"!=this.type&&"03"!=this.type||(n=""),this.$set(t.properties,"psrName","站外-电站虚拟电源点"),this.$set(t.properties,"psrNo",i+n+"dzxndyd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30600099:this.$set(t.properties,"psrName","站内-接地手车隔离开关"),this.$set(t.properties,"psrNo",i+"jdscglkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 301e5:this.$set(t.properties,"psrName","三绕组变压器(三角形-星形-星形连接)"),this.$set(t.properties,"psrNo",i+"srzbyqsjxxx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 117e5:this.$set(t.properties,"psrName","站外-线路故障指示器"),this.$set(t.properties,"psrNo",i+"xlgzzsq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 18000001:this.$set(t.properties,"psrName","低压-虚拟连接点"),this.$set(t.properties,"psrNo",i+"xnljd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 18e6:this.$set(t.properties,"psrName","站外-虚拟连接点"),this.$set(t.properties,"psrNo",i+"xnljd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 35000001:this.$set(t.properties,"psrName","低压站内-虚拟连接点"),this.$set(t.properties,"psrNo",i+"xnljd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 35e6:this.$set(t.properties,"psrName","站内-虚拟连接点"),this.$set(t.properties,"psrNo",i+"xnljd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 114e5:this.$set(t.properties,"psrName","柱上-重合器"),this.$set(t.properties,"psrNo",i+"zschq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 121e5:this.$set(t.properties,"psrName","柱上-电流互感器"),this.$set(t.properties,"psrNo",i+"zsdlhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 115e5:this.$set(t.properties,"psrName","柱上-跌落式熔断器"),this.$set(t.properties,"psrNo",i+"dlsrdq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 11500001:this.$set(t.properties,"psrName","柱上-负荷式熔断器"),this.$set(t.properties,"psrNo",i+"fhsdrq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 11500002:this.$set(t.properties,"psrName","柱上-自合式熔断器"),this.$set(t.properties,"psrNo",i+"zhsrdq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 12e6:this.$set(t.properties,"psrName","柱上-电压互感器"),this.$set(t.properties,"psrNo",i+"zsdyhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 113e5:this.$set(t.properties,"psrName","柱上-隔离开关"),this.$set(t.properties,"psrNo",i+"zsglkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 17e6:this.$set(t.properties,"psrName","站外-柱上高压计量箱"),this.$set(t.properties,"psrNo",i+"zsgyjlx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 118e5:this.$set(t.properties,"psrName","站外-组合式互感器"),this.$set(t.properties,"psrNo",i+"zhshgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 31200001:this.$set(t.properties,"psrName","站内-分裂电抗器"),this.$set(t.properties,"psrNo",i+"fldkq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3e7:this.$set(t.properties,"psrName","变电站"),this.$set(t.properties,"psrNo",i+"bdz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 343e5:this.$set(t.properties,"psrName","用户变电站"),this.$set(t.properties,"psrNo",i+"yhbdz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30000001:this.$set(t.properties,"psrName","换流站"),this.$set(t.properties,"psrNo",i+"hlz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30000004:this.$set(t.properties,"psrName","开关站"),this.$set(t.properties,"psrNo",i+"kgz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30000003:this.$set(t.properties,"psrName","发电厂"),this.$set(t.properties,"psrNo",i+"fdc"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30700001:this.$set(t.properties,"psrName","站内-熔断式负荷开关"),this.$set(t.properties,"psrNo",i+"rdsfhkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30700099:this.$set(t.properties,"psrName","手车负荷开关"),this.$set(t.properties,"psrNo",i+"scfhkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30600004:this.$set(t.properties,"psrName","站内-双向隔离开关"),this.$set(t.properties,"psrNo",i+"sxglkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30600005:this.$set(t.properties,"psrName","站内-熔断式隔离开关"),this.$set(t.properties,"psrNo",i+"rdsglkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 333e5:this.$set(t.properties,"psrName","站内-故障指示器"),this.$set(t.properties,"psrNo",i+"zngzzsq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 311e5:this.$set(t.properties,"psrName","站内-母线"),this.$set(t.properties,"psrNo",i+"mx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 315e5:this.$set(t.properties,"psrName","站内-组合互感器"),this.$set(t.properties,"psrNo",i+"znzhhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 39000005:this.$set(t.properties,"psrName","站内-间隙"),this.$set(t.properties,"psrNo",i+"jx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 339e5:this.$set(t.properties,"psrName","站内-隔直装置"),this.$set(t.properties,"psrNo",i+"zngzzz"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 209e5:this.$set(t.properties,"psrName","站外-电缆分支箱"),this.$set(t.properties,"psrNo",i+"dlfzxzw"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 206e5:this.$set(t.properties,"psrName","站外-电缆交叉互联箱"),this.$set(t.properties,"psrNo",i+"dljchlx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 205e5:this.$set(t.properties,"psrName","站外-电缆接地箱"),this.$set(t.properties,"psrNo",i+"dljdx"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 2505e5:this.$set(t.properties,"psrName","直流-电流互感器"),this.$set(t.properties,"psrNo",i+"zldlhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 311300001:this.$set(t.properties,"psrName","低压-虚拟熔丝"),this.$set(t.properties,"psrNo",i+"xnrs"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 321500098:this.$set(t.properties,"psrName","低压-站内手车"),this.$set(t.properties,"psrNo",i+"dyznsc"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3203e5:this.$set(t.properties,"psrName","低压-电缆中间接头"),this.$set(t.properties,"psrNo",i+"dlzjjtdd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3109e5:this.$set(t.properties,"psrName","低压柱上-避雷器"),this.$set(t.properties,"psrNo",i+"dyblq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3108e5:this.$set(t.properties,"psrName","低压柱上-电容器"),this.$set(t.properties,"psrNo",i+"dydrq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3104e5:l="低压柱上-负荷开关";case 321500002:""==l&&(l="低压站内-负荷开关"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"dyfhkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 310300001:this.$set(t.properties,"psrName","低压柱上-隔离开关"),this.$set(t.properties,"psrNo",i+"dyzsglkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3205e5:this.$set(t.properties,"psrName","低压-电缆分支箱"),this.$set(t.properties,"psrNo",i+"dydlfzxzw"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 10300001:"02"==this.type?n="dy":"01"!=this.type&&"03"!=this.type||(n=""),this.$set(t.properties,"psrName","耐张-物理杆塔"),this.$set(t.properties,"psrNo",i+n+"nzwlgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 103e5:this.$set(t.properties,"psrName","直线-物理杆塔"),this.$set(t.properties,"psrNo",i+"zxwlgt"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3312e5:this.$set(t.properties,"psrName","低压-避雷器"),this.$set(t.properties,"psrNo",i+"dyznblq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 3309e5:this.$set(t.properties,"psrName","低压站内-电流互感器"),this.$set(t.properties,"psrNo",i+"dyzndlhgq"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 321500097:this.$set(t.properties,"psrName","低压-手车负荷开关"),this.$set(t.properties,"psrNo",i+"dyscfhkg"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 4107e5:this.$set(t.properties,"psrName","用电-高压用户点"),this.$set(t.properties,"psrNo",i+"gyyhd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 13e6:l="站外-连接线";case 13000001:""==l&&(l="低压站外-连接线"),this.$set(t.properties,"psrName",l),this.$set(t.properties,"psrNo",i+"shiLine"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 15e6:this.$set(t.properties,"psrName","站外-分布式电源"),this.$set(t.properties,"psrNo",i+"zwfbsdy"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 16e6:this.$set(t.properties,"psrName","站外-柱上配变监测仪"),this.$set(t.properties,"psrNo",i+"zwzspbjcy"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 19000003:this.$set(t.properties,"psrName","站外-空中T节点"),this.$set(t.properties,"psrNo",i+"zwkztjd"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 21e6:this.$set(t.properties,"psrName","站外-交叉跨越"),this.$set(t.properties,"psrNo",i+"zwjcky"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 22e6:this.$set(t.properties,"psrName","站外-接地环"),this.$set(t.properties,"psrNo",i+"zwjdh"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;case 30000031:this.$set(t.properties,"psrName","储能站"),this.$set(t.properties,"psrNo",i+"xiang"),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break;default:"LineString"==t.geometry.type?(this.$set(t.properties,"psrName","连接线"),this.$set(t.properties,"psrNo",i+"shiLine")):"Polygon"==t.geometry.type?(this.$set(t.properties,"psrName","箱"),this.$set(t.properties,"psrNo",i+"xiang")):(this.$set(t.properties,"psrName","其他"),this.$set(t.properties,"psrNo",i+"qt")),this.setInPolygonPsrAndSelfData(t,e,i,r,o);break}a==s&&this.toLoadFlLayer(e,o)},setInPolygonPsrAndSelfData:function(t,e,i,r,a){this.addToFenleiData(t,e,i,r);var s=t.properties.psrNo,o=0,n="",l="",h="map",p="tqDataFl";if(e)if("string"==typeof e){var d=i+"TqGeoFl";this[d][s].length>0&&(n=this[d][s][0].geometry.type),l=i,p=d}else this.otherTqGeoFl[s].length>0&&(n=this.otherTqGeoFl[s][o].geometry.type),l="other",p="otherTqGeoFl";else o=t.properties.dataInTypeIndex,n=this.tqDataFl[s][o].geometry.type,this.isYxyh&&(l="yunjian");var c=this.getMapPixelM(h),g=0;if("Point"==n&&this.toRequirePic(o,s,i,a),"Polygon"==t.geometry.type&&"bdz"==t.properties.psrObjFlType&&"other"!==l&&t.properties.hasOwnProperty("connection")&&""!==t.properties.connection){var y=l+"bdzdyd",f="";""==l||"yunjian"==l?(f="tqDataFl",t.properties.customOpacity=0,t.properties.customLightOpacity=0):(f=l+"TqGeoFl",t.properties.customOpacity=0),this[f].hasOwnProperty(y)||this.$set(this[f],y,[]);var u=this.getPolygonCenterZb(t.geometry.coordinates),m={type:t.type,properties:JSON.parse(JSON.stringify(t.properties)),geometry:{type:"Point",coordinates:u}},D=this[f][y].length;this.$set(m.properties,"relateMian",{layerId:t.properties.psrNo,onItemIndex:t.properties.dataInTypeIndex}),this.$set(t.properties,"relateDyd",{layerId:y,onItemIndex:D}),m.properties.psrNo=y,m.properties.connection="",m.properties.id=m.properties.id+"_dyd",m.properties.dataInTypeIndex=D,m.properties.hasOwnProperty("symbolSize")?m.properties.symbolSize=3:this.$set(m.properties,"symbolSize",3),""==l||"yunjian"==l?(m.properties.customOpacity=1,m.properties.customLightOpacity=1):m.properties.customOpacity=1,this[f][y].push(m),this.toRequirePic(o,y,i,""),this.psrIconSize.hasOwnProperty(y)||(g=this.setPsrIconSize(y,0,c,f),this.$set(this.psrIconSize,y,g))}t.properties.hasOwnProperty("parentPole")&&-1==t.properties.id.indexOf("_yxgt")&&(t.properties.id=t.properties.id+"_yxgt"),this.psrIconSize.hasOwnProperty(s)||(g=this.setPsrIconSize(s,0,c,p),this.$set(this.psrIconSize,s,g)),e||5==t.properties.systemType&&-1==t.properties.psrNo.indexOf("other")&&(this.$set(t.properties,"deviceType","yxsb"),this.marketData.push(t))},addToFenleiData:function(t,e,i,r){var a=t.properties.psrNo,s="",o="",n="";s=e?i+"TqGeoFl":"tqDataFl";var l=a.replace(i,"");if(this.$set(t.properties,"psrObjFlType",l),t.properties.hasOwnProperty("symbolId")&&("Point"==t.geometry.type&&!t.properties.hasOwnProperty("parentPole")||("LineString"==t.geometry.type||"MultiLineString"==t.geometry.type)&&t.properties.hasOwnProperty("psrType")&&""!==t.properties.psrType&&"dyznmx"!==l&&"mx"!==l&&"dianLine"!==l&&"daoLine"!==l&&"xuLine"!==l)){var h=t.properties.symbolId.split("-"),p=h.length,d=h[p-1];"1247f0fcaf04"!=d&&"daf303ef9d0f"!=d||(d="f970b1dbfe8a"),"1d8df9d4454f"!=d&&"04b0ab8a4928"!=d||(d="5eab3768a97a"),"dfaacaf16172"!=d&&"e3ff45c1a3e9"!=d||(d="74dce86f42a1"),"7e64b199134c"==d&&(d="d5fd5b224391"),"4d9aec15c965"==d&&(d="3cd5a098995e"),"f059f7665189"==d&&(d="354187fb41ae"),"8688ac6ada3c"==d&&(d="e679342e9a7b"),"a40059f59581"==d&&(d="bee89acff711"),"80c65471a5e8"==d&&(d="0328ec81b525"),"c1dbf82f40bf"==d&&(d="0360f1546903"),"48ca090a34d3"==d&&(d="a70d5d4e02a3"),"20eeaa39a2dc"==d&&(d="b2a1dd60d97d"),"023f585bb92b"==d&&(d="0b520ba681b2"),"20eeaa39a2dc"==d&&(d="b2a1dd60d97d"),"023f585bb92b"==d&&(d="0b520ba681b2"),n=i+d+o}if(""!==n&&(t.properties.psrNo=n,a=n,t.properties.hasOwnProperty("psrType")&&-1!=t.properties.psrType.indexOf("wlgt")&&-1==this.wlgtPsrStretchStr.indexOf(a.replace(i,""))&&("xl"==this.lineType?(n=i+"3cd5a098995e"+o,10300001==t.properties.objType||310200001==t.properties.objType?(t.properties.psrNo=n,a=n):(n=i+"d5fd5b224391"+o,t.properties.psrNo=n,a=n)):10300001==t.properties.objType||310200001==t.properties.objType?(n=i+"e679342e9a7b"+o,t.properties.psrNo=n,a=n):(n=i+"354187fb41ae"+o,t.properties.psrNo=n,a=n)),"zdt"==l&&(n=i+"989195e9beca"+o,t.properties.psrNo=n,a=n),"dlzjjtdd"==l&&(n=i+"b6b5c1273b83"+o,t.properties.psrNo=n,a=n)),this[s].hasOwnProperty(a)){if(this[s][a].length>0&&this[s][a][0].geometry.type!==t.geometry.type&&"Point"!==this[s][a][0].geometry.type&&!this[s][a][0].properties.hasOwnProperty("oldLineToDianIndex")){var c=t.geometry.type;a+=c,t.properties.psrNo=a,this[s].hasOwnProperty(a)||this.$set(this[s],a,[])}}else this.$set(this[s],a,[]);var g=this[s][a].length;if(this.$set(t.properties,"dataInTypeIndex",g),this.$set(t.properties,"taiquNo",r),!t.properties.hasOwnProperty("psrType")||""===t.properties.psrType||"LineString"!=t.geometry.type&&"MultiLineString"!=t.geometry.type||"dyznmx"===l||"mx"===l||"dianLine"===l||"daoLine"===l||"xuLine"===l||"shiLine"===a.replace(i,""))this[s][a].push(t);else{this.oldLineToDian.hasOwnProperty(a)||this.$set(this.oldLineToDian,a,[]);var y=this.oldLineToDian[a].length;this.$set(t.properties,"oldLineToDianIndex",y),this.oldLineToDian[a].push(JSON.parse(JSON.stringify(t)));var f=[];f="MultiLineString"==t.geometry.type?t.geometry.coordinates[0][1]:t.geometry.coordinates[1];var u={type:t.type,properties:t.properties,geometry:{type:"Point",coordinates:f}};this[s][a].push(u)}},getdydjPic:function(t,e){var i=null;return void 0==e||(e<=11&&(i="1_11-"+t),12<=e&&e<=23&&(i="12_23-"+t),24==e&&(i="24_24-"+t),25==e&&(i="25_25-"+t),30<=e&&e<=31&&(i="30_31-"+t),32==e&&(i="32_32-"+t),33==e&&(i="33_33-"+t),34==e&&(i="34_34-"+t),35==e&&(i="35_35-"+t),36==e&&(i="36_36-"+t),37==e&&(i="37_37-"+t),50<=e&&e<=99&&(i="50_99-"+t)),i},toRequirePic:function(t,e,r,a){var s="tqDataFl";if(a&&""!==a&&("other"==r&&e.replace(r,""),s=r+"TqGeoFl"),console.info("---------图片引入",e,r,a),console.log("-----this信息",e,s,t,this),!this.picsData.hasOwnProperty(e)){var o=null,n="",l="",h="",p="",d=(this[s],this[s][e][t].properties.picItem),c=d+e;n="ahgis/gl-new/"+e+".png",l="ahgis/all/"+c+".png",h="ahgis/all/"+d+"notFindPic.png",p="ahgis/gl-new/notFindPic.png";try{o={itemImg:i("6b6a")("./"+l),itemLightImg:i("6b6a")("./"+n)}}catch(g){o={itemImg:i("6b6a")("./"+h),itemLightImg:i("6b6a")("./"+p)}}this.$set(this.picsData,e,o)}},toLoadFlLayer:function(t,e){if(t)"string"==typeof t?(this[t+"TqGeoFl"].hasOwnProperty(t+"bdzdyd")&&this.setDydLine(t),"zhoubian"!==t&&(this.getDcGeoSamePsrAndSet(t),""!==this.preDcGeoFlName&&this.preDcGeoFlName!==t&&this.compareAndChangeSamePsrZb(t),this.preDcGeoFlName=t,this.oldTqDataFl=JSON.parse(JSON.stringify(this.tqDataFl))),this.initTqLayer(this[t+"TqGeoFl"],t,e)):(""!==this.znsbOnStation.item&&this.toChangeZnsbZb(),this.initTqLayer(this.otherTqGeoFl,t,e));else{this.setPsrInLineIndex(),this.tqDataFl.hasOwnProperty("bdzdyd")&&this.setDydLine(),this.tqDataFl.hasOwnProperty("yunjianbdzdyd")&&this.setDydLine("yunjian"),this.queryPhysicsGt();try{this.initTqLayer(this.tqDataFl)}catch(i){console.log(i)}this.tucengKzTree(),this.getSamePoleDetail(),this.oldTqDataFl=JSON.parse(JSON.stringify(this.tqDataFl)),this.originalTqData=JSON.parse(JSON.stringify(this.tqDataFl))}this.bindLayerDianlan()},toChangeZnsbZb:function(){var t=this.getPolygonCenterZb(this.tqDataFl[this.znsbOnStation.item][this.znsbOnStation.index].geometry.coordinates),e=[],i=[];for(var r in this.otherTqGeoFl)this.otherTqGeoFl[r].length>0&&("Polygon"==this.otherTqGeoFl[r][0].geometry.type?e=this.getPolygonCenterZb(this.otherTqGeoFl[r][0].geometry.coordinates):i=i.concat(this.otherTqGeoFl[r]));0==e.length&&(e=this.getPolygonCenterZb(this.originalTqData[this.znsbOnStation.item][this.znsbOnStation.index].geometry.coordinates));var a=t[0]-e[0],s=t[1]-e[1];if(0!==a||0!==s)for(var o=i.length,n=0;n<o;n++)this.resetFlyPoint(i[n],a,s,"otherTqGeoFl")},getDcGeoSamePsrAndSet:function(t){var e=this;if(console.log("对侧线类型-------------",t),null!=this.samePoleData){var i=t+"TqGeoFl",r=this.getAllLineData(this[i]),a=[],s=[];for(var o in this.samePoleData)if(this.samePoleData[o].length>0)if(s=s.concat(this.samePoleData[o]),"attchs"==o){var n=this.samePoleData[o],l=n.length;a=this.getGtArrData(i);for(var h=a.wlgt,p=a.yxgt,d=h.length,c=p.length,g=0;g<l;g++)if(n[g].hasOwnProperty("tqOfTongganPsr")){var y=n[g].tqOfTongganPsr.item,f=n[g].tqOfTongganPsr.index;if(this.tqDataFl[y][f].properties.hasOwnProperty("dcNeedChangePsr")||this.$set(this.tqDataFl[y][f].properties,"dcNeedChangePsr",[]),this.tqDataFl[y][f].properties.hasOwnProperty("psrPoledInf"))for(var u=this.tqDataFl[y][f].properties.psrPoledInf,m=u.length,D=0;D<m;D++){var b=0,x=0;if("wlgt"==u[D].type){var v=u[D].layerId,L=u[D].dataIndex,I=this.tqDataFl[v][L].properties.psrId,P=!1;if(d>0)for(var F=0;F<d;F++)if(I==h[F].properties.psrId){var T=h[F].properties.id,q=h[F].properties.psrNo,O=h[F].properties.dataInTypeIndex,S=h[F].geometry.type,N={id:t+T,item:q,index:O,zbType:S,dataFlType:i};if(this.tqDataFl[y][f].properties.dcNeedChangePsr.push(N),""==this.preDcGeoFlName&&JSON.stringify(this[i][q][O].geometry.coordinates)!==JSON.stringify(this.tqDataFl[y][f].geometry.coordinates)){var w=JSON.parse(JSON.stringify(this[i][q][O].geometry.coordinates));this[i][q][O].geometry.coordinates=JSON.parse(JSON.stringify(this.tqDataFl[y][f].geometry.coordinates)),b=this[i][q][O].geometry.coordinates[0]-w[0],x=this[i][q][O].geometry.coordinates[1]-w[1]}this[i][q][O].properties.customOpacity=0,P=!0;break}if(!P&&c>0&&""==this.preDcGeoFlName&&JSON.stringify(this.originalTqData[y][f].geometry.coordinates)!==JSON.stringify(this.tqDataFl[y][f].geometry.coordinates)){var A=JSON.parse(JSON.stringify(this.originalTqData[y][f].geometry.coordinates));b=this.tqDataFl[y][f].geometry.coordinates[0]-A[0],x=this.tqDataFl[y][f].geometry.coordinates[1]-A[1]}if(c>0)for(var C=0;C<c;C++)if(I==p[C].properties.parentPole){var z=p[C].properties.id,k=p[C].properties.psrNo,j=p[C].properties.dataInTypeIndex,$=p[C].geometry.type,R={id:t+z,item:k,index:j,zbType:$,dataFlType:i};this.tqDataFl[y][f].properties.dcNeedChangePsr.push(R);var B=JSON.parse(JSON.stringify(n[g]));if(0!==b||0!==x){B["dcOfTgYxgtPsr"]={item:k,index:j,dlng:b,dlat:x};var G=JSON.parse(JSON.stringify(this[i][k][j].geometry.coordinates));this[i][k][j].geometry.coordinates[0]=G[0]+b,this[i][k][j].geometry.coordinates[1]=G[1]+x}else B["dcOfTgYxgtPsr"]={item:k,index:j};s.push(B)}break}}}}else{var E=[];E="outLine"==o?this.getAllPolygonData(this[i]):this.getAllPointData(this[i]);var V=E.length,J=this.samePoleData[o],M=J.length;if(V>0&&M>0)for(var _=0;_<M;_++)if(J[_].hasOwnProperty("tqOfTongganPsr"))for(var Z=J[_].tqOfTongganPsr.item,Y=J[_].tqOfTongganPsr.index,K=0;K<V;K++)if(E[K].properties.hasOwnProperty("psrId")&&E[K].properties.psrId==this.tqDataFl[Z][Y].properties.psrId){var H=E[K].properties.psrNo,U=E[K].properties.dataInTypeIndex;this[i][H][U].properties.customOpacity=0,this[i][H][U].properties.hasOwnProperty("customSymbolOpacity")&&(this[i][H][U].properties.customSymbolOpacity=0);break}}for(var W=s.length,X=r.length,Q=function(){var a="",o="",n=0,l=0,h=0;if(s[tt].hasOwnProperty("tqOfTongganPsr"))if(o=s[tt].tqOfTongganPsr.item,n=s[tt].tqOfTongganPsr.index,s[tt].hasOwnProperty("dcOfTgYxgtPsr")){var p=s[tt].dcOfTgYxgtPsr.item,d=s[tt].dcOfTgYxgtPsr.index;e[i][p][d].properties.hasOwnProperty("connection")&&(a=e[i][p][d].properties.connection),s[tt].dcOfTgYxgtPsr.hasOwnProperty("dlng")&&(l=s[tt].dcOfTgYxgtPsr.dlng,h=s[tt].dcOfTgYxgtPsr.dlat)}else{var c=s[tt].tqOfTongganPsr.item,g=s[tt].tqOfTongganPsr.index;e.tqDataFl[c][g].properties.hasOwnProperty("connection")&&(a=e.tqDataFl[c][g].properties.connection)}if(""==a||""==o)return 1;for(var y=a.split(","),f=y.length,u=0;u<X;u++){var m="",D=0;if(r[u].properties.hasOwnProperty("connection")&&(m=r[u].properties.connection,D=r[u].geometry.coordinates.length),""!=m)for(var b=m.split(","),x=b.length,v=0;v<f;v++)for(var L=function(){if(""!==y[v]&&y[v]==b[I]){e.tqDataFl[o][n].properties.hasOwnProperty("dcNeedChangePsr")||e.$set(e.tqDataFl[o][n].properties,"dcNeedChangePsr",[]);var a=r[u].properties.id,s=r[u].properties.psrNo,p=r[u].properties.dataInTypeIndex,d=r[u].geometry.type,c={id:t+a,item:s,index:p,zbType:d,onLineIndex:0,dataFlType:i};0!==I&&(c.onLineIndex=D-1);var g=e.tqDataFl[o][n].properties.dcNeedChangePsr.length;return 0==g?e.tqDataFl[o][n].properties.dcNeedChangePsr.push(c):e.dataProToCompareArr(c,e.tqDataFl[o][n].properties.dcNeedChangePsr,!1,(function(){if(e.tqDataFl[o][n].properties.dcNeedChangePsr.push(c),0!==l||0!==h){var t=JSON.parse(JSON.stringify(e[i][s][p].geometry.coordinates));e[i][s][p].geometry.coordinates[c.onLineIndex][0]=t[c.onLineIndex][0]+l,e[i][s][p].geometry.coordinates[c.onLineIndex][1]=t[c.onLineIndex][1]+h}})),1}},I=0;I<x;I++)if(L())break}},tt=0;tt<W;tt++)Q()}},compareAndChangeSamePsrZb:function(t){var e=this,i=t+"TqGeoFl",r=[],a=this.preDcGeoFlName+"TqGeoFl";for(var s in this[a])this[a][s].length>0&&(r=r.concat(this[a][s]));var o=function(){if(e[i][n].length>0)for(var t=e[i][n],a=t.length,s=function(a){e.dataToCompareArr(t[a],r,(function(s){if(JSON.stringify(t[a].geometry.coordinates)!==JSON.stringify(r[s].geometry.coordinates)){var o=t[a].properties.psrNo,n=t[a].properties.dataInTypeIndex;e[i][o][n].geometry.coordinates=JSON.parse(JSON.stringify(r[s].geometry.coordinates))}}))},o=0;o<a;o++)s(o)};for(var n in this[i])o()},allAddToSpatialIndex:function(){var t={type:"FeatureCollection",crs:this.tqData.crs,features:[]};for(var e in this.tqDataFl)this.tqDataFl[e].length>0&&(t.features=t.features.concat(this.tqDataFl[e]));for(var i=new L["a"],r=i.readFeatures(t),a=0;a<r.length;a++){var s=r[a],o=s.get("id");s.setId(o)}this.vectorSource=new v["a"],this.vectorSource.addFeatures(r)},setPsrInLineIndex:function(){for(var t=this,e=this.getAllNotLineData(this.tqDataFl),i=this.getAllLineData(this.tqDataFl),r=e.length,a=i.length,s=function(){var s=i[o].geometry.coordinates,n=s.length;if(n>2&&0==Math.abs(s[n-2][0]-s[n-1][0]).toFixed(7)&&0==Math.abs(s[n-2][1]-s[n-1][1]).toFixed(7)&&(i[o].geometry.coordinates.splice(n-2,1),console.log("断线--------a--------",i[o].properties.id)),!i[o].properties.hasOwnProperty("connection")||""==i[o].properties.connection)return 1;var l=i[o].properties.connection.split(","),h=l.length;h>1&&l[0]==l[1]&&(l.splice(0,h-1,""),!0,console.log("关联关系的值相等：------------------",JSON.stringify(i[o]),JSON.stringify(l))),n=i[o].geometry.coordinates.length;for(var p=i[o].properties.id,d=i[o].properties.psrNo,c=i[o].properties.dataInTypeIndex,g=function(){if(e[y].properties.hasOwnProperty("connection")&&""!==e[y].properties.connection)for(var i=e[y].properties.id,r=e[y].properties.psrNo,a=e[y].properties.dataInTypeIndex,s=e[y].properties.connection.split(","),o=s.length,g=function(){for(var e={},g={},y=!1,u=0;u<o;u++)if(""!==l[f]&&s[u]==l[f]){0==f?(e={id:p,onLineIndex:0,layerName:d,onTqFlIndex:c},g={id:i,onLineIndex:0,layerName:r,onTqFlIndex:a},y=!0):f>0&&(e={id:p,onLineIndex:n-1,layerName:d,onTqFlIndex:c},g={id:i,onLineIndex:n-1,layerName:r,onTqFlIndex:a},y=!0);break}return y&&(t.tqDataFl[r][a].properties.hasOwnProperty("ofLineArr")||t.$set(t.tqDataFl[r][a].properties,"ofLineArr",[]),t.dataProToCompareArr(e,t.tqDataFl[r][a].properties.ofLineArr,!1,(function(){t.tqDataFl[r][a].properties.ofLineArr.push(e)})),t.tqDataFl[d][c].properties.hasOwnProperty("ofPsrArr")||t.$set(t.tqDataFl[d][c].properties,"ofPsrArr",[]),t.tqDataFl[d][c].properties.ofPsrArr.length<h&&t.dataProToCompareArr(g,t.tqDataFl[d][c].properties.ofPsrArr,!1,(function(){t.tqDataFl[d][c].properties.ofPsrArr.push(g)}))),1},f=0;f<h;f++)g()},y=0;y<r;y++)g();if(t.tqDataFl[d][c].properties.hasOwnProperty("ofPsrArr")&&t.tqDataFl[d][c].properties.ofPsrArr.length<h&&t.tqDataFl[d][c].properties.ofPsrArr.length>0){var f=t.tqDataFl[d][c].properties.ofPsrArr,u="",m=null;0==f[0].onLineIndex?(u=l[1],m=t.tqDataFl[d][c].geometry.coordinates.length-1):(u=l[0],m=0);for(var D=0;D<a;D++)if(i[D].properties.hasOwnProperty("ofPsrArr")&&1==i[D].properties.ofPsrArr.length||!i[D].properties.hasOwnProperty("ofPsrArr")){if(i[D].properties.hasOwnProperty("parentStation"))continue;for(var b=i[D].properties.connection.split(","),x=b.length,v=function(){if(b[L]==u&&i[D].properties.id!==i[o].properties.id){var e=i[D].properties.id,r=i[D].properties.psrNo,a=i[D].properties.dataInTypeIndex,s={id:e,onLineIndex:m,layerName:r,onTqFlIndex:a},n={id:p,onLineIndex:L,layerName:d,onTqFlIndex:c};return t.tqDataFl[d][c].properties.hasOwnProperty("ofLineArr")||t.$set(t.tqDataFl[d][c].properties,"ofLineArr",[]),t.dataProToCompareArr(s,t.tqDataFl[d][c].properties.ofLineArr,!1,(function(){t.tqDataFl[d][c].properties.ofLineArr.push(s)})),t.tqDataFl[r][a].properties.hasOwnProperty("ofLineArr")||t.$set(t.tqDataFl[r][a].properties,"ofLineArr",[]),t.dataProToCompareArr(n,t.tqDataFl[r][a].properties.ofLineArr,!1,(function(){t.tqDataFl[r][a].properties.ofLineArr.push(n)})),1}},L=0;L<x;L++)if(v())break}}},o=0;o<a;o++)s()},setDydLine:function(t){var e=[],i="";for(var r in t?i="zhoubian"==t?"zhoubianTqGeoFl":"yunjian"==t?"tqDataFl":t+"TqGeoFl":(t="",i="tqDataFl"),this[i])r==t+"bdzdyd"&&this[i][r].length>0&&(e=this[i][r]);for(var a=e.length,s=0;s<a;s++){var o=e[s].properties.relateMian,n=o.layerId,l=o.onItemIndex,h=JSON.parse(JSON.stringify(e[s].geometry.coordinates)),p=[];p="tqDataFl"==i&&this.tqDataFl[n][l].properties.hasOwnProperty("ofLineArr")?this[i][n][l].properties.ofLineArr:this.getRelationZhoubianbdzLine(this[i][n][l],i);for(var d=p.length,c=0;c<d;c++){var g=p[c].layerName,y=p[c].onTqFlIndex,f=p[c].onLineIndex,u=JSON.parse(JSON.stringify(this[i][g][y].geometry.coordinates[f]));this.$set(this[i][g][y].properties,"oldOnBdzPoint",{zb:u,onLineIndex:f}),this[i][g][y].geometry.coordinates[f]=h}}},getRelationZhoubianbdzLine:function(t,e){if(t.properties.hasOwnProperty("connection")&&""!=t.properties.connection){for(var i=this.getAllLineData(this[e]),r=i.length,a=[],s=0;s<r;s++)if(i[s].properties.hasOwnProperty("connection")&&""!==i[s].properties.connection)for(var o=i[s].properties.connection.split(","),n=o.length,l=t.properties.connection,h=0;h<n;h++)if(""!==o[h]&&-1!==l.indexOf(o[h])){var p=0;0!=h&&(p=i[s].geometry.coordinates.length-1);var d={id:i[s].properties.id,onLineIndex:p,layerName:i[s].properties.psrNo,onTqFlIndex:i[s].properties.dataInTypeIndex};a.push(d);break}return a}},dataProToCompareArr:function(t,e,i,r){for(var a=e.length,s=!1,o=0;o<a;o++)if(t.id==e[o].id){i&&i(o),s=!0;break}s||r&&r()},tucengKzTree:function(){var t=this,e=[];this.tucengData=[],this.operateLayer=[],this.deviceLayer=[],0!==this.psrIds.length&&("dkx"==this.lineType?this.tucengData=[{id:"zhoubian",label:"同站其他馈线",type:"zhoubian",children:[]}]:"dytq"==this.lineType&&(this.tucengData=[{id:"zhoubian",label:"同台区其他设备",type:"zhoubian",children:[]}]));var i=[];if(this.tqDataFl.hasOwnProperty("qt")&&console.log("tqDataFl:--分类--qt-",JSON.stringify(this.tqDataFl.qt)),this.marketData.length>0){var r={id:"yingxiao",label:"营销设备",type:"yingxiao",children:[]};this.tucengData.push(r),this.deviceLayer.push(r),("03"==this.type||this.isYxyh)&&e.push(r.id)}for(var a in this.tqDataFl){var s={};if(this.tqDataFl[a].length>0&&"bdzdyd"!==a){var o=this.tqDataFl[a][0].properties.psrObjFlType;s={id:a,label:this.tqDataFl[a][0].properties.psrName,type:a,svgClass:o,children:[]},this.tucengData.push(s),this.deviceLayer.push(s),e.push(s.id),"shiLine"!==a&&"xuLine"!==a&&(!this.isYxyh||this.isYxyh&&-1==a.indexOf("yunjian"))&&i.push(JSON.parse(JSON.stringify(s)))}}this.operateLayer=this.tucengData.filter((function(e){return!t.deviceLayer.includes(e)})),this.$nextTick((function(){t.defaultCheckedKeys=e,t.$refs.leftPanel.updateTreeChildren(t.leftTreeData[0].id,i),t.setLeftTreeData()})),this.toLoadOtherTqGeo()},setLeftTreeData:function(){for(var t in this.tqDataFl){var e=this.tqDataFl[t];if(e.length>0&&"bdzdyd"!==t){for(var i=[],r=e.length,a=0;a<r;a++){var s=null,o="";5==e[a].properties.systemType&&(o="营销设备-"),e[a].properties.hasOwnProperty("name")&&""!==e[a].properties.name?s={id:e[a].properties.id,label:o+e[a].properties.name,type:t,onDataIndex:e[a].properties.dataInTypeIndex}:e[a].properties.hasOwnProperty("tagContent")&&""!==e[a].properties.tagContent?s={id:e[a].properties.id,label:o+e[a].properties.tagContent,type:t,onDataIndex:e[a].properties.dataInTypeIndex}:e[a].properties.hasOwnProperty("psrId")&&""!==e[a].properties.psrId&&(s={id:e[a].properties.id,label:o+e[a].properties.psrId,type:t,onDataIndex:e[a].properties.dataInTypeIndex}),i.push(s)}this.$refs.leftPanel.updateTreeChildren(t,i)}}if(this.marketData.length>0&&"03"!==this.type){var n="营销设备-";this.isYxyh&&(n="",!0),this.filterText=n,this.$refs.leftPanel.packUpTreeNode()}},getConnectJlxLine:function(){for(var t=this.tqDataFl["jlx"],e=t.length,i=0;i<e;i++)if(t[i].properties.hasOwnProperty("ofLineArr"))for(var r=t[i].properties.ofLineArr,a=r.length,s=t[i].properties.customOpacity,o=t[i].properties.customLightOpacity,n=0;n<a;n++){var l=r[n].layerName,h=r[n].onTqFlIndex;this.tqDataFl[l][h].properties.customOpacity=s,this.tqDataFl[l][h].properties.customLightOpacity=o,this.isYxyh&&(this.tqDataFl[l][h].properties.customLineColor=this.colorVal),this.$set(this.tqDataFl[l][h].properties,"deviceType","yxsb"),this.marketData.push(this.tqDataFl[l][h])}},queryRepeatDydDelete:function(t,e){for(var i=e.length,r=!1,a=0,s=0;s<i;s++)if(e[s].properties.id==t.properties.id&&e[s].properties.objType==t.properties.objType&&(a++,a>1)){r=!0;break}return r},initTqLayer:function(t,e,i){var r=this,a="";e&&(a="string"==typeof e?e:"other");var s=t,o="bdzdyd";for(var n in""!==a&&"other"!==a&&(o=a+o),s)s[n].length>0&&"Polygon"!==s[n][0].geometry.type&&n!==o&&this.toDrawTqLayer(s[n][0],n,s[n],"",e,i);for(var l in s)s[l].length>0&&"Polygon"==s[l][0].geometry.type&&"other"!==a&&(s.hasOwnProperty(o)&&"bdz"!==l.replace(a,"")||!s.hasOwnProperty(o))&&this.toDrawTqLayer(s[l][0],l,s[l],"",e,i);s.hasOwnProperty(o)&&s[o].length>0&&this.toDrawTqLayer(s[o][0],o,s[o],"",e,i),setTimeout((function(){"02"==r.type?void 0!==r.map.getLayer("dynzwlgt")&&void 0!==r.map.getLayer("dynzyxgt")&&r.map.moveLayer("dynzwlgt","dynzyxgt"):(void 0!==r.map.getLayer("nzwlgt")&&void 0!==r.map.getLayer("nzyxgt")&&r.map.moveLayer("nzwlgt","nzyxgt"),void 0!==r.map.getLayer("zhoubianbdzdyd")&&void 0!==r.map.getLayer("bdzdyd")&&r.map.moveLayer("zhoubianbdzdyd","bdzdyd"))}),1e3),this.loading=!1,this.layerTipsShow=!1,e||this.styleChangeFlag||(this.flyingTableData=[],this.getTooLongLineFn("fb"))},toDrawTqLayer:function(t,e,i,r,a,s){if("Point"==t.geometry.type){var o="",n="";if(n=a?e.replace("other",""):e,void 0!==this.picsData[n]&&(o="light"==r?this.picsData[n].itemLightImg:this.picsData[n].itemImg),""!==o&&void 0!==o)this.setPointImgLayer(r+e,i,o,{size:this.iconSize,minZoom:this.layerMinZoom},s);else{var l="",h=6;l=""!==r?this.lightColorVal:this.colorVal,"ljd"==e?h=4:"BigDian"==e?(h=8,l="#fbb131",this.map.on("mousedown","light"+e,this.dragDian)):"SmallDian"==e&&(h=6,l="#fbb131",this.map.on("mousedown","light"+e,this.dragDian)),this.setPointLayer(r+e,i,{circleRadius:h,circleColor:l,circleStrokeColor:l,minZoom:this.layerMinZoom},s)}}else if("LineString"==t.geometry.type||"MultiLineString"==t.geometry.type){var p=e;a&&(p="string"==typeof a?e.replace(a,""):e.replace("other","")),-1!==p.indexOf("yunjian")&&(p=e.replace("yunjian","")),"dianLine"==p?this.setLineLayer(r+e,i,{lineWidth:3,lineDasharray:[3,2],minZoom:this.layerMinZoom},s):this.setLineLayer(r+e,i,{lineWidth:3,minZoom:this.layerMinZoom},s)}else{var d="",c="";""!==r?(d=this.lightColorVal,c="rgba(255, 208, 75, 0.8)"):"string"==typeof a&&-1!==e.indexOf(a)||-1!==e.indexOf("yunjian")?(d="#ccc",c="rgba(204,204,204,0.2)"):("02"==this.type?c="rgba(0, 204, 255, 0.2)":"01"!=this.type&&"03"!=this.type||(c="rgba(186, 71, 64, 0.2)"),d=this.colorVal),this.setPolygonLayer(r+e,i,{fillColor:c,fillOutlineColor:d,minZoom:this.layerMinZoom},s),""==r&&this.setPolygenSymbol(e+"-symbol",i,{textColor:d}),s||this.map.on("contextmenu",e,this.onRightClick)}if(a)"string"==typeof a&&this.map.on("mousedown",e,this.dragBx);else if(this.canDragPrs.length>0){for(var g=this.canDragPrs.length,y=0;y<g;y++)if(e==this.canDragPrs[y]){this.map.on("mousedown",e,this.dragBx);break}}else this.map.on("mousedown",e,this.dragBx),this.bindLayerCursorStyle(e);"bdz"==e&&this.map.on("mousedown",e+"-symbol",this.dragBx)},setPointImgLayer:function(t,e,i,r,a,s){var o=this;if(r.iconAnchor||(r.iconAnchor="center"),r.minZoom||(r.minZoom=2),void 0!=i){var n="";n=a||"map",this[n].loadImage(i,(function(i,l){o[n].getLayer(t)&&o[n].removeLayer(t)&&o[n].removeSource(t),o[n].hasImage(t+"Img")&&o[n].removeImage(t+"Img"),a?o[n].addImage(t+"Img",l,{sdf:!0}):o[n].addImage(t+"Img",l),o[n].addLayer({id:t,type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:e}},minzoom:r.minZoom,layout:{"icon-image":t+"Img","icon-size":o.psrIconSize[t.replace("light","")],"icon-rotate":["get","symbolAngle"],"icon-pitch-alignment":"map","icon-anchor":r.iconAnchor,"icon-allow-overlap":!0,"icon-optional":!1,"text-field":-1!==t.indexOf("other")?"":"{tagContent}","text-size":12,"text-anchor":"top","text-allow-overlap":!1,"text-optional":!0,"text-offset":[0,2],"text-max-width":8,"text-font":["Microsoft YaHei Regular"],visibility:-1===t.indexOf("zhoubian")||o.zhoubianShow?"visible":"none"},paint:a?{"text-color":"#555252","text-halo-color":"#FFFFFF","text-halo-width":1.33333,"text-opacity":["get",-1!==t.indexOf("light")?"customLightOpacity":"customOpacity"],"icon-color":"#e6e6e6","icon-opacity":["get",-1!==t.indexOf("light")?"customLightOpacity":"customOpacity"]}:{"text-color":"#555252","text-halo-color":"#FFFFFF","text-halo-width":1.33333,"text-opacity":["get",-1!==t.indexOf("light")?"customLightOpacity":"customOpacity"],"icon-opacity":["get",-1!==t.indexOf("light")?"customLightOpacity":"customOpacity"]}}),void 0!==o[n].getLayer(t)&&(-1!==t.indexOf("light")&&o[n].setLayoutProperty(t,"text-field","{tagContent}"),-1!==t.indexOf("bdzdyd")&&"map"==n&&(o[n].setLayerZoomRange(t,0,24),o[n].setLayoutProperty(t,"text-field","{tagContent}"))),s&&s()}))}},setPointLayer:function(t,e,i,r){i.minZoom||(i.minZoom=2);var a="";a=r||"map",this[a].getLayer(t)&&this[a].removeLayer(t)&&this[a].removeSource(t),this[a].addLayer({id:t,type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:e}},minzoom:i.minZoom,paint:{"circle-radius":i.circleRadius,"circle-color":i.circleColor,"circle-stroke-color":i.circleStrokeColor,"circle-stroke-width":0,"circle-opacity":["get",-1!==t.indexOf("light")?"customLightOpacity":"customOpacity"]}})},setLineLayer:function(t,e,i,r){var a="";i?(a=i,a.lineWidth||(a.lineWidth=3),a.lineDasharray||(a.lineDasharray=[i.lineWidth,0]),a.minZoom||(a.minZoom=2)):a={lineColor:this.colorVal,lineWidth:3,lineDasharray:[3,0],minZoom:15};var s="";s=r||"map",this[s].getLayer(t)&&this[s].removeLayer(t)&&this[s].removeSource(t),this[s].addLayer({id:t,type:"line",source:{type:"geojson",data:{type:"FeatureCollection",features:e}},minzoom:a.minZoom,layout:{"line-cap":"round","line-join":"round",visibility:-1===t.indexOf("zhoubian")||this.zhoubianShow?"visible":"none"},paint:{"line-color":["get",-1!==t.indexOf("light")?"customLightLineColor":"lineColor"],"line-width":a.lineWidth,"line-opacity":["get",-1!==t.indexOf("light")?"customLightOpacity":"customOpacity"],"line-offset":0,"line-dasharray":a.lineDasharray}}),void 0!==this[s].getLayer(t)&&(console.log("moveLayer-----id",t),this[s].moveLayer(t))},setPolygonLayer:function(t,e,i,r){i.fillOutlineColor||(i.fillOutlineColor=this.colorVal),i.fillColor||(i.fillColor="rgba(0, 204, 255, 0.2)"),i.minZoom||(i.minZoom=2);var a="";a=r||"map",this[a].getLayer(t)&&this[a].removeLayer(t)&&this[a].removeSource(t),this[a].addLayer({id:t,type:"fill",source:{type:"geojson",data:{type:"FeatureCollection",features:e}},layout:{visibility:-1===t.indexOf("zhoubian")||this.zhoubianShow?"visible":"none"},minzoom:i.minZoom,paint:{"fill-color":i.fillColor,"fill-opacity":["get",-1!==t.indexOf("light")?"customLightOpacity":"customOpacity"],"fill-outline-color":i.fillOutlineColor,"fill-antialias":!0}});var s=t.replace("light","")+"-symbol";-1!==t.indexOf("light")&&void 0!==this[a].getLayer(t)&&void 0!==this[a].getLayer(s)&&this[a].moveLayer(t,s)},setPolygenSymbol:function(t,e,i){this.map.getLayer(t)&&this.map.removeLayer(t)&&this.map.removeSource(t),this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:e}},layout:{"text-font":["Microsoft YaHei Regular"],"text-ignore-placement":!1,"text-field":"{tagContent}","text-size":-1!==t.indexOf("bdz")?24:14,"text-allow-overlap":-1!==t.indexOf("bdz"),"text-max-width":8,visibility:-1===t.indexOf("zhoubian")||this.zhoubianShow?"visible":"none"},paint:{"text-color":i.textColor,"text-halo-color":"#fff","text-halo-width":1.33333,"text-opacity":["get","customSymbolOpacity"]}}),void 0!==this.map.getLayer(t)&&-1!==t.indexOf("bdz")&&this.map.setLayerZoomRange(t,0,.1)},toggleLeftSideBar:function(){0==this.ltBoxLtVal?(this.marginLeftV=0,this.ltBoxLtVal=-1*this.ltBoxWid):(this.marginLeftV=this.ltBoxWid,this.ltBoxLtVal=0),this.reInitMap()},toggleRightSideBar:function(){0==this.rtBoxRtVal?(this.marginRightV=0,this.rtBoxRtVal=-1*this.rtBoxWid):this.rightPanelShow(),this.reInitMap()},rightPanelShow:function(){this.marginRightV=this.rtBoxWid,this.rtBoxRtVal=0},setLeftSideParams:function(t){this.ltBoxWid=t,this.marginLeftV=this.ltBoxWid,this.reInitMap()},setRightSideParams:function(t){this.rtBoxWid=t,this.marginRightV=this.rtBoxWid,this.reInitMap()},reInitMap:function(){var t=this;setTimeout((function(){t.map.resize()}),280)},searchAsync:function(t){var e=this;if(""!==t){this.topMenuIndexVal=1,this.searchResult=[];var i=[];for(var r in this.tqDataFl)this.tqDataFl[r].length>0&&(i=i.concat(this.tqDataFl[r]));for(var a=i.length,s=function(r){1!=i[r].properties.customOpacity&&1!=i[r].properties.customLightOpacity||void 0===e.map.getLayer(i[r].properties.psrNo)||"none"===e.map.getLayoutProperty(i[r].properties.psrNo,"visibility")||(i[r].properties.hasOwnProperty("psrId")&&-1!==i[r].properties.psrId.indexOf(t)&&e.dataToCompareArr(i[r],e.searchResult,!1,(function(){e.searchResult.push(i[r])})),i[r].properties.hasOwnProperty("oid")&&-1!==JSON.stringify(i[r].properties.oid).indexOf(t)&&e.dataToCompareArr(i[r],e.searchResult,!1,(function(){e.searchResult.push(i[r])})),i[r].properties.hasOwnProperty("name")&&-1!==i[r].properties.name.indexOf(t)&&e.dataToCompareArr(i[r],e.searchResult,!1,(function(){e.searchResult.push(i[r])})))},o=0;o<a;o++)s(o)}else this.topMenuIndexVal=0},getAllPointData:function(t){var e=[];for(var i in t)t[i].length>0&&"Point"==t[i][0].geometry.type&&(e=e.concat(t[i]));return e},getAllNotLineData:function(t){var e=[];for(var i in t)t[i].length>0&&"LineString"!==t[i][0].geometry.type&&(e=e.concat(t[i]));return e},getAllLineData:function(t){var e=[];for(var i in t)t[i].length>0&&"LineString"==t[i][0].geometry.type&&(e=e.concat(t[i]));return e},getAllLineDataBytqData:function(t){for(var e=[],i=0;i<t.length;i++)"LineString"==t[i].geometry.type&&(e=e.concat(t[i]));return e},getAllPolygonData:function(t){var e=[];for(var i in t)t[i].length>0&&"Polygon"==t[i][0].geometry.type&&(e=e.concat(t[i]));return e},searchLocation:function(t){var e;console.log("定位需要的参数",t),this.clearRightPanelSbInf(),this.removeLightLayer(),this.showRightPsrInf(t),e="Point"==t.geometry.type?t.geometry.coordinates:"LineString"==t.geometry.type?t.geometry.coordinates[0]:t.geometry.coordinates[0][0],this.addToLightData(this.tqDataFl[t.properties.psrNo][t.properties.dataInTypeIndex],this.lightData,!0),this.setFbRecord(),this.map.easeTo({center:e,zoom:21.5})},showRightPsrInf:function(t){this.rightBxInf.sbId=t.properties.id,this.rightBxInf.zcbh=t.properties.psrId,this.rightBxInf.layerId=t.properties.psrNo,this.rightBxInf.onItemIndex=t.properties.dataInTypeIndex,this.rightBxInf.oldAngle=t.properties.symbolAngle,this.rightBxInf.layerType=t.geometry.type,this.rightBxInf.zbType="1",this.rightBxInf.ddzb="",t.properties.name?this.rightBxInf.mc=t.properties.name:t.properties.id&&(this.rightBxInf.mc=t.properties.id),"Polygon"==t.geometry.type?this.rightBxInf.wz=this.getPolygonCenterZb(t.geometry.coordinates).toString():this.rightBxInf.wz=t.geometry.coordinates.toString()},tucengChangeFn:function(){2===this.topMenuIndexVal?this.topMenuIndexVal=0:0===this.topMenuIndexVal&&(this.topMenuIndexVal=2)},boxSelect:function(t){this.drawCircle&&(this.clearAndRemoveDrawObj(this.drawCircle),this.drawCircle=null),this.toolsIndex=t,this.kxType="jx",this.isDrawing=!0,null==this.drawRectangle&&(this.updateAndRemoveLightLayer(),this.allAddToSpatialIndex(),this.initDrawRectangle(),this.drawRectangle.startDraw())},circularSelect:function(){this.drawRectangle&&(this.clearAndRemoveDrawObj(this.drawRectangle),this.drawRectangle=null),this.toolsIndex=1,this.kxType="yx",this.isDrawing=!0,null==this.drawCircle&&(this.updateAndRemoveLightLayer(),this.initDrawCircle(),this.drawCircle.startDraw())},clearAndRemoveDrawObj:function(t){t&&(t.endDraw(),this.clearThisDrawData(t),t.remove())},drawLines:function(){this.toolsIndex=10,this.updateAndRemoveLightLayer(),this.clearDrawPolyline(),this.initDrawPolyline(),this.drawPolyline.startDraw()},polygonSelect:function(){this.toolsIndex=11,this.updateAndRemoveLightLayer(),this.clearDrawPolygonData(),this.initDrawPolygon(),this.drawPolygon.startDraw()},getRangeLayerData:function(t,e){this.clearThisDrawData(this.drawRectangle),this.drawRectangle.remove(),this.drawRectangle=null,this.isDrawing=!1,this.plEditVisible?this.toolsIndex=13:this.toolsIndex=0;var i=this,r=t[0][0],a=t[1][0],s=t[2][1],o=t[1][1],n=[r,s,a,o];this.vectorSource.forEachFeatureIntersectingExtent(n,(function(t){t.get("id");var e=t.get("psrNo"),r=t.get("psrObjFlType"),a=t.get("dataInTypeIndex");1==i.tqDataFl[e][a].properties.customOpacity&&(!i.isYxyh&&"02"==i.type&&"xsb"!==r&&"pds"!==r&&"byq"!==r||!i.isYxyh&&"02"!==i.type&&"bdz"!==r||i.isYxyh&&i.tqDataFl[e][a].properties.hasOwnProperty("deviceType"))&&(i.plEditVisible?"Point"!=i.tqDataFl[e][a].geometry.type&&"dianLine"!=i.tqDataFl[e][a].properties.psrNo&&"Polygon"!=i.tqDataFl[e][a].geometry.type||"pds"==i.tqDataFl[e][a].properties.psrObjFlType||(i.addToLightData(i.tqDataFl[e][a],i.lightData),i.addToPlEditData(i.tqDataFl[e][a])):i.addToLightData(i.tqDataFl[e][a],i.lightData))})),this.lightDataToLoadLayer(),this.kxAllMove=!0},getRangeLayerDataOld:function(t,e){for(var i in this.clearThisDrawData(this.drawCircle),this.drawCircle.remove(),this.drawCircle=null,this.isDrawing=!1,this.plEditVisible?this.toolsIndex=13:this.toolsIndex=0,e){var r=e[i],a=r.length;if(a>0)for(var s=0;s<a;s++)if("Point"==r[s].geometry.type){if(!this.isYxyh&&"02"==this.type&&"byq"==r[s].properties.psrObjFlType)continue;if(!this.isYxyh&&"02"!==this.type&&"bdzdyd"==r[s].properties.psrObjFlType)continue;if(this.isYxyh&&!r[s].properties.hasOwnProperty("deviceType"))continue;var o=r[s].geometry.coordinates;this.gisName.GeometryUtil.isPointInRing(o,t)&&(this.addToLightData(r[s],this.lightData),this.plEditVisible&&this.addToPlEditData(r[s]))}else if("LineString"==r[s].geometry.type){if(this.plEditVisible)continue;if(this.isYxyh&&!r[s].properties.hasOwnProperty("deviceType"))continue;for(var n=r[s].geometry.coordinates,l=0,h=n.length;l<h;l++)if(this.gisName.GeometryUtil.isPointInRing(n[l],t)){this.addToLightData(r[s],this.lightData);break}}else if("Polygon"==r[s].geometry.type){if(this.plEditVisible)continue;var p=r[s].geometry.coordinates[0];if(!this.isYxyh&&"02"==this.type&&("xsb"==r[s].properties.psrObjFlType||"pds"==r[s].properties.psrObjFlType)||!this.isYxyh&&"02"!==this.type&&"bdz"==r[s].properties.psrObjFlType)continue;if(this.isYxyh&&!r[s].properties.hasOwnProperty("deviceType"))continue;(this.gisName.GeometryUtil.doesRingRingIntersect(p,t)||this.gisName.GeometryUtil.isRingInRing(p,t))&&this.addToLightData(r[s],this.lightData)}}this.lightDataToLoadLayer(),this.kxAllMove=!0},clearThisDrawData:function(t){var e=t.getFeatures();e.length>0&&e[0].geometry.coordinates[0].length>0&&t.clearData()},addToLightData:function(t,e,i,r){if(-1!=t.properties.psrNo.indexOf("Dian")||!(0==t.properties.customOpacity&&0==t.properties.customLightOpacity||void 0!==this.map.getLayer(t.properties.psrNo)&&void 0!==this.map.getLayoutProperty(t.properties.psrNo,"visibility")&&"none"==this.map.getLayoutProperty(t.properties.psrNo,"visibility"))){var a=t.properties.psrNo;if(t.properties.customOpacity=0,t.properties.customLightOpacity=1,t.properties.hasOwnProperty("onLightDataIndex")||this.$set(t.properties,"onLightDataIndex",""),e.hasOwnProperty(a)&&e[a].length>0)if(""==t.properties.onLightDataIndex)this.isDragEditBx=!0,t.properties.onLightDataIndex=(parseInt(e[a][e[a].length-1].properties.onLightDataIndex)+1).toString(),e[a].push(t);else{var s=t.properties.onLightDataIndex;17==this.keyCodeV?(t.properties.customOpacity=1,t.properties.customLightOpacity=0,t.properties.onLightDataIndex="",e[a].splice(s,1)):e[a][s]=t}else this.$set(e,a,[]),t.properties.onLightDataIndex="0",e[a].push(t),this.isDragEditBx=!0;i&&this.loadLightLayer(t,e,r)}},lightDataToLoadLayer:function(){for(var t in this.lightData)this.lightData[t].length>0&&this.loadLightLayer(this.lightData[t][0],this.lightData)},loadLightLayer:function(t,e,i){var r=this;if(void 0!=t&&void 0!=t.properties){var a=t.properties.psrNo;this.layerGetSource(a,this.tqDataFl[a]),void 0!==this.map.getLayer("light"+a)?this.layerGetSource("light"+a,e[a]):this.toDrawLightLayer(t,a,e[a],i),setTimeout((function(){-1!==a.indexOf("nzwlgt")&&("02"==r.type?void 0!==r.map.getLayer("light"+a)&&void 0!==r.map.getLayer("lightdynzyxgt")&&r.map.moveLayer("light"+a,"lightdynzyxgt"):void 0!==r.map.getLayer("light"+a)&&void 0!==r.map.getLayer("lightnzyxgt")&&r.map.moveLayer("light"+a,"lightnzyxgt")),-1!==a.indexOf("zxwlgt")&&("02"==r.type?void 0!==r.map.getLayer("light"+a)&&void 0!==r.map.getLayer("lightzxgt")&&r.map.moveLayer("light"+a,"lightzxgt"):void 0!==r.map.getLayer("light"+a)&&void 0!==r.map.getLayer("lightzxyxgt")&&r.map.moveLayer("light"+a,"lightzxyxgt"))}),500)}},toDrawLightLayer:function(t,e,i,r){if("Point"==t.geometry.type)"ljd"==e?this.setPointLayer("light"+e,i,{circleRadius:4,circleColor:"#ffd04b",circleStrokeColor:"#ffd04b",minZoom:this.layerMinZoom}):"BigDian"==e?(this.setPointLayer("light"+e,i,{circleRadius:8,circleColor:"#fbb131",circleStrokeColor:"#fff",minZoom:this.layerMinZoom}),this.map.on("mousedown","light"+e,this.dragDian),this.bindLayerCursorStyle("light"+e)):"SmallDian"==e?this.setPointLayer("light"+e,i,{circleRadius:6,circleColor:"#fbb131",circleStrokeColor:"#fff",minZoom:this.layerMinZoom}):void 0!==this.picsData[e]&&void 0!==this.picsData[e].itemLightImg?this.setPointImgLayer("light"+e,i,this.picsData[e].itemLightImg,{size:this.iconSize,minZoom:this.layerMinZoom}):this.setPointLayer("light"+e,i,{circleRadius:6,circleColor:"#ffd04b",circleStrokeColor:"#ffd04b",minZoom:this.layerMinZoom});else if("LineString"==t.geometry.type||"MultiLineString"==t.geometry.type){var a=e;-1!==a.indexOf("zhoubian")&&(a=e.replace("zhoubian","")),-1!==a.indexOf("yunjian")&&(a=e.replace("yunjian","")),"dianLine"==a?this.setLineLayer("light"+e,i,{lineWidth:r,lineDasharray:[3,3],minZoom:this.layerMinZoom}):this.setLineLayer("light"+e,i,{lineWidth:3,minZoom:this.layerMinZoom})}else this.setPolygonLayer("light"+e,i,{fillColor:"#00ffff",fillOutlineColor:"#ffd04b",minZoom:this.layerMinZoom})},bindLayerDianlan:function(){var t=this;console.log("=====================>>>>>>>>>>>>>绑定电缆"),this.map.on("mousedown",(function(e){var i=[[e.point.x-10,e.point.y-10],[e.point.x+10,e.point.y+10]];if(void 0!==t.map.getLayer("dianLine")){var r=t.map.queryRenderedFeatures(i,{layers:["dianLine"]});JSON.stringify(r).length>2&&(t.$set(e,"features",[r[0]]),t.dragBx(e))}if(void 0!==t.map.getLayer("geo0dianLine")){r=t.map.queryRenderedFeatures(i,{layers:["geo0dianLine"]});JSON.stringify(r).length>2&&(t.$set(e,"features",[r[0]]),t.dragBx(e))}}))},mouseleavedianLine:function(){var t=this;console.log("鼠标离开图层-----------------",this.toolsIndex,"dianLine"),setTimeout((function(){t.map.removeLayer("lightdianLine"),t.map.removeSource("lightdianLine"),t.map.hasImage("lightdianLineImg")&&t.map.removeImage("lightdianLineImg"),t.showCustomLayerFn(t.lightData["dianLine"],"dianLine"),t.removeLightDian()}),1e3)},bindLayerCursorStyle:function(t){var e=this;this.map.on("mouseenter",t,(function(){1!==e.toolsIndex&&(e.canvasDOM.style.cursor="pointer")})),this.map.on("mouseleave",t,(function(){1!==e.toolsIndex&&(e.canvasDOM.style.cursor="initial")})),this.map.on("mouseenter","light"+t,(function(){e.canvasDOM.style.cursor="grab"})),this.map.on("mouseleave","light"+t,(function(){e.canvasDOM.style.cursor="initial"}))},resetLineData:function(t,e,i,r,a){if(t.properties.hasOwnProperty("ofLineArr"))for(var s=t.properties.ofLineArr,o=s.length,n=0;n<o;n++){var l=s[n].layerName,h=s[n].onTqFlIndex,p=s[n].onLineIndex,d=JSON.parse(JSON.stringify(this.tqDataFl[l][h].geometry.coordinates));if(this.tqDataFl[l][h].geometry.coordinates[p][0]=d[p][0]+i,this.tqDataFl[l][h].geometry.coordinates[p][1]=d[p][1]+r,""!==this.lazhiForm.startPsrId&&"Point"==t.geometry.type){this.addToLightData(this.tqDataFl[l][h],this.lightData,!0);var c=this.tqDataFl[l][h].geometry.coordinates,g=c.length;g>2&&this.setZLine("",l,h)}a||(this.layerGetSource(l,this.tqDataFl[l]),this.layerGetSource("light"+l,this.lightData[l]))}},dragBx:function(t){var e=this;if(0===t.originalEvent.button&&(t.preventDefault(),this.isStop=!1,!this.plEditVisible&&!this.isDrawing&&!this.isCanDragBx)){this.isCanDragBx=!0,setTimeout((function(){e.isCanDragBx=!1}),500),console.log("开始选中dragBx:--",t.features[0]);var i=t.features[0].layer.id;if(-1===i.indexOf("zhoubian")&&-1===i.indexOf("outLine")&&-1===i.indexOf("attchs")&&-1===i.indexOf("switch")){var r=i.replace("light",""),a=t.features[0].properties,s=a.dataInTypeIndex,o=a.psrObjFlType;this.noPrefixItem=o;var n=!0;this.isYxyh&&(a.hasOwnProperty("deviceType")||(n=!1)),-1!==r.indexOf("-symbol")&&"03"==this.type&&(t.features[0].layer.type="fill",r=r.replace("-symbol",""));var l=this.tqDataFl[r][s].properties.customOpacity+this.tqDataFl[r][s].properties.customLightOpacity;if(0!=l){if(""!==this.choosedLzPsrType){if("line"==t.features[0].layer.type||"fill"==t.features[0].layer.type)return void this.$message.warning("请选择点设备！");if(!(this.tqDataFl[r][s].properties.hasOwnProperty("parentPole")||this.tqDataFl[r][s].properties.hasOwnProperty("psrType")&&-1!==this.tqDataFl[r][s].properties.psrType.indexOf("wlgt")))return void this.$message.warning("请选择杆塔！");var h="",p=null;this.tqDataFl[r][s].properties.hasOwnProperty("psrType")&&-1!==this.tqDataFl[r][s].properties.psrType.indexOf("wlgt")?(h=this.tqDataFl[r][s].properties.psrPoledInf[0].layerId,p=this.tqDataFl[r][s].properties.psrPoledInf[0].dataIndex):(h=r,p=s),"start"==this.choosedLzPsrType?(this.lazhiForm.startPsrId=this.tqDataFl[h][p].properties.id,this.lazhiForm.startPsrItem=h,this.lazhiForm.startPsrIndex=p):(this.lazhiForm.endPsrId=this.tqDataFl[h][p].properties.id,this.lazhiForm.endPsrItem=h,this.lazhiForm.endPsrIndex=p),this.dialogLazhiLineVisible=!0}if(""!==this.choosedDjxPsrType){if(this.choosedDjxPsrType="",this.inflectionPointLayerId=i,"line"!=t.features[0].layer.type||"xuLine"!=r&&"dianLine"!=r)return void this.$message.warning("请选择电缆段或超连接线！");var d="",c=null;d=r,c=s,this.inflectionPointForm.inflectionPointId=this.tqDataFl[d][c].properties.id,this.inflectionPointForm.inflectionPointItem=d,this.inflectionPointForm.inflectionPointIndex=c,this.inflectionPointImportVisible=!0,this.inflectionPointForm.inflectionPointCoordinates=this.tqDataFl[d][c].geometry.coordinates,this.addToDjxEditData(this.tqDataFl[d][c],0)}if(0!==this.awalkingRoutesLayerArray.length&&("8369317be250"==t.features[0].layer.id||"e04e323dac84"==t.features[0].layer.id))for(var g=0;g<this.awalkingRoutesLayerArray.length;g++){var y=this.awalkingRoutesLayerArray[g],f=y.properties.ofPsrArr,u=this.tqDataFl[f[0].layerName][f[0].onTqFlIndex].properties.id,m=this.tqDataFl[f[1].layerName][f[1].onTqFlIndex].properties.id;if(u==t.features[0].properties.id){var D=f[0].onLineIndex;if(0==D){this.awalkingRoutesLayerArray[g].geometry.coordinates[0]=this.tqDataFl[f[0].layerName][f[0].onTqFlIndex].geometry.coordinates;break}if(1==D){var b=y.geometry.coordinates.length;this.awalkingRoutesLayerArray[g].geometry.coordinates[b-1]=this.tqDataFl[f[0].layerName][f[0].onTqFlIndex].geometry.coordinates;break}}else if(m==t.features[0].properties.id){var x=f[1].onLineIndex;if(0==x){this.awalkingRoutesLayerArray[g].geometry.coordinates[0]=this.tqDataFl[f[1].layerName][f[1].onTqFlIndex].geometry.coordinates;break}if(1==x){var v=y.geometry.coordinates.length;this.awalkingRoutesLayerArray[g].geometry.coordinates[v-1]=this.tqDataFl[f[1].layerName][f[1].onTqFlIndex].geometry.coordinates;break}}}if(0!==this.jhxAutoRoutingArr.length&&("8369317be250"==t.features[0].layer.id||"e04e323dac84"==t.features[0].layer.id))for(var L=0;L<this.jhxAutoRoutingArr.length;L++){var I=this.jhxAutoRoutingArr[L],P=I.properties.ofPsrArr,F=this.tqDataFl[P[0].layerName][P[0].onTqFlIndex].properties.id,T=this.tqDataFl[P[1].layerName][P[1].onTqFlIndex].properties.id;if(F==t.features[0].properties.id){var q=P[0].onLineIndex;if(0==q){this.jhxAutoRoutingArr[L].geometry.coordinates[0]=this.tqDataFl[P[0].layerName][P[0].onTqFlIndex].geometry.coordinates;break}if(1==q){var O=I.geometry.coordinates.length;this.jhxAutoRoutingArr[L].geometry.coordinates[O-1]=this.tqDataFl[P[0].layerName][P[0].onTqFlIndex].geometry.coordinates;break}}else if(T==t.features[0].properties.id){var S=P[1].onLineIndex;if(0==S){this.jhxAutoRoutingArr[L].geometry.coordinates[0]=this.tqDataFl[P[1].layerName][P[1].onTqFlIndex].geometry.coordinates;break}if(1==S){var N=I.geometry.coordinates.length;this.jhxAutoRoutingArr[L].geometry.coordinates[N-1]=this.tqDataFl[P[1].layerName][P[1].onTqFlIndex].geometry.coordinates;break}}}var w=[],A=[];for(var C in this.lightData){var z="";this.lightData[C].length>0&&(w=w.concat(this.lightData[C])),this.lightData[C].length>0&&"LineString"!==this.lightData[C][0].geometry.type&&(A=A.concat(this.lightData[C]),z=this.lightData[C][0].properties.psrObjFlType),o!==z&&("xsb"==z||"pds"==z||"byq"==z||"kgz"==z)&&this.lightData[C].length>0&&"02"==this.type?n=!1:o===z||"bdz"!=z&&"bdzdyd"!=z||!(this.lightData[C].length>0)||"01"!=this.type&&"03"!=this.type||(n=!1)}if(this.emptyLightLayer(w,this.tqDataFl[r][s],(function(){"line"==t.features[0].layer.type&&"shiLine"==o&&(n=!1)})),this.showRightPsrInf(this.tqDataFl[r][s]),"line"!==t.features[0].layer.type&&"fill"!==t.features[0].layer.type){if(this.oldBxVal.itemName=r,this.oldBxVal.bxIndex=s,this.addToLightData(this.tqDataFl[r][s],this.lightData,!0),this.isChooseSy&&"03"==this.type&&this.tqDataFl[r][s].properties.hasOwnProperty("psrId")&&(this.isChooseSy=!1,this.dialogSetLineSizeVisible=!0,this.lineForm.syPsrId=this.tqDataFl[r][s].properties.psrId,this.gyRecallVal=this.tqDataFl[r][s].properties.id),this.tqDataFl[r][s].properties.hasOwnProperty("psrPoledInf"))for(var k=this.tqDataFl[r][s].properties.psrPoledInf,j=k.length,$=0;$<j;$++){var R=k[$].layerId,B=k[$].dataIndex;this.addToLightData(this.tqDataFl[R][B],this.lightData,!0),""==this.lineForm.syPsrId&&""==this.choosedLzPsrType&&this.queryPsrOfLineToLight(this.tqDataFl[R][B])}""==this.lineForm.syPsrId&&""==this.choosedLzPsrType&&this.queryPsrOfLineToLight(this.tqDataFl[r][s]),setTimeout((function(){n&&""==e.lineForm.syPsrId&&""==e.choosedLzPsrType&&void 0!==e.map.getLayer("light"+r)&&e.map.on("mousemove",e.onMoveBx)}),50),this.map.once("mouseup",this.onUpBx)}else"fill"==t.features[0].layer.type?(this.isChooseSy&&"03"==this.type&&(this.isChooseSy=!1,this.dialogSetLineSizeVisible=!0,this.lineForm.syPsrId=this.tqDataFl[r][s].properties.psrId,this.gyRecallVal=this.tqDataFl[r][s].properties.id),this.polygonAllToLight(this.tqDataFl[r][s]),this.kxAllMove=!0,setTimeout((function(){n&&void 0!==e.map.getLayer("light"+r)&&""==e.lineForm.syPsrId&&""==e.choosedLzPsrType&&(e.oldLineVal.lng=t.lngLat.lng,e.oldLineVal.lat=t.lngLat.lat,e.map.on("mousemove",e.onMoveBx))}),50),this.map.once("mouseup",this.onUpBx)):(this.oldLineVal.lng=t.lngLat.lng,this.oldLineVal.lat=t.lngLat.lat,this.addToLightData(this.tqDataFl[r][s],this.lightData,!0),0==A.length&&"dianLine"==r&&this.addLightLineDian(this.tqDataFl[r][s]),setTimeout((function(){"1"==e.pageDataType&&n&&void 0!==e.map.getLayer("light"+r)&&A.length>0&&e.map.on("mousemove",e.onMoveBx)}),50),this.map.once("mouseup",this.onUpBx))}}}},onMoveBx:function(t,e){if("qyfjd"==this.noPrefixItem)return console.log("开始拖动dragBx:--",t),void this.map.off("mousemove",this.onMoveBx);if("01"!=this.type&&"03"!=this.type||"bdz"!=this.noPrefixItem&&"bdzdyd"!=this.noPrefixItem){if("02"==this.type&&("xsb"==this.noPrefixItem||"pds"==this.noPrefixItem||"byq"==this.noPrefixItem))return this.$message.warning("低压台区所属电源点,不支持移动！"),void this.map.off("mousemove",this.onMoveBx);if(""!=this.oldBxVal.itemName||""!=this.oldLineVal.lng||e){var i=null,r=null,a=null,s=null;if(""===this.oldBxVal.itemName||e)if(""===this.oldLineVal.lng||e){if(e){var o=1e-6;38==e?(a=0,s=o):40==e?(a=0,s=-1*o):37==e?(a=-1*o,s=0):39==e&&(a=o,s=0)}}else a=t.lngLat.lng-this.oldLineVal.lng,s=t.lngLat.lat-this.oldLineVal.lat,this.oldLineVal.lng=t.lngLat.lng,this.oldLineVal.lat=t.lngLat.lat;else i=this.tqDataFl[this.oldBxVal.itemName][this.oldBxVal.bxIndex].geometry.coordinates[0],r=this.tqDataFl[this.oldBxVal.itemName][this.oldBxVal.bxIndex].geometry.coordinates[1],a=t.lngLat.lng-i,s=t.lngLat.lat-r;var n=[];if(this.kxAllMove){for(var l in this.lightData)this.lightData[l].length>0&&this.lightData[l][0].hasOwnProperty("geometry")&&"LineString"==this.lightData[l][0].geometry.type&&(n=n.concat(this.lightData[l]));for(var h=n.length,p=0;p<h;p++){for(var d=n[p].geometry.coordinates,c=d.length,g=1;g<c-1;g++)d[g][0]=d[g][0]+a,d[g][1]=d[g][1]+s;if(n[p].properties.hasOwnProperty("ofPsrArr")&&n[p].properties.ofPsrArr.length>0){var y=n[p].properties.ofPsrArr,f=y.length;(1==f||f>1&&y[0].onLineIndex==y[1].onLineIndex&&y[0].id==y[1].id)&&(0==y[0].onLineIndex?(d[c-1][0]=d[c-1][0]+a,d[c-1][1]=d[c-1][1]+s):(d[0][0]=d[0][0]+a,d[0][1]=d[0][1]+s))}else d[0][0]=d[0][0]+a,d[0][1]=d[0][1]+s,d[c-1][0]=d[c-1][0]+a,d[c-1][1]=d[c-1][1]+s;var u=n[p].properties.dataInTypeIndex;this.tqDataFl[n[p].properties.psrNo][u].geometry.coordinates=n[p].geometry.coordinates}}for(var m in this.lightData){var D=this.lightData[m],b=D.length;if(b>0){if("Point"==D[0].geometry.type)for(var x=0;x<b;x++){D[x].geometry.coordinates[0]=D[x].geometry.coordinates[0]+a,D[x].geometry.coordinates[1]=D[x].geometry.coordinates[1]+s,""!==this.rightBxInf.zcbh&&this.rightBxInf.layerId==m&&this.rightBxInf.onItemIndex==D[x].properties.dataInTypeIndex&&(this.rightBxInf.wz=D[x].geometry.coordinates.toString());var v=D[x].properties.dataInTypeIndex;this.tqDataFl[m][v].geometry.coordinates=D[x].geometry.coordinates,D[x].properties.hasOwnProperty("oldLineToDianIndex")&&this.changeOldLineOtherDian(D[x],this.oldLineToDian[D[x].properties.psrNo]),D[x].properties.hasOwnProperty("isSamePole")&&this.resetTongGanTagZb(D[x]),this.resetLineData(D[x],D[x].geometry.coordinates,a,s,"all")}else if("Polygon"==D[0].geometry.type)for(var L=0;L<b;L++){for(var I=D[L].geometry.coordinates[0],P=0,F=I.length;P<F;P++)I[P][0]=I[P][0]+a,I[P][1]=I[P][1]+s;D[L].properties.hasOwnProperty("isSamePole")&&this.resetTongGanTagZb(D[L]);var T=D[L].properties.dataInTypeIndex;if(m==this.znsbOnStation.item&&T==this.znsbOnStation.index&&this.removeZnsbLayer(),""!==this.rightBxInf.zcbh&&this.rightBxInf.layerId==m&&this.rightBxInf.onItemIndex==D[L].properties.dataInTypeIndex){var q=this.rightBxInf.wz.split(",");q[0]=Number(q[0])+a,q[1]=Number(q[1])+s,this.rightBxInf.wz=q.toString()}this.resetLineData(D[L],"",a,s,"all"),this.tqDataFl[m][T].geometry.coordinates=D[L].geometry.coordinates}"Polygon"==D[0].geometry.type&&this.layerGetSource(m+"-symbol",this.tqDataFl[m])}}this.lightDataToLoadLayer()}}else this.map.off("mousemove",this.onMoveBx)},queryPsrOfLineToLight:function(t){if((17!=this.keyCodeV||1!=t.properties.customOpacity)&&t.properties.hasOwnProperty("ofLineArr"))for(var e=t.properties.ofLineArr,i=e.length,r=0;r<i;r++){var a=e[r].layerName,s=e[r].onTqFlIndex;1!=this.tqDataFl[a][s].properties.customOpacity&&1!=this.tqDataFl[a][s].properties.customLightOpacity||this.addToLightData(this.tqDataFl[a][s],this.lightData,!0)}},queryPhysicsGt:function(){var t=this.getGtArrData("tqDataFl"),e=t.wlgt,i=t.yxgt,r=e.length,a=i.length;if(0!=r)for(var s=0;s<a;s++)for(var o=0;o<r;o++)if(e[o].properties.id==i[s].properties.parentPole){e[o].properties.hasOwnProperty("psrPoledInf")||this.$set(e[o].properties,"psrPoledInf",[]),i[s].properties.hasOwnProperty("psrPoledInf")||this.$set(i[s].properties,"psrPoledInf",[]);var n={id:i[s].properties.id,layerId:i[s].properties.psrNo,dataIndex:i[s].properties.dataInTypeIndex,type:"yxgt"},l={id:e[o].properties.id,layerId:e[o].properties.psrNo,dataIndex:e[o].properties.dataInTypeIndex,type:"wlgt"};if(e[o].properties.psrPoledInf.length>0){for(var h=e[o].properties.psrPoledInf,p=h.length,d=0;d<p;d++)if(n.id!==h[d].id){var c=h[d].layerId,g=h[d].dataIndex;this.tqDataFl[c][g].properties.psrPoledInf.push(n),i[s].properties.psrPoledInf.push(h[d]),e[o].properties.psrPoledInf.push(n),i[s].properties.psrPoledInf.push(l);break}}else e[o].properties.psrPoledInf.push(n),i[s].properties.psrPoledInf.push(l),i[s].properties.hasOwnProperty("systemType")&&5==i[s].properties.systemType&&"02"!==this.type&&(e[o].properties.customOpacity=i[s].properties.customOpacity,this.marketData.push(e[o]));break}},getGtArrData:function(t){var e="tqDataFl";t&&(e=t);var i=[],r=[];for(var a in this[e])this[e][a].length>0&&-1!==this[e][a][0].properties.psrObjFlType.indexOf("gt")&&(this[e][a][0].properties.hasOwnProperty("parentPole")?r=r.concat(this[e][a]):this[e][a][0].properties.hasOwnProperty("psrType")&&-1!==this[e][a][0].properties.psrType.indexOf("wlgt")&&(i=i.concat(this[e][a])));return{wlgt:i,yxgt:r}},queryTongGan:function(){if(null!=this.samePoleData){for(var t in this.samePoleArr=[],this.samePoleData)if(this.samePoleData[t].length>0){var e=[],r=[];if("attchs"==t){e=this.samePoleData[t];var a=this.getGtArrData("tqDataFl");r=a.yxgt}else if("switch"==t){e=this.samePoleData[t];var s=[];for(var o in this.tqDataFl)this.tqDataFl[o].length>0&&"Point"==this.tqDataFl[o][0].geometry.type&&(s=s.concat(this.tqDataFl[o]));r=JSON.parse(JSON.stringify(s))}else if("outLine"==t){e=this.samePoleData[t];var n=[];for(var l in this.tqDataFl)this.tqDataFl[l].length>0&&"Polygon"==this.tqDataFl[l][0].geometry.type&&(n=n.concat(this.tqDataFl[l]));r=JSON.parse(JSON.stringify(n))}e.length>0&&r.length>0&&this.setTongganLayerDataFn(e,r,t)}var h=i("01dd"),p=132,d=this.getMapPixelM("map"),c=1*d/p;this.$set(this.psrIconSize,this.sameGtItem,c),this.setPointImgLayer(this.sameGtItem,this.samePoleArr,h,{size:this.iconSize,minZoom:this.layerMinZoom})}},setTongganLayerDataFn:function(t,e,i){for(var r="outLine"==i?"containerId":"psrId",a=t.length,s=e.length,o=0;o<a;o++)for(var n=0;n<s;n++){var l=e[n].properties.psrNo,h=e[n].properties.dataInTypeIndex;if(e[n].properties.hasOwnProperty("psrId")&&!this.tqDataFl[l][h].properties.hasOwnProperty("isSamePole")&&t[o][r]==e[n].properties.psrId){this.$set(this.tqDataFl[l][h].properties,"isSamePole",!0);var p=this.samePoleArr.length;this.$set(this.tqDataFl[l][h].properties,"tgIndex",p),this.$set(this.samePoleData[i][o],"tqOfTongganPsr",{item:l,index:h});var d=[];if("psrId"==r){var c=this.tqDataFl[l][h].geometry.coordinates[0]+this.sameTagZbDx,g=this.tqDataFl[l][h].geometry.coordinates[1];d=[c,g]}else d=this.getPolygonCenterZb(this.tqDataFl[l][h].geometry.coordinates);var y=JSON.parse(JSON.stringify(this.tqDataFl[l][h].properties)),f={type:"Feature",properties:y,geometry:{type:"Point",coordinates:d}};f.properties.symbolAngle=0,this.samePoleArr.push(f);break}}},resetTongGanTagZb:function(t){var e=t.properties.tgIndex,i=JSON.parse(JSON.stringify(t.geometry.coordinates)),r=t.geometry.type,a=JSON.parse(JSON.stringify(this.samePoleArr[e].geometry.coordinates));if("Point"==r)this.samePoleArr[e].geometry.coordinates[0]=i[0]+this.sameTagZbDx,this.samePoleArr[e].geometry.coordinates[1]=i[1];else if("Polygon"==r){var s=this.getPolygonCenterZb(t.geometry.coordinates);this.samePoleArr[e].geometry.coordinates=JSON.parse(JSON.stringify(s))}var o=this.samePoleArr[e].geometry.coordinates[0]-a[0],n=this.samePoleArr[e].geometry.coordinates[1]-a[1];0===o&&0===n||this.resetDcPsrZb(t,o,n),this.layerGetSource(this.sameGtItem,this.samePoleArr)},resetDcPsrZb:function(t,e,i){if(t.properties.hasOwnProperty("dcNeedChangePsr"))for(var r=t.properties.dcNeedChangePsr,a=r.length,s=0;s<a;s++){var o=r[s].item,n=r[s].index,l=r[s].dataFlType,h=r[s].zbType;if("LineString"==h){var p=r[s].onLineIndex,d=JSON.parse(JSON.stringify(this[l][o][n].geometry.coordinates));this[l][o][n].geometry.coordinates[p][0]=d[p][0]+e,this[l][o][n].geometry.coordinates[p][1]=d[p][1]+i}else this.resetFlyPoint(this[l][o][n],e,i,l);this.layerGetSource(o,this[l][o])}},emptyLightLayer:function(t,e,i){var r=t.length,a=!1;if(r>0){for(var s=0;s<r;s++)if(e.properties.id==t[s].properties.id){a=!0;break}if(!a){if(17!==this.keyCodeV)if("LineString"==e.geometry.type&&0==e.properties.customOpacity&&e.properties.hasOwnProperty("ofPsrArr")){for(var o=e.properties.ofPsrArr,n=o.length,l=!1,h=0;h<n;h++){var p=o[h].layerName,d=o[h].onTqFlIndex;if(1==this.tqDataFl[p][d].properties.customLightOpacity){l=!0;break}}l||this.updateAndRemoveLightLayer()}else this.updateAndRemoveLightLayer();i&&i()}}},polygonAllToLight:function(t){if(this.addToLightData(t,this.lightData,!0),t.properties.hasOwnProperty("ofLineArr"))for(var e=t.properties.ofLineArr,i=e.length,r=0;r<i;r++){var a=e[r].layerName,s=e[r].onTqFlIndex;""==this.lineForm.syPsrId&&""==this.choosedLzPsrType&&this.addToLightData(this.tqDataFl[a][s],this.lightData,!0)}},changeOldLineOtherDianOld:function(t,e){var i=e.length;if(i>0)for(var r=0;r<i;r++)if(t.properties.id==e[r].properties.id){for(var a=t.geometry.coordinates[0]-e[r].geometry.coordinates[1][0],s=t.geometry.coordinates[1]-e[r].geometry.coordinates[1][1],o=e[r].geometry.coordinates.length,n=0;n<o;n++)1==n?e[r].geometry.coordinates[1]=JSON.parse(JSON.stringify(t.geometry.coordinates)):(e[r].geometry.coordinates[n][0]=e[r].geometry.coordinates[n][0]+a,e[r].geometry.coordinates[n][1]=e[r].geometry.coordinates[n][1]+s);break}},changeOldLineOtherDian:function(t,e){var i=t.properties.psrNo,r=t.properties.oldLineToDianIndex,a=this.oldLineToDian[i][r].geometry.type,s=this.oldLineToDian[i][r].geometry.coordinates,o=null,n=null;if("MultiLineString"==a){t.properties.psrNo;o=t.geometry.coordinates[0]-s[0][1][0],n=t.geometry.coordinates[1]-s[0][1][1];for(var l=s.length,h=0;h<l;h++)for(var p=s[h],d=p.length,c=0;c<d;c++)1==c?(this.oldLineToDian[i][r].geometry.coordinates[h][c][0]=t.geometry.coordinates[0],this.oldLineToDian[i][r].geometry.coordinates[h][c][1]=t.geometry.coordinates[1]):(this.oldLineToDian[i][r].geometry.coordinates[h][c][0]=s[h][c][0]+o,this.oldLineToDian[i][r].geometry.coordinates[h][c][1]=s[h][c][1]+n)}else{o=t.geometry.coordinates[0]-s[1][0],n=t.geometry.coordinates[1]-s[1][1];for(var g=s.length,y=0;y<g;y++)1==y?this.oldLineToDian[i][r].geometry.coordinates[1]=JSON.parse(JSON.stringify(t.geometry.coordinates)):(this.oldLineToDian[i][r].geometry.coordinates[y][0]=s[y][0]+o,this.oldLineToDian[i][r].geometry.coordinates[y][1]=s[y][1]+n)}},onUpBx:function(t){console.log("=============>拖拽完成",t),void 0!==this.map.getLayer("walkingRoutesLayer")&&this.map.getSource("walkingRoutesLayer").setData({type:"FeatureCollection",features:this.awalkingRoutesLayerArray}),this.setFbRecord(),this.map.off("mousemove",this.onMoveBx),this.map.off("mouseup",this.onUpBx),this.clearOldBxVal(),this.oldLineVal={lng:"",lat:""}},onMoveLine:function(t){var e=t.lngLat.lng-this.oldLineVal.lng,i=t.lngLat.lat-this.oldLineVal.lat;this.oldLineVal.lng=t.lngLat.lng,this.oldLineVal.lat=t.lngLat.lat;var r=[];for(var a in this.lightData)-1!==a.indexOf("Line")&&(r=r.concat(this.lightData[a]));for(var s=r.length,o=0;o<s;o++){for(var n=r[o].geometry.coordinates,l=0,h=n.length;l<h;l++)n[l][0]=n[l][0]+e,n[l][1]=n[l][1]+i;var p=r[o].properties.dataInTypeIndex;this.tqDataFl[r[o].properties.psrNo][p].geometry.coordinates=r[o].geometry.coordinates,this.addLightLineDian(r[o]),this.layerGetSource("light"+r[o].properties.psrNo,this.lightData[r[o].properties.psrNo]),this.layerGetSource(r[o].properties.psrNo,this.tqDataFl[r[o].properties.psrNo])}},onUpLine:function(){this.map.off("mousemove",this.onMoveLine),this.map.off("mouseup",this.onUpLine),this.oldLineVal={lng:"",lat:""}},dataToCompareArr:function(t,e,i,r){void 0==e&&(e=[]);for(var a=e.length,s=!1,o=0;o<a;o++)if(t.properties.id==e[o].properties.id){i&&i(o),s=!0;break}s||r&&r()},addLightLineDian:function(t){if(this.dianData.BigDian=[],this.dianData.SmallDian=[],this.layerGetSource("lightBigDian"+this.currDian.dianItem,this.dianData["BigDian"]),this.layerGetSource("lightSmallDian"+this.currDian.dianItem,this.dianData["SmallDian"]),1!=t.properties.customOpacity){var e=[];t.properties.hasOwnProperty("ofPsrArr")&&(e=t.properties.ofPsrArr);for(var i=e.length,r=t.geometry.coordinates,a=r.length,s=0;s<a;s++){if(i>0){for(var o=!1,n=0;n<i;n++)if(e[n].onLineIndex==s){o=!0;break}o||this.setBigDianOnLine(t,s)}else this.setBigDianOnLine(t,s);s<a-1&&this.setSmallDianOnLine(t,s)}JSON.stringify(this.dianData.BigDian).length>2&&!this.isStop&&(this.isStop=!1,this.map.on("mousemove","lightBigDian",this.dragDian))}},setBigDianOnLine:function(t,e){var i=this.dianData.BigDian.length,r={type:"Feature",properties:{lineId:t.properties.id,lineIndex:t.properties.dataInTypeIndex,lineType:t.properties.psrNo,id:t.properties.id+"-dian"+e,psrNo:"BigDian",onLineIndex:e,onDianArrIndex:i},geometry:{type:"Point",coordinates:t.geometry.coordinates[e]}};this.addToLightData(r,this.dianData,!0)},setSmallDianOnLine:function(t,e){var i=this.dianData.SmallDian.length,r=t.geometry.coordinates,a=(r[e+1][0]-r[e][0])/2+r[e][0],s=(r[e+1][1]-r[e][1])/2+r[e][1],o={type:"Feature",properties:{lineId:t.properties.id,lineIndex:t.properties.dataInTypeIndex,lineType:t.properties.psrNo,id:t.properties.id+"-smallDian"+e,psrNo:"SmallDian",preDianIndex:e,onDianArrIndex:i},geometry:{type:"Point",coordinates:[a,s]}};this.addToLightData(o,this.dianData,!0)},removeLightLayer:function(t,e){if(0!==Object.keys(this.lightData).length)for(var i in this.lightData)void 0!==this.map.getLayer("light"+i)&&(this.map.removeLayer("light"+i),this.map.removeSource("light"+i),this.map.hasImage("light"+i+"Img")&&this.map.removeImage("light"+i+"Img"),this.showCustomLayerFn(this.lightData[i],i),delete this.lightData[i]);this.kxAllMove=!1,void 0!==this.map.getLayer("lightSmallDian")&&this.removeLightDian()},showCustomLayerFn:function(t,e){if(this.tqDataFl.hasOwnProperty(e)){for(var i=t.length,r=0;r<i;r++){var a=t[r].properties.psrNo,s=t[r].properties.dataInTypeIndex;if(this.tqDataFl[a][s].properties.customOpacity=1,this.tqDataFl[a][s].properties.customLightOpacity=0,this.tqDataFl[a][s].properties.onLightDataIndex="","02"==this.type&&"LineString"==this.tqDataFl[a][s].geometry.type){var o=this.$refs.tucengTree.getCheckedKeys();-1==o.indexOf("jlx")&&this.tqDataFl[a][s].properties.hasOwnProperty("ofPsrArr")&&-1!==JSON.stringify(this.tqDataFl[a][s].properties.ofPsrArr).indexOf("jlx")&&(this.tqDataFl[a][s].properties.customOpacity=0)}}this.layerGetSource(e,this.tqDataFl[e])}},removeLightDian:function(){if(0!==Object.keys(this.dianData).length){for(var t in this.dianData)void 0!==this.map.getLayer("light"+t)&&(this.isStop=!1,this.map.removeLayer("light"+t),this.map.removeSource("light"+t),this.map.off("mousedown","light"+t,this.dragDian));this.dianData={}}},resetDragBx:function(){var t=this;this.kxAllMove=!1,this.rtBoxCanEdit=!1,this.removeZnsbLayer(),0!==this.jhxAutoRoutingArr.length&&(this.jhxAutoRoutingArr=[],this.jhxAutoRoutingArrCopy=[],this.jhxAutoRoutingCancel());var e=this.stepCancelData.lightTqData.length,i=null;if(e>0&&(i=JSON.parse(JSON.stringify(this.stepCancelData.lightTqData[e-1]))),e>1)for(var r in this.lightData=JSON.parse(JSON.stringify(this.stepCancelData.lightTqData[e-2])),this.stepCancelData.lightTqData.splice(e-1,1),this.tqDataFl=JSON.parse(JSON.stringify(this.stepCancelData.stepTqData[e-2])),this.stepCancelData.stepTqData.splice(e-1,1),this.tqDataFl)this.layerGetSource(r,this.tqDataFl[r]),this.lightData.hasOwnProperty(r)&&this.lightData[r].length>0?void 0!==this.map.getLayer("light"+r)?this.layerGetSource("light"+r,this.lightData[r]):this.toDrawLightLayer(this.lightData[r][0],r,this.lightData[r]):this.layerGetSource("light"+r,[]),this.tqDataFl[r].length>0&&"Polygon"==this.tqDataFl[r][0].geometry.type&&this.layerGetSource(r+"-symbol",this.tqDataFl[r]);else{for(var a in this.stepCancelData={lightTqData:[],stepTqData:[]},this.isDragEditBx=!1,this.tqDataFl=JSON.parse(JSON.stringify(this.oldTqDataFl)),this.oldTqDataFl)this.tqDataFl[a]=JSON.parse(JSON.stringify(this.oldTqDataFl[a])),this.layerGetSource(a,this.tqDataFl[a]),this.oldTqDataFl[a].length>0&&"Polygon"==this.oldTqDataFl[a][0].geometry.type&&this.layerGetSource(a+"-symbol",this.oldTqDataFl[a]);this.removeLightLayer()}if(""!==this.rightBxInf.sbId&&this.clearRightPanelSbInf(),e>0)for(var s in i){if(this.oldLineToDian.hasOwnProperty(s)&&this.oldLineToDian[s].length>0)for(var o=i[s],n=o.length,l=0;l<n;l++){var h=o[l].properties.dataInTypeIndex;this.tqDataFl[s][h].properties.hasOwnProperty("oldLineToDianIndex")&&this.changeOldLineOtherDian(this.tqDataFl[s][h],this.oldLineToDian[s])}this.lightData.hasOwnProperty(s)||(i[s]=[],this.layerGetSource("light"+s,i[s]))}if(this.marketData.length>0){var p=this.$refs.tucengTree.getCheckedKeys();-1!==p.indexOf("yingxiao")?this.isShowYxEquipment(!0):this.isShowYxEquipment(!1)}void 0!==this.map.getLayer("lightSmallDian")&&this.removeLightDian(),this.needRecallDataArr=[];var d=this.samePoleArr.length;if(d>0)for(var c=0;c<d;c++){var g=this.samePoleArr[c].properties.psrNo,y=this.samePoleArr[c].properties.dataInTypeIndex,f=[],u=this.samePoleArr[c].geometry.coordinates,m=this.tqDataFl[g][y].geometry.type;"Point"==m?f=[this.tqDataFl[g][y].geometry.coordinates[0]+this.sameTagZbDx,this.tqDataFl[g][y].geometry.coordinates[1]]:"Polygon"==m&&(f=this.getPolygonCenterZb(this.tqDataFl[g][y].geometry.coordinates)),JSON.stringify(f)!==JSON.stringify(u)&&this.resetTongGanTagZb(this.tqDataFl[g][y])}this.ycsbDistinguishVisible&&(this.sgYxsbArr=JSON.parse(JSON.stringify(this.sgYxsbArrCopy)),console.log("点击撤销恢复数据this.sgYxsbArr",this.sgYxsbArr),this.$nextTick((function(){t.$refs.YcsbDistinguish.getList()})))},updateDragBx:function(t){this.isDragEditBx=!1,this.kxAllMove=!1,this.rtBoxCanEdit=!1,this.stepCancelData={lightTqData:[],stepTqData:[]},this.removeZnsbLayer(),this.updateAndRemoveLightLayer(),this.oldTqDataFl=JSON.parse(JSON.stringify(this.tqDataFl))},updateAndRemoveLightLayer:function(){for(var t in this.tqDataFl)this.tqDataFl[t]=JSON.parse(JSON.stringify(this.tqDataFl[t])),this.layerGetSource(t,this.tqDataFl[t]);this.clearRightPanelSbInf(),this.removeLightLayer()},clearOldBxVal:function(){this.oldBxVal={bxIndex:"",itemName:""}},clearRightPanelSbInf:function(){this.clearOldBxVal(),this.rightBxInf={zcbh:"",mc:"",wz:"",layerId:"",onItemIndex:null,oldAngle:null,zbType:"1",ddzb:"",layerType:""}},handleCheckChange:function(t,e){if(console.log("====================handleCheckChange",t,e,this.defaultCheckedKeys),"zhoubian"!==t.id)if("outLine"!==t.id&&"attchs"!==t.id&&"switch"!==t.id){"AILayer"==t.id&&(-1==e.checkedKeys.indexOf("AILayer")?this.hideLayerFn("AILayer"):this.showLayerFn("AILayer"));var i=e.checkedKeys,r=i.length,a=!1;if(r>0){for(var s=0;s<r;s++)if(t.id==i[s]){a=!0,"yingxiao"==t.type?(this.isShowYxEquipment(!0),this.filterText=""):(this.showLayerFn(t.type),void 0!==this.map.getLayer(t.type+"-symbol")&&this.showLayerFn(t.type+"-symbol"));break}a||("yingxiao"==t.type?(this.isShowYxEquipment(!1),this.filterText="营销设备-"):(this.hideLayerFn(t.type),void 0!==this.map.getLayer(t.type+"-symbol")&&this.hideLayerFn(t.type+"-symbol")))}else"yingxiao"==t.type?(this.isShowYxEquipment(!1),this.filterText="营销设备-"):(this.hideLayerFn(t.type),void 0!==this.map.getLayer(t.type+"-symbol")&&this.hideLayerFn(t.type+"-symbol"));for(var o in this.lightData)o==t.type&&(a?this.showLayerFn("light"+o):this.hideLayerFn("light"+o));""!==this.searchKey&&this.searchAsync(this.searchKey)}else this.toCheckTgDcLayer(t,e);else if(-1!==e.checkedKeys.indexOf("zhoubian")){this.zhoubianShow=!0;var n=!1;if("{}"==JSON.stringify(this.zhoubianTqGeoFl)&&(n=!0,"{}"==JSON.stringify(this.currentZhoubianTqData)?(console.log("----首次加载周边数据==================="),this.getOtherDetail()):this.setLayerData(this.currentZhoubianTqData,"zhoubian","map"),this.zhoubianLayerToBottomDsq()),!n){for(var l in this.tqDataFl)void 0!==this.map.getLayer(l)&&this.map.moveLayer(l);for(var h in this.zhoubianTqGeoFl)this.showLayerFn(h),void 0!==this.map.getLayer(h+"-symbol")&&this.showLayerFn(h+"-symbol")}}else for(var p in this.zhoubianShow=!1,this.zhoubianTqGeoFl)this.hideLayerFn(p),void 0!==this.map.getLayer(p+"-symbol")&&this.hideLayerFn(p+"-symbol")},toCheckTgDcLayer:function(t,e){var i=this,r=t.id;if(console.log("同杆图层啊：--------",r,e),-1!==e.checkedKeys.indexOf(r)){var a=!1;if("{}"==JSON.stringify(this[r+"TqGeoFl"]))a=!0,this.getTgDcDetail(r);else for(var s in this[r+"TqGeoFl"])this.showLayerFn(s),void 0!==this.map.getLayer(s+"-symbol")&&this.showLayerFn(s+"-symbol");a&&setTimeout((function(){for(var t in i.tqDataFl)void 0!==i.map.getLayer(t)&&i.map.moveLayer(t)}),1e3)}else for(var o in this[r+"TqGeoFl"])this.hideLayerFn(o),void 0!==this.map.getLayer(o+"-symbol")&&this.hideLayerFn(o+"-symbol")},handleCheckZhoubianChange:function(t,e){if(e.checkedKeys&&e.checkedKeys.length)for(var i in this.zhoubianTqGeoFl)this.showLayerFn(i),void 0!==this.map.getLayer(i+"-symbol")&&this.showLayerFn(i+"-symbol");else for(var r in this.zhoubianTqGeoFl)this.hideLayerFn(r),void 0!==this.map.getLayer(r+"-symbol")&&this.hideLayerFn(r+"-symbol")},isShowYxEquipment:function(t){var e=this.marketData.length;if(0!=e){for(var i=[],r=i.length,a=!1,s=0;s<e;s++){var o=this.marketData[s].properties.psrNo,n=this.marketData[s].properties.dataInTypeIndex;r=i.length;var l=!1;if(r>0){for(var h=0;h<r;h++)if(i[h]==o){l=!0;break}l||i.push(o)}else i.push(o);if(t){if(this.tqDataFl[o][n].properties.customOpacity=1,this.tqDataFl[o][n].properties.customLightOpacity=0,this.tqDataFl[o][n].properties.hasOwnProperty("customSymbolOpacity")&&(this.tqDataFl[o][n].properties.customSymbolOpacity=1),this.tqDataFl[o][n].properties.hasOwnProperty("isSamePole")){var p=this.tqDataFl[o][n].properties.tgIndex;this.samePoleArr[p].properties.customOpacity=1,a=!0}}else if(this.tqDataFl[o][n].properties.customOpacity=0,this.tqDataFl[o][n].properties.customLightOpacity=0,this.tqDataFl[o][n].properties.hasOwnProperty("customSymbolOpacity")&&(this.tqDataFl[o][n].properties.customSymbolOpacity=0),this.tqDataFl[o][n].properties.hasOwnProperty("isSamePole")){var d=this.tqDataFl[o][n].properties.tgIndex;this.samePoleArr[d].properties.customOpacity=0,a=!0}}r=i.length;for(var c=0;c<r;c++){var g=i[c];this.layerGetSource(g,this.tqDataFl[g]),this.layerGetSource("light"+g,this.lightData[g]),void 0!==this.map.getLayer(g+"-symbol")&&this.layerGetSource(g+"-symbol",this.tqDataFl[g])}a&&this.layerGetSource(this.sameGtItem,this.samePoleArr)}},showLayerFn:function(t){void 0!==this.map.getLayer(t)&&this.map.setLayoutProperty(t,"visibility","visible"),"bdz"==t&&this.map.setLayoutProperty("bdzdyd","visibility","visible")},hideLayerFn:function(t){void 0!==this.map.getLayer(t)&&this.map.setLayoutProperty(t,"visibility","none"),"bdz"==t&&this.map.setLayoutProperty("bdzdyd","visibility","none")},bxAngleReset:function(t){if(this.rightBxInf.zcbh){""==t&&(t=this.rightBxInf.oldAngle);var e=Number(t);this.tqDataFl[this.rightBxInf.layerId][this.rightBxInf.onItemIndex].properties.symbolAngle=e,this.layerGetSource(this.rightBxInf.layerId,this.tqDataFl[this.rightBxInf.layerId]),this.layerGetSource("light"+this.rightBxInf.layerId,this.lightData[this.rightBxInf.layerId])}},layerGetSource:function(t,e){void 0!=t&&void 0!=e&&void 0!=this.map.getSource(t)&&(Array.isArray(e)||(e=[e]),this.map.getSource(t).setData({type:"FeatureCollection",features:e}))},leftAlignFn:function(){this.toolsIndex=2,this.kxAllMove=!1;var t=this.getAllPointData(this.lightData),e=(this.deleteArrNotSortValFn(t),t.length);if(e>1){for(var i=Math.min.apply(Math,t.map((function(t){return t.geometry.coordinates[0]}))),r=0;r<e;r++)if(t[r].geometry.coordinates[0]!==i&&!t[r].properties.hasOwnProperty("parentStation")){var a=i-t[r].geometry.coordinates[0];t[r].geometry.coordinates[0]=i,this.layerGetSource("light"+t[r].properties.psrNo,this.lightData[t[r].properties.psrNo]);var s=t[r].properties.dataInTypeIndex;this.tqDataFl[t[r].properties.psrNo][s].geometry.coordinates=t[r].geometry.coordinates,this.resetLineData(t[r],t[r].geometry.coordinates,a,0)}for(var o in this.setFbRecord(),this.tqDataFl)this.layerGetSource(o,this.tqDataFl[o])}else this.$message.warning("无法左对齐");this.toolsIndex=0},rightAlignFn:function(){this.toolsIndex=3,this.kxAllMove=!1;var t=this.getAllPointData(this.lightData),e=(this.deleteArrNotSortValFn(t),t.length);if(e>1){for(var i=Math.max.apply(Math,t.map((function(t){return t.geometry.coordinates[0]}))),r=0;r<e;r++)if(t[r].geometry.coordinates[0]!==i){var a=i-t[r].geometry.coordinates[0];t[r].geometry.coordinates[0]=i,this.layerGetSource("light"+t[r].properties.psrNo,this.lightData[t[r].properties.psrNo]);var s=t[r].properties.dataInTypeIndex;this.tqDataFl[t[r].properties.psrNo][s].geometry.coordinates=t[r].geometry.coordinates,this.resetLineData(t[r],t[r].geometry.coordinates,a,0)}for(var o in this.setFbRecord(),this.tqDataFl)this.layerGetSource(o,this.tqDataFl[o])}else this.$message.warning("无法右对齐");this.toolsIndex=0},topAlignFn:function(){this.toolsIndex=4,this.kxAllMove=!1;var t=this.getAllPointData(this.lightData),e=(this.deleteArrNotSortValFn(t),t.length);if(e>1){for(var i=Math.max.apply(Math,t.map((function(t){return t.geometry.coordinates[1]}))),r=0;r<e;r++)if(t[r].geometry.coordinates[1]!==i){var a=i-t[r].geometry.coordinates[1];t[r].geometry.coordinates[1]=i,this.layerGetSource("light"+t[r].properties.psrNo,this.lightData[t[r].properties.psrNo]);var s=t[r].properties.dataInTypeIndex;this.tqDataFl[t[r].properties.psrNo][s].geometry.coordinates=t[r].geometry.coordinates,this.resetLineData(t[r],t[r].geometry.coordinates,0,a)}for(var o in this.setFbRecord(),this.tqDataFl)this.layerGetSource(o,this.tqDataFl[o])}else this.$message.warning("请选择2个及以上设备");this.toolsIndex=0},bottomAlignFn:function(){this.toolsIndex=5,this.kxAllMove=!1;var t=this.getAllPointData(this.lightData),e=(this.deleteArrNotSortValFn(t),t.length);if(e>1){for(var i=Math.min.apply(Math,t.map((function(t){return t.geometry.coordinates[1]}))),r=0;r<e;r++)if(t[r].geometry.coordinates[1]!==i){var a=i-t[r].geometry.coordinates[1];t[r].geometry.coordinates[1]=i,this.layerGetSource("light"+t[r].properties.psrNo,this.lightData[t[r].properties.psrNo]);var s=t[r].properties.dataInTypeIndex;this.tqDataFl[t[r].properties.psrNo][s].geometry.coordinates=t[r].geometry.coordinates,this.resetLineData(t[r],t[r].geometry.coordinates,0,a)}for(var o in this.setFbRecord(),this.tqDataFl)this.layerGetSource(o,this.tqDataFl[o])}else this.$message.warning("请选择2个及以上设备");this.toolsIndex=0},traverseFn:function(){this.toolsIndex=6,this.kxAllMove=!1;var t=this.getAllPointData(this.lightData),e=this.deleteArrNotSortValFn(t,!0);t=this.rankingThisArr(t,0);var i=t.length;if(i>2){for(var r=Math.max.apply(Math,t.map((function(t){return t.geometry.coordinates[0]}))),a=Math.min.apply(Math,t.map((function(t){return t.geometry.coordinates[0]}))),s=(r-a)/(i-e-1),o=1,n=0;n<i;n++)if(t[n].geometry.coordinates[0]!==r&&t[n].geometry.coordinates[0]!==a){if(t[n].properties.hasOwnProperty("psrPoledInf")&&t[n].properties.hasOwnProperty("parentPole"))continue;var l=a+s*o-t[n].geometry.coordinates[0];t[n].geometry.coordinates[0]=a+s*o,this.layerGetSource("light"+t[n].properties.psrNo,this.lightData[t[n].properties.psrNo]);var h=t[n].properties.dataInTypeIndex;if(this.tqDataFl[t[n].properties.psrNo][h].geometry.coordinates=t[n].geometry.coordinates,o++,t[n].properties.hasOwnProperty("psrType")&&-1!==t[n].properties.psrType.indexOf("wlgt")&&t[n].properties.hasOwnProperty("psrPoledInf"))for(var p=t[n].properties.psrPoledInf,d=p.length,c=0;c<d;c++){var g=p[c].layerId,y=p[c].dataIndex;this.tqDataFl[g][y].geometry.coordinates[0]=this.tqDataFl[g][y].geometry.coordinates[0]+l,this.layerGetSource("light"+g,this.lightData[g]),this.queryPsrOfLineToLight(this.tqDataFl[g][y]),this.resetLineData(this.tqDataFl[g][y],this.tqDataFl[g][y].geometry.coordinates,l,0)}this.resetLineData(t[n],t[n].geometry.coordinates,l,0)}for(var f in this.setFbRecord(),this.tqDataFl)this.layerGetSource(f,this.tqDataFl[f])}else this.$message.warning("请选择3个及以上设备");this.toolsIndex=0},verticalFbFn:function(){this.toolsIndex=7,this.kxAllMove=!1;var t=this.getAllPointData(this.lightData),e=this.deleteArrNotSortValFn(t,!0);t=this.rankingThisArr(t,1);var i=t.length;if(i>2){for(var r=Math.max.apply(Math,t.map((function(t){return t.geometry.coordinates[1]}))),a=Math.min.apply(Math,t.map((function(t){return t.geometry.coordinates[1]}))),s=(r-a)/(i-e-1),o=1,n=0;n<i;n++)if(t[n].geometry.coordinates[1]!==r&&t[n].geometry.coordinates[1]!==a){if(t[n].properties.hasOwnProperty("psrPoledInf")&&t[n].properties.hasOwnProperty("parentPole"))continue;var l=a+s*o-t[n].geometry.coordinates[1];t[n].geometry.coordinates[1]=a+s*o,this.layerGetSource("light"+t[n].properties.psrNo,this.lightData[t[n].properties.psrNo]);var h=t[n].properties.dataInTypeIndex;if(this.tqDataFl[t[n].properties.psrNo][h].geometry.coordinates=t[n].geometry.coordinates,o++,t[n].properties.hasOwnProperty("psrType")&&-1!==t[n].properties.psrType.indexOf("wlgt")&&t[n].properties.hasOwnProperty("psrPoledInf"))for(var p=t[n].properties.psrPoledInf,d=p.length,c=0;c<d;c++){var g=p[c].layerId,y=p[c].dataIndex;this.tqDataFl[g][y].geometry.coordinates[1]=this.tqDataFl[g][y].geometry.coordinates[1]+l,this.layerGetSource("light"+g,this.lightData[g]),this.queryPsrOfLineToLight(this.tqDataFl[g][y]),this.resetLineData(this.tqDataFl[g][y],this.tqDataFl[g][y].geometry.coordinates,0,l)}this.resetLineData(t[n],t[n].geometry.coordinates,0,l)}for(var f in this.setFbRecord(),this.tqDataFl)this.layerGetSource(f,this.tqDataFl[f])}else this.$message.warning("请选择3个及以上设备");this.toolsIndex=0},rankingThisArr:function(t,e){for(var i=0,r=t.length,a=0;a<r;a++)for(var s=0;s<r;s++)t[a].geometry.coordinates[e]<t[s].geometry.coordinates[e]&&(i=t[a],t[a]=t[s],t[s]=i);return t},deleteArrNotSortValFn:function(t,e){var i=t.length,r=0;if(i>0&&e)for(var a=0;a<i;a++)if(t[a].properties.hasOwnProperty("psrType")&&-1!==t[a].properties.psrType.indexOf("wlgt")&&t[a].properties.hasOwnProperty("psrPoledInf")){var s=t[a].properties.psrPoledInf,o=s.length;r+=o}else;for(var n in this.lightData)this.lightData[n].length>0&&"Polygon"==this.lightData[n][0].geometry.type&&(this.showCustomLayerFn(this.lightData[n],n),this.lightData[n]=[],this.layerGetSource("light"+n,this.lightData[n]));return r},dragDian:function(t){var e=this;if(0===t.originalEvent.button&&(t.preventDefault(),this.map.on("mouseup","lightBigDian",(function(){e.isStop=!0})),!this.isStop)){this.clearRightPanelSbInf();var i=t.features[0].layer.id.replace("light",""),r=t.features[0].properties.lineType,a=t.features[0].properties.lineIndex,s=this.tqDataFl[r][a].properties.onLightDataIndex,o=t.features[0].properties.onDianArrIndex;if("SmallDian"==i){var n=t.features[0].properties.preDianIndex+1;if(this.tqDataFl[r][a].geometry.coordinates.splice(n,0,this.dianData.SmallDian[o].geometry.coordinates),this.tqDataFl[r][a].properties.hasOwnProperty("ofPsrArr"))for(var l=this.tqDataFl[r][a].properties.ofPsrArr,h=l.length,p=0;p<h;p++)if(l[p].onLineIndex>0){this.tqDataFl[r][a].properties.ofPsrArr[p].onLineIndex=l[p].onLineIndex+1;for(var d=this.tqDataFl[l[p].layerName][l[p].onTqFlIndex].properties.ofLineArr,c=d.length,g=0;g<c;g++)if(d[g].id==this.tqDataFl[r][a].properties.id&&d[g].onLineIndex>0){this.tqDataFl[l[p].layerName][l[p].onTqFlIndex].properties.ofLineArr[g].onLineIndex=this.tqDataFl[r][a].properties.ofPsrArr[p].onLineIndex;break}}this.addLightLineDian(this.tqDataFl[r][a])}else this.currDian.onArrIndex=o,this.currDian.dianItem=i,this.currDian.lineData=this.lightData[r][s],this.currDian.lineKey=r;"SmallDian"!==i&&(this.map.on("mousemove",this.onMoveDian),this.map.on("mouseup",this.onUpDian))}},onMoveDian:function(t){this.dianData[this.currDian.dianItem][this.currDian.onArrIndex].geometry.coordinates[0]=t.lngLat.lng,this.dianData[this.currDian.dianItem][this.currDian.onArrIndex].geometry.coordinates[1]=t.lngLat.lat,this.layerGetSource("light"+this.currDian.dianItem,this.dianData[this.currDian.dianItem]);var e=this.currDian.lineData.properties.dataInTypeIndex,i=this.currDian.lineData.properties.onLightDataIndex;this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates=this.lightData[this.currDian.lineKey][i].geometry.coordinates,this.layerGetSource(this.currDian.lineKey,this.tqDataFl[this.currDian.lineKey]),this.layerGetSource("light"+[this.currDian.lineKey],this.lightData[this.currDian.lineKey]);for(var r=this.dianData["SmallDian"],a=r.length,s=this.dianData[this.currDian.dianItem][this.currDian.onArrIndex].properties.onLineIndex,o=0;o<a;o++)if(r[o].properties.preDianIndex==s){var n=(this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s+1][0]-this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s][0])/2+this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s][0],l=(this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s+1][1]-this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s][1])/2+this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s][1];this.dianData["SmallDian"][o].geometry.coordinates[0]=n,this.dianData["SmallDian"][o].geometry.coordinates[1]=l}else if(r[o].properties.preDianIndex==s-1){var h=(this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s][0]-this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s-1][0])/2+this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s-1][0],p=(this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s][1]-this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s-1][1])/2+this.tqDataFl[this.currDian.lineKey][e].geometry.coordinates[s-1][1];this.dianData["SmallDian"][o].geometry.coordinates[0]=h,this.dianData["SmallDian"][o].geometry.coordinates[1]=p}this.layerGetSource("lightSmallDian",this.dianData["SmallDian"])},onUpDian:function(){this.map.off("mousemove",this.onMoveDian),this.map.off("mouseup",this.onUpDian),this.clearCurrDianData()},clearCurrDianData:function(){this.currDian={onArrIndex:"",dianItem:"",lineData:"",lineKey:""}},deleteThisDian:function(){var t=[];for(var e in this.lightData)-1!==e.indexOf("Line")&&(t=t.concat(this.lightData[e]));this.rightMenuVisible=!1;var i=this.rightClickData.properties.onLineIndex,r=this.rightClickData.properties.lineType,a=this.rightClickData.properties.lineIndex;if(this.tqDataFl[r][a].geometry.coordinates.splice(i,1),this.layerGetSource(r,this.tqDataFl[r]),this.layerGetSource("light"+r,this.lightData[r]),this.tqDataFl[r][a].properties.hasOwnProperty("ofPsrArr"))for(var s=this.tqDataFl[r][a].properties.ofPsrArr,o=s.length,n=0;n<o;n++)if(s[n].onLineIndex>0){this.tqDataFl[r][a].properties.ofPsrArr[n].onLineIndex=s[n].onLineIndex-1;for(var l=this.tqDataFl[s[n].layerName][s[n].onTqFlIndex].properties.ofLineArr,h=l.length,p=0;p<h;p++)if(l[p].id==this.tqDataFl[r][a].properties.id&&l[p].onLineIndex>0){this.tqDataFl[s[n].layerName][s[n].onTqFlIndex].properties.ofLineArr[p].onLineIndex=this.tqDataFl[r][a].properties.ofPsrArr[n].onLineIndex;break}}this.addLightLineDian(this.tqDataFl[r][a])},importDLPoint:function(t){var e=this;this.rightMenuVisible=!1,console.log("电缆拐点导入:",JSON.stringify(this.rightClickData));var i=this.tqDataFl[a][s].geometry.coordinates.length,r=[];if(flag)return r=2!==i?this.tqDataFl[a][s].geometry.coordinates.map((function(t){return{PSRID:e.rightClickData.properties.psrId,"设备类型":e.rightClickData.properties.psrTypeName,"设备名称":e.rightClickData.properties.name,"拐点坐标(x,y),只支持大地2000坐标":t}})):[{"设备类型":"","设备名称":"",PSRID:"","拐点坐标(x,y),只支持大地2000坐标":""}],void h["a"].exportExcel(r,"电缆拐点导入"+this.getCurrTime(),[{wpx:120},{wpx:140},{wpx:180},{wpx:260}]);var a=this.rightClickData.properties.psrNo,s=this.rightClickData.properties.dataInTypeIndex;if(JSON.stringify(this.tqDataFl[a][s].geometry.coordinates[0])!=JSON.stringify(this.tqDataFl[a][s].geometry.coordinates[i-1])){this.tqDataFl[a][s].properties.onLightDataIndex;for(var o=1;o<i-1;o++)this.tqDataFl[a][s].geometry.coordinates.splice(o,1),o--,i--;if(this.layerGetSource(a,this.tqDataFl[a]),this.layerGetSource("light"+a,this.lightData[a]),this.tqDataFl[a][s].properties.hasOwnProperty("ofPsrArr"))for(var n=this.tqDataFl[a][s].properties.ofPsrArr,l=n.length,p=0;p<l;p++)if(n[p].onLineIndex>0){this.tqDataFl[a][s].properties.ofPsrArr[p].onLineIndex=1;for(var d=this.tqDataFl[n[p].layerName][n[p].onTqFlIndex].properties.ofLineArr,c=d.length,g=0;g<c;g++)if(d[g].id==this.tqDataFl[a][s].properties.id&&d[g].onLineIndex>0){this.tqDataFl[n[p].layerName][n[p].onTqFlIndex].properties.ofLineArr[g].onLineIndex=1;break}}void 0!==this.map.getLayer("lightBigDian")&&(this.addLightLineDian(this.tqDataFl[a][s]),0==this.dianData.BigDian.length&&(this.map.removeLayer("lightBigDian"),this.map.removeSource("lightBigDian")))}else this.$message.warning("线两端坐标相等，不可设置")},setZLine:function(t,e,i){this.rightMenuVisible=!1;var r=null,a=null;e?(r=e,a=i):(r=this.rightClickData.properties.psrNo,a=this.rightClickData.properties.dataInTypeIndex);var s=this.tqDataFl[r][a].geometry.coordinates.length;if(2!=s)if(JSON.stringify(this.tqDataFl[r][a].geometry.coordinates[0])!=JSON.stringify(this.tqDataFl[r][a].geometry.coordinates[s-1])){this.tqDataFl[r][a].properties.onLightDataIndex;for(var o=1;o<s-1;o++)this.tqDataFl[r][a].geometry.coordinates.splice(o,1),o--,s--;if(this.layerGetSource(r,this.tqDataFl[r]),this.layerGetSource("light"+r,this.lightData[r]),this.tqDataFl[r][a].properties.hasOwnProperty("ofPsrArr"))for(var n=this.tqDataFl[r][a].properties.ofPsrArr,l=n.length,h=0;h<l;h++)if(n[h].onLineIndex>0){this.tqDataFl[r][a].properties.ofPsrArr[h].onLineIndex=1;for(var p=this.tqDataFl[n[h].layerName][n[h].onTqFlIndex].properties.ofLineArr,d=p.length,c=0;c<d;c++)if(p[c].id==this.tqDataFl[r][a].properties.id&&p[c].onLineIndex>0){this.tqDataFl[n[h].layerName][n[h].onTqFlIndex].properties.ofLineArr[c].onLineIndex=1;break}}void 0!==this.map.getLayer("lightBigDian")&&(this.addLightLineDian(this.tqDataFl[r][a]),0==this.dianData.BigDian.length&&(this.map.removeLayer("lightBigDian"),this.map.removeSource("lightBigDian")))}else this.$message.warning("线两端坐标相等，不可设置")},handleNodeClick:function(t){var e;if(t.hasOwnProperty("onDataIndex")){var i=t.type,r=t.onDataIndex;if("bdz"==i&&this.tqDataFl[i][r].properties.hasOwnProperty("relateDyd")){var a=this.tqDataFl[i][r].properties.relateDyd.layerId,s=this.tqDataFl[i][r].properties.relateDyd.onItemIndex;i=a,r=s}0!=this.tqDataFl[i][r].properties.customOpacity&&(this.isLeftTreeNodeClick=!0,this.clearRightPanelSbInf(),this.removeLightLayer(),this.showRightPsrInf(this.tqDataFl[i][r]),"Point"==this.tqDataFl[i][r].geometry.type?e=this.tqDataFl[i][r].geometry.coordinates:"LineString"==this.tqDataFl[i][r].geometry.type?e=this.tqDataFl[i][r].geometry.coordinates[0]:"Polygon"==this.tqDataFl[i][r].geometry.type&&(e=this.getPolygonCenterZb(this.tqDataFl[i][r].geometry.coordinates)),this.addToLightData(this.tqDataFl[i][r],this.lightData,!0),this.setFbRecord(),this.map.easeTo({center:e,zoom:21.5}))}},queryDcTooLongLine:function(){var t=this;if(null!=this.samePoleData){var e=[];for(var i in this.samePoleData)this.samePoleData[i].length>0&&(e=e.concat(this.samePoleData[i]));for(var r=e.length,a=0;a<r;a++)if(e[a].hasOwnProperty("tqOfTongganPsr")){var s=e[a].tqOfTongganPsr.item,o=e[a].tqOfTongganPsr.index;if(this.tqDataFl[s][o].properties.hasOwnProperty("dcNeedChangePsr"))for(var n=this.tqDataFl[s][o].properties.dcNeedChangePsr,l=n.length,h=function(){var e=n[p].item,i=n[p].index,r=n[p].dataFlType,a=n[p].zbType,s=n[p].id.replace(t[r][e][i].properties.id,"");if("LineString"==a){var o=0,l=t.gisName.GeometryUtil.distanceOfLine(t[r][e][i].geometry.coordinates),h=e.replace(s,""),d=t.type;if(t[r][e][i].properties.hasOwnProperty("parentPsrtype")){var c=t[r][e][i].properties.parentPsrtype;d="dytq"==c?"02":"dkx"==c?"01":"03"}"03"==d?o=t.checkConfigInfo.td.all:"02"!=d&&"01"!=d||(o="dianLine"==h?t.checkConfigInfo.ds.dld:"xuLine"==h?t.checkConfigInfo.ds.cljx:"daoLine"==h?t.checkConfigInfo.ds.djd:t.checkConfigInfo.ds.ljx),l>o&&t.dataToCompareArr(t[r][e][i],t.dcLongLineArr,!1,(function(){t.dcLongLineArr.push(t[r][e][i])}))}},p=0;p<l;p++)h()}console.log("对侧超长的线的数据-------",JSON.stringify(this.dcLongLineArr))}},checkDcfx:function(){if(this.queryDcTooLongLine(),this.dcLongLineArr&&this.dcLongLineArr.length){var t=this.dcLongLineArr.map((function(t){return{psrId:t.properties.parentPsrid,name:"",fxPsrId:t.properties.psrId,fxName:t.properties.name,fxType:t.properties.psrName}}));this.childTableData=[],this.childTableData=Object(s["a"])(t),this.isSave=!1,this.tableShow=!0}else this.$message.success("未检测到对侧飞线数据")},gisSave:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(){var e,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.isLock){t.next=2;break}return t.abrupt("return");case 2:if(!this.isAuditLock){t.next=5;break}return this.$message.warning("该图纸已锁定!请在完成变更审核后,再进行坐标治理！"),t.abrupt("return");case 5:return t.next=7,this.getAuditLockByPsr();case 7:if(!t.sent){t.next=10;break}return this.$message.warning("该图纸已锁定!请在完成变更审核后,再进行坐标治理！"),t.abrupt("return");case 10:if(this.gisData={type:this.tqData.type,crs:this.tqData.crs,features:[]},0!=this.dataSubType){t.next=21;break}if(this.updateDragBx("fb"),this.compareDataToGetChangeData(),0!=this.beChangeData.length){t.next=17;break}return this.$message.warning("无数据变动，无需发布!"),t.abrupt("return");case 17:this.gisData.features=this.beChangeData,this.dialogTxfbVisible=!0,t.next=26;break;case 21:for(i in this.dialogTxfbVisible=!0,this.updateDragBx("fb"),e=[],this.tqDataFl)this.tqDataFl[i].length>0&&"bdzdyd"!==i&&(this.tqDataFl[i][0].properties.hasOwnProperty("parentPole")?this.recoveryYxgtId(this.tqDataFl[i]):"bdz"==i&&this.recoveryDydLine(this.tqDataFl[i]),e=e.concat(this.tqDataFl[i]));this.gisData.features=e;case 26:this.queryDcTooLongLine(),console.log("gisSave---:",JSON.stringify(this.gisData));case 28:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleDialogTxfbQrBtn:function(){if(this.dcLongLineArr&&this.dcLongLineArr.length){var t=this.dcLongLineArr.map((function(t){return{psrId:t.properties.parentPsrid,name:"",fxPsrId:t.properties.psrId,fxName:t.properties.name,fxType:t.properties.psrName}}));this.childTableData=[],this.childTableData=Object(s["a"])(t),this.isSave=!0,this.tableShow=!0}else this.dialogTxfbQrBtn()},dialogTxfbQrBtn:function(){var t=this;this.pointToLineString(),this.loading=!0,this.isDisabled=!0,setTimeout((function(){t.isDisabled=!1}),2e3),this.dialogTxfbVisible=!1;var e="";e=1==this.dataNewJeoInfo?this.lineType:this.psrType,console.log("飞线数据：",this.tongganJSON),this.updateDragBx("fb");var i=[];for(var r in this.tqDataFl)this.tqDataFl[r].length>0&&"bdzdyd"!==r&&(this.tqDataFl[r][0].properties.hasOwnProperty("parentPole")?this.recoveryYxgtId(this.tqDataFl[r]):"bdz"==r&&this.recoveryDydLine(this.tqDataFl[r]),i=i.concat(this.tqDataFl[r]));this.gisDataAll.features=i,console.log("================>",this.gisOldData),Object(I["J"])(this.psrId,e,this.lineId,this.lineType,JSON.stringify(this.gisData),this.shebeiId,JSON.stringify(this.gisDataAll),this.tqName,JSON.stringify(this.gisOldData)).then((function(i){t.loading=!1,"0"==i.code?(t.dialogTxfbVisible=!1,t.beChangeData=[],t.$notify({title:"成功",message:"图形发布成功",type:"success",duration:2e3}),Object(I["R"])(t.psrId,e,t.lineId,t.lineType,JSON.stringify(t.gisData),t.shebeiId).then((function(t){})).catch((function(e){t.loading=!1})),i.message&&"succ"!=i.message&&t.$message.error(i.message),i.data&&i.data.length&&(t.childTableData=[],t.childTableData=Object(s["a"])(i.data),t.tableShow=!0),0==t.dataSubType&&(t.originalTqData=JSON.parse(JSON.stringify(t.tqDataFl))),t.flyingTableData=[],t.getTooLongLineFn("fb"),t.lineDataNeedToPointChange()):("50"==i.code||"51"==i.code||"52"==i.code||"01"==i.code||"02"==i.code?t.$notify.error({title:"网络坐标转换失败",message:"网络或坐标转换问题,请勿关闭页面,稍后重新点击发布！！！",duration:2e3}):t.$notify.error({title:"接口数据获取失败",message:i.message,duration:2e3}),t.dialogTxfbVisible=!0)})).catch((function(e){t.loading=!1,t.lineDataNeedToPointChange(),t.flyingTableData=[],t.getTooLongLineFn("fb"),t.dialogTxfbVisible=!0}))},recoveryYxgtId:function(t){for(var e=t.length,i=0;i<e;i++){var r=t[i].properties.psrNo,a=t[i].properties.dataInTypeIndex;this.tqDataFl[r][a].properties.id=this.tqDataFl[r][a].properties.id.replace("_yxgt","")}},recoveryDydLine:function(t){for(var e=t.length,i=0;i<e;i++)if(t[i].properties.hasOwnProperty("ofLineArr"))for(var r=t[i].properties.ofLineArr,a=r.length,s=0;s<a;s++){var o=r[s].layerName,n=r[s].onTqFlIndex;if(this.tqDataFl[o][n].properties.hasOwnProperty("oldOnBdzPoint")){var l=this.tqDataFl[o][n].properties.oldOnBdzPoint,h=l.onLineIndex,p=JSON.parse(JSON.stringify(l.zb)),d=this.tqDataFl[o][n].geometry.coordinates.length;0!==h&&h!==d-1&&(h=d-1),this.tqDataFl[o][n].geometry.coordinates[h]=p}}},tempSave:function(){var t=this,e={type:this.tqData.type,crs:this.tqData.crs,features:[]},i=[];for(var r in this.pointToLineString(),this.tqDataFl)this.tqDataFl[r].length>0&&(i=i.concat(this.tqDataFl[r]));e.features=i,Object(I["tempSave"])(this.psrId,this.psrType,this.lineId,this.lineType,JSON.stringify(e)).then((function(e){t.$notify({title:"成功",message:"图形暂存成功",type:"success",duration:2e3})}))},beforeFbShowChange:function(){this.psrChangeDataTypeTj=[];var t={},e=this.beChangeData.length;if(e>0)for(var i=0;i<e;i++){var r={};if(this.beChangeData[i].properties.hasOwnProperty("psrId")&&1==this.beChangeData[i].properties.customOpacity){r="Point"==this.beChangeData[i].geometry.type?{sbbh:this.beChangeData[i].properties.psrId,sbmc:this.beChangeData[i].properties.name,sbzb:this.beChangeData[i].geometry.coordinates,sblx:this.beChangeData[i].properties.psrName,onDataItem:this.beChangeData[i].properties.psrNo,onDataIndex:this.beChangeData[i].properties.dataInTypeIndex}:"LineString"==this.beChangeData[i].geometry.type?{sbbh:this.beChangeData[i].properties.psrId,sbmc:this.beChangeData[i].properties.name,sbzb:this.beChangeData[i].geometry.coordinates[0],sblx:this.beChangeData[i].properties.psrName,onDataItem:this.beChangeData[i].properties.psrNo,onDataIndex:this.beChangeData[i].properties.dataInTypeIndex}:{sbbh:this.beChangeData[i].properties.psrId,sbmc:this.beChangeData[i].properties.name,sbzb:this.beChangeData[i].geometry.coordinates[0][0],sblx:this.beChangeData[i].properties.psrName,onDataItem:this.beChangeData[i].properties.psrNo,onDataIndex:this.beChangeData[i].properties.dataInTypeIndex};var a=this.beChangeData[i].properties.psrNo;t.hasOwnProperty(a)||this.$set(t,a,[]),t[a].push(this.beChangeData[i]),this.psrChangeTableData.push(r)}}for(var s in t){var o={psrName:t[s][0].properties.psrName,psrNum:t[s].length};this.psrChangeDataTypeTj.push(o)}},pointToLineString:function(){for(var t in this.oldLineToDian)if(this.oldLineToDian[t].length>0)for(var e=this.oldLineToDian[t],i=e.length,r=0;r<i;r++){var a=e[r].properties.dataInTypeIndex;this.tqDataFl[t][a].geometry=JSON.parse(JSON.stringify(e[r].geometry))}},onePointToLineChange:function(t,e){for(var i=this.oldLineToDian[e],r=i.length,a=0;a<r;a++)if(t.properties.id==i[a].properties.id){var s=i[a].properties.dataInTypeIndex;this.tqDataFl[e][s].geometry=JSON.parse(JSON.stringify(i[a].geometry));break}},lineDataNeedToPointChange:function(){for(var t in this.oldLineToDian)for(var e=this.oldLineToDian[t],i=e.length,r=0;r<i;r++){var a=e[r].properties.psrNo,s=e[r].properties.dataInTypeIndex;if("LineString"==this.tqDataFl[a][s].geometry.type){var o={type:"Point",coordinates:e[r].geometry.coordinates[1]};this.tqDataFl[a][s].geometry=o,this.originalTqData[a][s].geometry=o}}},uploadFileGeoJSON:function(t){for(var e in this.toolIndex=0,this.isDragEditBx=!1,this.loading=!0,this.topMenuIndexVal=0,this.styleChangeFlag=!1,this.tqDataFl)this.map.off("mousedown",e,this.dragBx),"bdz"==e&&this.map.off("mousedown",e+"-symbol",this.dragBx);this.removeCustomLayer(this.tqDataFl),this.removeLightLayer(),this.setLayerData(t)},removeCustomLayer:function(t){if(0!==Object.keys(t).length)for(var e in t)void 0!==this.map.getLayer(e)&&(this.map.removeLayer(e),this.map.removeSource(e),void 0!==this.map.getLayer(e+"-symbol")&&(this.map.removeLayer(e+"-symbol"),this.map.removeSource(e+"-symbol")),this.map.hasImage(e+"Img")&&this.map.removeImage(e+"Img"),delete t[e]);t={}},recallPsrFn:function(){var t=this;this.updateAndRemoveLightLayer(),this.rightMenuVisible=!1,this.mapLoading=!0,"03"==this.type&&(this.gyRecallVal=""),setTimeout((function(){t.rightClickRecallFdfx()}),100)},rightClickRecallFdfx:function(){if(this.needRecallDataArr=[],"{}"!==JSON.stringify(this.recallPositon.layerPros)){var t=this.recallPositon.layerPros.dataInTypeIndex,e=this.recallPositon.layerPros.psrNo;if(this.lightData[e]=[],this.isYxyh&&!this.tqDataFl[e][t].properties.hasOwnProperty("deviceType"))return this.mapLoading=!1,void this.$message.warning("运检设备不可召回！");var i={line:this.tqDataFl[e][t],group1:[],group2:[],needRecallGroup:""};if(this.needRecallDataArr.push(i),this.addToLightData(this.tqDataFl[e][t],this.lightData,!0),"03"==this.type){if(console.log(Object(l["a"])(this.recallPositon.layerPros.ofPsrArr)),!this.recallPositon.layerPros.hasOwnProperty("ofPsrArr"))return void(this.mapLoading=!1);if("string"==typeof this.recallPositon.layerPros.ofPsrArr&&(this.recallPositon.layerPros.ofPsrArr=JSON.parse(this.recallPositon.layerPros.ofPsrArr)),2!=this.recallPositon.layerPros.ofPsrArr.length||-1===this.recallPositon.layerPros.ofPsrArr[0].layerName.indexOf("yxgt")||-1===this.recallPositon.layerPros.ofPsrArr[1].layerName.indexOf("yxgt"))return this.mapLoading=!1,this.$message.warning("请选择两端都是杆塔的线"),void this.removeLightTcByMsgHide();var r=this.recallPositon.layerPros.ofPsrArr[0],a=this.recallPositon.layerPros.ofPsrArr[1],s=this.tqDataFl[r.layerName][r.onTqFlIndex].properties.psrId,o=this.tqDataFl[a.layerName][a.onTqFlIndex].properties.psrId;this.gyRecallVal=s>o?a.id:r.id,console.log("id小的运行杆塔：----",this.gyRecallVal)}}this.findNextPsrByLine(this.needRecallDataArr[0].line,"",0,""),this.judgeLoopEndFn()},judgeLoopEndFn:function(){var t=this;setTimeout((function(){t.isLoopEnd?(console.log("judgeLoopEndFn-isLoopEnd-true-----循环结束"),t.toGetRecallGroup()):(console.log("judgeLoopEndFn-isLoopEnd-false"),t.judgeLoopEndFn())}),100)},findNextPsrByLine:function(t,e,i,r){var a=this;this.isLoopEnd=!1;var s=!1;if(t.properties.hasOwnProperty("ofPsrArr"))for(var o=t.properties.ofPsrArr,n=o.length,l=function(){var n=o[h].layerName,l=o[h].onTqFlIndex,p=0==o[h].onLineIndex?0:1;if(e&&""!=e)a.tqDataFl[n][l].properties.id!==r&&a.dataToCompareArr(a.tqDataFl[n][l],a.needRecallDataArr[i][e],!1,(function(){if(a.needRecallDataArr[i][e].push(a.tqDataFl[n][l]),a.tqDataFl[n][l].properties.hasOwnProperty("isSamePole")&&a.setHasTgNeedZhaohuiGroup(i,e),a.isYxyh&&a.tqDataFl[n][l].properties.hasOwnProperty("deviceType")||!a.isYxyh&&("02"==a.type&&"xsb"!==a.tqDataFl[n][l].properties.psrObjFlType&&"pds"!==a.tqDataFl[n][l].properties.psrObjFlType&&"byq"!==a.tqDataFl[n][l].properties.psrObjFlType||"01"==a.type&&"bdz"!==a.tqDataFl[n][l].properties.psrObjFlType||"03"==a.type&&a.gyRecallVal!==a.tqDataFl[n][l].properties.id))a.findNextLineByPsr(a.tqDataFl[n][l],e,i,t.properties.id),s=!0;else{var r=a.needRecallDataArr[i].needRecallGroup,o="";o="group1"==e?"group2":"group1",""==r?a.needRecallDataArr[i].needRecallGroup=o:-1==r.indexOf(o)&&(a.needRecallDataArr[i].needRecallGroup=r+","+o),s=!1}if(a.tqDataFl[n][l].properties.hasOwnProperty("psrPoledInf"))for(var h=a.tqDataFl[n][l].properties.psrPoledInf,p=h.length,d=function(){var r=h[c].layerId,o=h[c].dataIndex;a.dataToCompareArr(a.tqDataFl[r][o],a.needRecallDataArr[i][e],!1,(function(){if(a.needRecallDataArr[i][e].push(a.tqDataFl[r][o]),a.tqDataFl[r][o].properties.hasOwnProperty("isSamePole")&&a.setHasTgNeedZhaohuiGroup(i,e),a.isYxyh&&a.tqDataFl[r][o].properties.hasOwnProperty("deviceType")||!a.isYxyh&&("02"==a.type&&"xsb"!==a.tqDataFl[r][o].properties.psrObjFlType&&"pds"!==a.tqDataFl[r][o].properties.psrObjFlType&&"byq"!==a.tqDataFl[r][o].properties.psrObjFlType||"01"==a.type&&"bdz"!==a.tqDataFl[r][o].properties.psrObjFlType||"03"==a.type&&a.gyRecallVal!==a.tqDataFl[r][o].properties.id))a.findNextLineByPsr(a.tqDataFl[r][o],e,i,t.properties.id),s=!0;else{var n=a.needRecallDataArr[i].needRecallGroup,l="";l="group1"==e?"group2":"group1",""==n?a.needRecallDataArr[i].needRecallGroup=l:-1==n.indexOf(l)&&(a.needRecallDataArr[i].needRecallGroup=n+","+l),s=!1}}))},c=0;c<p;c++)d()}));else{if(a.needRecallDataArr[i].hasOwnProperty("group"+(p+1))||a.$set(a.needRecallDataArr[i],"group"+(p+1),[]),a.needRecallDataArr[i]["group"+(p+1)].push(a.tqDataFl[n][l]),a.tqDataFl[n][l].properties.hasOwnProperty("isSamePole")&&a.setHasTgNeedZhaohuiGroup(i,"group"+(p+1)),console.log("this.type====>",a.type),console.log("psrObjFlType====>",a.tqDataFl[n][l].properties.psrObjFlType),a.isYxyh&&a.tqDataFl[n][l].properties.hasOwnProperty("deviceType")||!a.isYxyh&&("02"==a.type&&"xsb"!==a.tqDataFl[n][l].properties.psrObjFlType&&"pds"!==a.tqDataFl[n][l].properties.psrObjFlType&&"byq"!==a.tqDataFl[n][l].properties.psrObjFlType||"01"==a.type&&"bdz"!==a.tqDataFl[n][l].properties.psrObjFlType||"03"==a.type&&a.gyRecallVal!==a.tqDataFl[n][l].properties.id))a.findNextLineByPsr(a.tqDataFl[n][l],"group"+(p+1),i,t.properties.id),s=!0;else{console.log("--------------------------------",a.gyRecallVal,",-----------------:",a.tqDataFl[n][l].properties.id);var d=a.needRecallDataArr[i].needRecallGroup,c="";c=0==p?"group2":"group1",console.log("cuurGroupName===>",c),console.log("nowNeedCallGroup===>",d),""==d?(console.log("nowNeedCallGroup1===>",d),a.needRecallDataArr[i].needRecallGroup=c):-1==d.indexOf(c)&&(a.needRecallDataArr[i].needRecallGroup=d+","+c),console.log("nowNeedCallGroup===>",d),s=!1}if(a.tqDataFl[n][l].properties.hasOwnProperty("psrPoledInf"))for(var g=a.tqDataFl[n][l].properties.psrPoledInf,y=g.length,f=function(){var o=g[u].layerId,n=g[u].dataIndex;a.tqDataFl[o][n].properties.id!==r&&a.dataToCompareArr(a.tqDataFl[o][n],a.needRecallDataArr[i][e],!1,(function(){if(a.needRecallDataArr[i]["group"+(p+1)].push(a.tqDataFl[o][n]),a.tqDataFl[o][n].properties.hasOwnProperty("isSamePole")&&a.setHasTgNeedZhaohuiGroup(i,"group"+(p+1)),a.isYxyh&&a.tqDataFl[o][n].properties.hasOwnProperty("deviceType")||!a.isYxyh&&("02"==a.type&&"xsb"!==a.tqDataFl[o][n].properties.psrObjFlType&&"pds"!==a.tqDataFl[o][n].properties.psrObjFlType&&"byq"!==a.tqDataFl[o][n].properties.psrObjFlType||"01"==a.type&&"bdz"!==a.tqDataFl[o][n].properties.psrObjFlType||"03"==a.type&&a.gyRecallVal!==a.tqDataFl[o][n].properties.id))a.findNextLineByPsr(a.tqDataFl[o][n],"group"+(p+1),i,t.properties.id),s=!0;else{console.log("-----------------物理杆塔---------------");var e=a.needRecallDataArr[i].needRecallGroup,r="";r=0==p?"group2":"group1",""==e?a.needRecallDataArr[i].needRecallGroup=r:-1==e.indexOf(r)&&(a.needRecallDataArr[i].needRecallGroup=e+","+r),s=!1}}))},u=0;u<y;u++)f()}},h=0;h<n;h++)l();if(t.properties.hasOwnProperty("ofLineArr"))for(var p=t.properties.ofLineArr,d=p.length,c=function(){var o=p[g].layerName,n=p[g].onTqFlIndex,l=0==p[g].onLineIndex?0:1;a.tqDataFl[o][n].properties.id!==a.needRecallDataArr[i].line.properties.id&&(e&&""!=e?a.tqDataFl[o][n].properties.id!==r&&a.dataToCompareArr(a.tqDataFl[o][n],a.needRecallDataArr[i][e],!1,(function(){a.needRecallDataArr[i][e].push(a.tqDataFl[o][n]),a.findNextPsrByLine(a.tqDataFl[o][n],e,i,t.properties.id),s=!0})):(a.needRecallDataArr[i].hasOwnProperty("group"+(l+1))||a.$set(a.needRecallDataArr[i],"group"+(l+1),[]),a.tqDataFl[o][n].properties.id!==r&&a.dataToCompareArr(a.tqDataFl[o][n],a.needRecallDataArr[i]["group"+(l+1)],!1,(function(){a.needRecallDataArr[i]["group"+(l+1)].push(a.tqDataFl[o][n]),a.findNextPsrByLine(a.tqDataFl[o][n],"group"+(l+1),i,t.properties.id),s=!0}))))},g=0;g<d;g++)c();s||(this.isLoopEnd=!0)},findNextLineByPsr:function(t,e,i,r){var a=this;this.isLoopEnd=!1;var s=!1;if(t.properties.hasOwnProperty("ofLineArr"))for(var o=t.properties.ofLineArr,n=o.length,l=function(){var n=o[h].layerName,l=o[h].onTqFlIndex;a.tqDataFl[n][l].properties.id!==r&&a.dataToCompareArr(a.tqDataFl[n][l],a.needRecallDataArr[i][e],!1,(function(){a.needRecallDataArr[i][e].push(a.tqDataFl[n][l]),a.findNextPsrByLine(a.tqDataFl[n][l],e,i,t.properties.id),s=!0}))},h=0;h<n;h++)l();s||(this.isLoopEnd=!0)},setHasTgNeedZhaohuiGroup:function(t,e){this.needRecallDataArr[t].hasOwnProperty("tongGanGroup")||this.$set(this.needRecallDataArr[t],"tongGanGroup",""),""==this.needRecallDataArr[t].tongGanGroup?this.needRecallDataArr[t].tongGanGroup=e:-1==this.needRecallDataArr[t].tongGanGroup.indexOf(e)&&(this.needRecallDataArr[t].tongGanGroup=this.needRecallDataArr[t].tongGanGroup+","+e)},toGetRecallGroup:function(){var t=this;console.log("需要查找下游的集合：",JSON.stringify(this.needRecallDataArr)),this.mapLoading=!1,this.gyRecallVal="";for(var e=this.needRecallDataArr.length,i=!1,r=!1,a=0;a<e;a++)if(""!==this.needRecallDataArr[a].needRecallGroup){var s=this.needRecallDataArr[a].needRecallGroup.split(",");if(1==s.length){if(r||(r=!0),this.needRecallDataArr[a].hasOwnProperty("tongGanGroup")&&-1!==this.needRecallDataArr[a].tongGanGroup.indexOf(this.needRecallDataArr[a].needRecallGroup)){console.log("召回中有同杆数据-------------------"),i=!0;break}}else console.log("该条线出现闭环路线中，暂不支持召回------------------",this.needRecallDataArr[a].line.properties.id)}else this.$message.closeAll(),this.$message.warning("无法召回"),console.log("无法召回的啊----：0个上游"),this.removeLightTcByMsgHide();r&&(i?this.$confirm("检测到召回数据中含有同杆数据，确认召回？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){t.toLoopNeedRecallGroup()})).catch((function(){t.removeLightLayer()})):this.toLoopNeedRecallGroup())},toLoopNeedRecallGroup:function(){for(var t=this,e=this.needRecallDataArr.length,i=0,r=function(r){if(""!==t.needRecallDataArr[r].needRecallGroup){var a=t.needRecallDataArr[r].needRecallGroup.split(",");if(1==a.length){var s=[];if(console.log(t.lineForm.isRound),"group2"===a[0]&&"jlx"===t.needRecallDataArr[r].group2[0].properties.psrObjFlType&&"true"===t.lineForm.isRound)for(var o=t.needRecallDataArr[r].line.geometry.coordinates[0][0],n=t.needRecallDataArr[r].line.geometry.coordinates[0][1],l=0;l<e;l++)if(r!=l){var h=t.needRecallDataArr[l].needRecallGroup.split(",");1==h.length&&"group2"==h[0]&&"jlx"==t.needRecallDataArr[l].group2[0].properties.psrObjFlType&&t.needRecallDataArr[l].line.geometry.coordinates[0][0]==o&&t.needRecallDataArr[l].line.geometry.coordinates[0][1]==n&&(r<l?(s.length&&s.includes(r)||s.push(r),s.push(l)):s.push(l))}else s.length>0&&s.push(r);console.log("筛选环状召回设备坐标",JSON.stringify(s));var p=0,d=0;s.includes(r)?(p=360/s.length,d=s.findIndex((function(t){return t===r}))):p=-1,console.log("下游高亮名----：",t.needRecallDataArr[r].needRecallGroup),t.recallPsrToLightLayer(t.needRecallDataArr[r].needRecallGroup,r,p,d),i++}}},a=0;a<e;a++)r(a);i>0&&(console.log("召回的暂存编辑记录---------------------------"),this.setFbRecord())},recallPsrToLightLayer:function(t,e,i,r){void 0!==this.map.getLayer("lightSmallDian")&&this.removeLightDian();var a=this.needRecallDataArr[e][t],s=a.length,o=t.replace("group",""),n=this.needRecallDataArr[e].line.geometry.coordinates.length;console.log("groupIndex:",o,JSON.stringify(this.needRecallDataArr[e].line.geometry.coordinates));var l=this.needRecallDataArr[e].line.properties.psrNo,h=this.needRecallDataArr[e].line.properties.dataInTypeIndex;if(!this.isYxyh||this.tqDataFl[l][h].properties.hasOwnProperty("deviceType")){var p=null,d=null,c=null,g=null,y=!1;if(i>-1&&(y=!0),console.log("==========飞点飞线设置："+this.recallPositon.lng),""!==this.recallPositon.lng)"1"==o?(c=this.recallPositon.lng-this.needRecallDataArr[e].line.geometry.coordinates[0][0],g=this.recallPositon.lat-this.needRecallDataArr[e].line.geometry.coordinates[0][1],this.needRecallDataArr[e].line.geometry.coordinates[0]=[this.recallPositon.lng,this.recallPositon.lat]):"2"==o&&(c=this.recallPositon.lng-this.needRecallDataArr[e].line.geometry.coordinates[n-1][0],g=this.recallPositon.lat-this.needRecallDataArr[e].line.geometry.coordinates[n-1][1],this.needRecallDataArr[e].line.geometry.coordinates[n-1]=[this.recallPositon.lng,this.recallPositon.lat]);else{var f=0,u=0,m=0,D=0,b=0,x=0;"1"==o?(f=this.needRecallDataArr[e].line.geometry.coordinates[n-1][0],u=this.needRecallDataArr[e].line.geometry.coordinates[n-1][1],m=this.needRecallDataArr[e].line.geometry.coordinates[0][0],D=this.needRecallDataArr[e].line.geometry.coordinates[0][1]):"2"==o&&(f=this.needRecallDataArr[e].line.geometry.coordinates[0][0],u=this.needRecallDataArr[e].line.geometry.coordinates[0][1],m=this.needRecallDataArr[e].line.geometry.coordinates[n-1][0],D=this.needRecallDataArr[e].line.geometry.coordinates[n-1][1]),(m>f||m==f)&&D>u?(b=1e-4,x=1e-4):(m>f||m==f)&&D<u?(b=1e-4,x=-1e-4):(m<f||m==f)&&D>u?(b=-1e-4,x=1e-4):(m<f||m==f)&&D<u&&(b=-1e-4,x=-1e-4),console.log("dVal:------------",b,x,o,JSON.stringify(this.needRecallDataArr[e].line.geometry.coordinates));var v=this.gisName.GeometryUtil.closestOnLine([f+b,u+x],[[f,u],[m,D]]);console.log("customLineDian:---",JSON.stringify(v)),v.geometry.coordinates[0]==f&&v.geometry.coordinates[1]==u&&(v.geometry.coordinates[0]=v.geometry.coordinates[0]+b,v.geometry.coordinates[1]=v.geometry.coordinates[1]+x),c=v.geometry.coordinates[0]-m,g=v.geometry.coordinates[1]-D,console.log("画圆前："+JSON.stringify(v.geometry.coordinates));var L=i*(Math.PI/180)*r;if("1"==o){if(y){var I=this.needRecallDataArr[e].line.geometry.coordinates[n-1][0],P=this.needRecallDataArr[e].line.geometry.coordinates[n-1][1],F=I+15e-6*Math.cos(L),T=P+15e-6*Math.sin(L);v.geometry.coordinates=[F,T]}this.needRecallDataArr[e].line.geometry.coordinates[0]=v.geometry.coordinates}else if("2"==o){if(y){var q=this.needRecallDataArr[e].line.geometry.coordinates[0][0],O=this.needRecallDataArr[e].line.geometry.coordinates[0][1],S=q+15e-6*Math.cos(L),N=O+15e-6*Math.sin(L);v.geometry.coordinates=[S,N]}this.needRecallDataArr[e].line.geometry.coordinates[n-1]=v.geometry.coordinates}p=v.geometry.coordinates[0],d=v.geometry.coordinates[1],console.log("画圆："+JSON.stringify(v.geometry.coordinates))}if(console.log("有点，可召回----",c,g,JSON.stringify(this.needRecallDataArr[e].line.geometry.coordinates)),n>2){for(var w=1;w<n-1;w++)this.needRecallDataArr[e].line.geometry.coordinates.splice(w,1),w--,n--;if(this.needRecallDataArr[e].line.properties.hasOwnProperty("ofPsrArr"))for(var A=this.needRecallDataArr[e].line.properties.ofPsrArr,C=A.length,z=0;z<C;z++)if(0!==A[z].onLineIndex){this.needRecallDataArr[e].line.properties.ofPsrArr[z].onLineIndex=1;for(var k=this.tqDataFl[A[z].layerName][A[z].onTqFlIndex].properties.ofLineArr,j=k.length,$=0;$<j;$++)k[$].id==this.needRecallDataArr[e].line.properties.id&&0!==k[$].onLineIndex&&(this.tqDataFl[A[z].layerName][A[z].onTqFlIndex].properties.ofLineArr[$].onLineIndex=1)}this.layerGetSource(this.needRecallDataArr[e].line.properties.psrNo,this.tqDataFl[this.needRecallDataArr[e].line.properties.psrNo]),this.layerGetSource("light"+this.needRecallDataArr[e].line.properties.psrNo,this.lightData[this.needRecallDataArr[e].line.properties.psrNo])}else this.layerGetSource(this.needRecallDataArr[e].line.properties.psrNo,this.tqDataFl[this.needRecallDataArr[e].line.properties.psrNo]),this.layerGetSource("light"+this.needRecallDataArr[e].line.properties.psrNo,this.lightData[this.needRecallDataArr[e].line.properties.psrNo]);for(var R=0;R<s;R++){var B=a[R].properties.psrNo,G=a[R].properties.dataInTypeIndex,E=a[R].properties.psrObjFlType;"03"==this.type&&"bdz"==E||"qyfjd"!=E&&(this.isYxyh&&!this.tqDataFl[B][G].properties.hasOwnProperty("deviceType")||(this.addToLightData(this.tqDataFl[B][G],this.lightData),y?this.resetFlyPointHuan(this.tqDataFl[B][G],c,g,null,p,d):this.resetFlyPoint(this.tqDataFl[B][G],c,g),this.tqDataFl[B][G].properties.hasOwnProperty("isSamePole")&&this.resetTongGanTagZb(this.tqDataFl[B][G])))}this.lightDataToLoadLayer(),this.kxAllMove=!0,this.recallPositon={lng:"",lat:"",layerPros:{}}}},resetFlyPointHuan:function(t,e,i,r,a,s){var o=t.properties.psrNo,n=t.properties.dataInTypeIndex,l=[],h=JSON.parse(JSON.stringify(t.geometry.coordinates)),p="tqDataFl";if(r&&(p=r),console.log("latX:"+a),console.log("latY:"+s),"Point"==t.geometry.type)h[0]=a,h[1]=s,t.properties.hasOwnProperty("oldLineToDianIndex")&&this.changeOldLineOtherDian(t,this.oldLineToDian[o]);else{var d=!1,c=null;if("LineString"==t.geometry.type){if("tqDataFl"==p&&t.properties.hasOwnProperty("ofPsrArr")&&(-1!==JSON.stringify(t.properties.ofPsrArr).indexOf("bdz")||-1!==JSON.stringify(t.properties.ofPsrArr).indexOf("qyfjd")))for(var g=t.properties.ofPsrArr,y=g.length,f=0;f<y;f++){var u=g[f].layerName,m=g[f].onTqFlIndex;if("bdz"==this[p][u][m].properties.psrObjFlType||"qyfjd"==this[p][u][m].properties.psrObjFlType){d=!0,c=g[f].onLineIndex;break}}l=h}else"Polygon"==t.geometry.type&&(l=h[0],o==this.znsbOnStation.item&&n==this.znsbOnStation.index&&this.removeZnsbLayer());for(var D=l.length,b=0;b<D;b++)d&&c==b||(l[b][0]=a,l[b][1]=s)}console.log("处理后点坐标"+JSON.stringify(h)),"Point"==t.geometry.type?this[p][o][n].geometry.coordinates=h:"LineString"==t.geometry.type?this[p][o][n].geometry.coordinates=l:"Polygon"==t.geometry.type&&(this[p][o][n].geometry.coordinates[0]=l,this.layerGetSource(o+"-symbol",this[p][o]))},resetFlyPoint:function(t,e,i,r){var a=t.properties.psrNo,s=t.properties.dataInTypeIndex,o=[],n=JSON.parse(JSON.stringify(t.geometry.coordinates)),l="tqDataFl";if(r&&(l=r),"Point"==t.geometry.type)n[0]=n[0]+e,n[1]=n[1]+i,t.properties.hasOwnProperty("oldLineToDianIndex")&&this.changeOldLineOtherDian(t,this.oldLineToDian[a]);else{var h=!1,p=null;if("LineString"==t.geometry.type){if("tqDataFl"==l&&t.properties.hasOwnProperty("ofPsrArr")&&(-1!==JSON.stringify(t.properties.ofPsrArr).indexOf("bdz")||-1!==JSON.stringify(t.properties.ofPsrArr).indexOf("qyfjd")))for(var d=t.properties.ofPsrArr,c=d.length,g=0;g<c;g++){var y=d[g].layerName,f=d[g].onTqFlIndex;if("bdz"==this[l][y][f].properties.psrObjFlType||"qyfjd"==this[l][y][f].properties.psrObjFlType){h=!0,p=d[g].onLineIndex;break}}o=n}else"Polygon"==t.geometry.type&&(o=n[0],a==this.znsbOnStation.item&&s==this.znsbOnStation.index&&this.removeZnsbLayer());for(var u=o.length,m=0;m<u;m++)h&&p==m||(o[m][0]=o[m][0]+e,o[m][1]=o[m][1]+i)}"Point"==t.geometry.type?this[l][a][s].geometry.coordinates=n:"LineString"==t.geometry.type?this[l][a][s].geometry.coordinates=o:"Polygon"==t.geometry.type&&(this[l][a][s].geometry.coordinates[0]=o,this.layerGetSource(a+"-symbol",this[l][a]))},getTooLongLineFn:function(t,e){this.rightMenuVisible=!1;var i=[];i=e||this.getAllLineData(this.tqDataFl);for(var r=i.length,a=null,s=this.colorVal,o=0;o<r;o++){var n=i[o].properties.psrNo,l=i[o].properties.dataInTypeIndex;this.tqDataFl[n][l].properties.customLineColor==this.fxLineColorVal&&(this.tqDataFl[n][l].properties.customLineColor=s,this.layerGetSource(n,this.tqDataFl[n]));var h=this.gisName.GeometryUtil.distanceOfLine(i[o].geometry.coordinates);if(t){if("03"==this.type?a=this.checkConfigInfo.td.all:"02"!=this.type&&"01"!=this.type||(a="dianLine"==i[o].properties.psrObjFlType?this.checkConfigInfo.ds.dld:"xuLine"==i[o].properties.psrObjFlType?this.checkConfigInfo.ds.cljx:"daoLine"==i[o].properties.psrObjFlType?this.checkConfigInfo.ds.djd:this.checkConfigInfo.ds.ljx),h>a){var p={id:i[o].properties.id,prsId:"",name:i[o].properties.name,type:n,typeName:i[o].properties.psrName,onDataIndex:l,children:[]};if("#ccc"!==this.tqDataFl[n][l].properties.customLineColor&&(this.tqDataFl[n][l].properties.customLineColor=this.fxLineColorVal),this.layerGetSource(n,this.tqDataFl[n]),i[o].properties.hasOwnProperty("psrId"))p.prsId=i[o].properties.psrId;else if(i[o].properties.hasOwnProperty("ofPsrArr"))for(var d=i[o].properties.ofPsrArr,c=d.length,g=0;g<c;g++){var y=d[g].layerName,f=d[g].onTqFlIndex,u=this.tqDataFl[y][f],m={id:u.properties.id,prsId:"",name:u.properties.name,type:u.properties.psrNo,typeName:u.properties.psrName,onDataIndex:u.properties.dataInTypeIndex,isDisabled:!0};u.properties.hasOwnProperty("psrId")&&(m.prsId=u.properties.psrId),p.children.push(m)}this.addToRightFlyTable(p)}}else if("03"==this.type?a=this.lineForm.zdcd:"02"!=this.type&&"01"!=this.type||(a="dianLine"==i[o].properties.psrObjFlType?this.lineForm.zdcdOfdl:"xuLine"==i[o].properties.psrObjFlType?this.lineForm.zdcdOfcljx:"daoLine"==i[o].properties.psrObjFlType?this.lineForm.zdcdOfdjd:this.lineForm.zdcd),h>a&&1==i[o].properties.customOpacity){var D=!0;if(this.isYxyh&&(i[o].properties.hasOwnProperty("deviceType")||(D=!1)),D){this.addToLightData(i[o],this.lightData,!0);var b={line:i[o],group1:[],group2:[],needRecallGroup:""};this.needRecallDataArr.push(b)}}}},addToRightFlyTable:function(t){var e=this;0==this.flyingTableData.length?this.flyingTableData.push(t):this.dataProToCompareArr(t,this.flyingTableData,!1,(function(){e.flyingTableData.push(t)}))},scatterPsrFn:function(){this.toolsIndex=8;var t=[];for(var e in this.lightData)if(-1!==e.indexOf("Line")&&this.lightData[e].length>0)t=this.lightData[e];else if(-1==e.indexOf("Line")&&this.lightData[e].length>0){var i=this.lightData[e],r=i.length;if(this.isOverlapPsrFn(i)){console.log("重叠了------------");var a={};if(!(t.length>0))return;for(var s=t[0].geometry.coordinates,o=s.length,n=0;n<o;n++)if(s[n].toString()!==i[0].geometry.coordinates.toString()){a=this.map.project(s[n]);break}for(var l=this.getPoint(60*this.gisName.GeometryUtil.distanceOfLine(t[0].geometry.coordinates),a.x,a.y,r),h=0;h<r;h++){var p=l[h].lng-i[h].geometry.coordinates[0],d=l[h].lat-i[h].geometry.coordinates[1];i[h].geometry.coordinates[0]=l[h].lng,i[h].geometry.coordinates[1]=l[h].lat,this.resetLineData(i[h],i[h].geometry.coordinates,p,d)}this.layerGetSource(e,this.tqDataFl[e]),this.layerGetSource("light"+e,this.lightData[e])}}this.toolsIndex=0},autoLayoutFn:function(){this.toolsIndex=8;var t=this.getAllPointData(this.lightData);this.deleteArrNotSortValFn(t,!0);t=this.rankingThisArr(t,0);for(var e=t.length,i=0;i<e;i++)if(!t[i].properties.hasOwnProperty("psrPoledInf")||!t[i].properties.hasOwnProperty("parentPole")){var r=2e-5*i;if(t[i].geometry.coordinates[0]=t[i].geometry.coordinates[0]+2e-5*i,t[i].properties.hasOwnProperty("psrType")&&-1!==t[i].properties.psrType.indexOf("wlgt")&&t[i].properties.hasOwnProperty("psrPoledInf"))for(var a=t[i].properties.psrPoledInf,s=a.length,o=0;o<s;o++){var n=a[o].layerId,l=a[o].dataIndex;this.tqDataFl[n][l].geometry.coordinates[0]=this.tqDataFl[n][l].geometry.coordinates[0]+2e-5*i,this.layerGetSource("light"+n,this.tqDataFl[n]),this.queryPsrOfLineToLight(this.tqDataFl[n][l]),this.resetLineData(this.tqDataFl[n][l],this.tqDataFl[n][l].geometry.coordinates,r,0)}this.layerGetSource("light"+t[i].properties.psrNo,this.lightData[t[i].properties.psrNo]),this.resetLineData(t[i],t[i].geometry.coordinates,r,0)}this.setFbRecord(),this.toolsIndex=0},isOverlapPsrFn:function(t){for(var e=t.length,i=!1,r=1;r<e;r++)if(JSON.stringify(t[r].geometry.coordinates)==JSON.stringify(t[0].geometry.coordinates))return i=!0,i;return i},getPoint:function(t,e,i,r){for(var a=Math.PI/180*Math.round(360/r),s=[],o=0;o<r;o++){var n=e+t*Math.sin(a*o),l=i+t*Math.cos(a*o);this.point.unshift({x:n,y:l})}console.log("getPoint:----",JSON.stringify(this.point));for(var h=this.point.length,p=0;p<h;p++){var d=this.map.unproject([this.point[p].x,this.point[p].y]);s.push(d)}return console.log("lnglatArr:---",JSON.stringify(s)),s},addAILayer:function(t){!this.map.getLayer("AILayer")&&this.map.addLayer({id:"AILayer",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[]}},paint:{"circle-radius":6,"circle-color":"#f6f5c6","circle-blur":.1,"circle-stroke-width":2,"circle-stroke-color":"#e9e717"}}),this.map.getSource("AILayer").setData(t)},addAILayerControl:function(){var t=this,e=!1;if(this.tucengData.map((function(t){"AILayer"===t.id&&(e=!0)})),!e){this.tucengData.push({id:"AILayer",label:"AI采集图层",type:"AILayer",children:[]});var i=Object(s["a"])(this.defaultCheckedKeys);i.push("AILayer"),this.$nextTick((function(){t.defaultCheckedKeys=i}))}},ycsbDistinguish:function(t){var e=this;if(console.info("=========================ycsbDistinguish",t),this.ycsbToolsType=t,20==t){this.$nextTick((function(){e.$refs.YcsbDistinguish.getList()}));var r=this.map.getBounds(),a=r._sw.lng,o=r._ne.lat,n=r._ne.lng,l=r._sw.lat;this.bounds=[[a,l],[n,o]],Object(I["j"])([[a,l],[n,o]],this.lineType).then((function(t){e.addAILayer(t.data)}));var h=[],p=this.getGtArrData("tqDataFl");for(var d in h=p.wlgt.concat(p.yxgt),this.tqDataFl)"bdz"===d&&this.tqDataFl[d].map((function(t){var i=JSON.parse(JSON.stringify(t));i.geometry.coordinates=e.getPolygonCenterZb(i.geometry.coordinates),i.geometry.type="Point",h.push(i)}));console.log("请求参数",h),this.sgYxsbArr=h,this.addAILayerControl(),this.ycsbDistinguishVisible=!0}else if(21==t){this.ycsbDistinguishVisible=!0,this.sgYxsbArr=[];var c=Object(s["a"])(this.defaultCheckedKeys);c.push("yingxiao"),this.defaultCheckedKeys=c,this.isShowYxEquipment(!0);var g=new this.gisName.GeocodingTask;Object(I["y"])(JSON.stringify(this.tqDataFl["8369317be250"])).then((function(t){console.log("后端返回的地址为：",t.data.address),e.tqDataFl["8369317be250"]=t.data.jlxJeoJson,g.getLocation({address:t.data.address,region:"江苏省",isEncode:!1}).then((function(t){console.info("===============ycsbDistinguish",t),e.jlxRecallAddress=t,e.bounds=t.location;var r=[{type:"Feature",geometry:{type:"Point",coordinates:e.bounds},properties:{tagContent:"台区区域地址"}}];e.$set(e.psrIconSize,"yxsbLocationLayer",.25),e.setPointImgLayer("yxsbLocationLayer",r,i("d75e"),{size:e.iconSize,minZoom:e.layerMinZoom},null,(function(){if(void 0!=e.map.getSource("yxsbLocationLayer")){e.jlxOffsetPiont=e.bounds,e.targerCoor=[e.jlxOffsetPiont[0]+1e-4,e.jlxOffsetPiont[1]];var t=e.bounds;e.tqDataFl["8369317be250"].forEach((function(i){(Math.abs(t[0]-i.geometry.coordinates[0])>.0046009||Math.abs(t[1]-i.geometry.coordinates[1])>.0036884)&&e.sgYxsbArr.push(i)})),e.sgYxsbArrCopy=JSON.parse(JSON.stringify(e.sgYxsbArr)),e.jlxLocate(),setTimeout((function(){var i=e.map.project(new epgis.LngLat(t[0],t[1])),r=document.querySelector("#jlxLocationInfo");r.style.left=i.x+105+"px",r.style.top=i.y-221+"px",e.jlxLocationInfoVisible=!0}),1e3)}}))}))})).catch((function(){e.ycsbDistinguishVisible=!1,e.$message.error("基于量测七级地址，获取思极台区位置异常！")})),this.$nextTick((function(){e.$refs.YcsbDistinguish.getList()}))}0!==this.marginRightV&&(this.marginRightV=0,this.rtBoxRtVal=-400,this.reInitMap())},jlxLocate:function(){var t=this.getPullReferenceCentre(this.sgYxsbArr),e=[],i=[],r=this.jlxOffsetPiont;console.log("地图中心点",this.jlxOffsetPiont),t[0]>r[0]?(i[0]=t[0],e[0]=r[0]):(i[0]=r[0],e[0]=t[0]),t[1]>r[1]?(i[1]=t[1],e[1]=r[1]):(i[1]=r[1],e[1]=t[1]);var a=[e,i];console.log("zoomBound为",a),this.map.fitBounds(a,{padding:{top:150,bottom:150,left:250,right:600}})},jlxPullBack:function(t,e){var i=this,r="shiLine",a="8369317be250";if(this.isDragEditBx=!0,this.stepCancelData.stepTqData.push(JSON.parse(JSON.stringify(this.tqDataFl))),t&&!e){for(var s=this.tqDataFl[r].length,o=0;o<s;o++)-1!==this.tqDataFl[r][o].properties.connection.indexOf(t.properties.connection)&&(this.tqDataFl[r][o].geometry.coordinates[0].toString()==t.geometry.coordinates.toString()?this.tqDataFl[r][o].geometry.coordinates[0]=this.targerCoor:this.tqDataFl[r][o].geometry.coordinates[1]=this.targerCoor);this.layerGetSource(r,this.tqDataFl[r]);for(var n=this.tqDataFl[a].length,l=0;l<n;l++)this.tqDataFl[a][l].properties.psrId==t.properties.psrId&&(this.tqDataFl[a][l].geometry.coordinates=this.targerCoor);this.layerGetSource(a,this.tqDataFl[a]);var h=this.targerCoor[0]+2e-5;this.targerCoor=[h,this.targerCoor[1]]}else if(t||1!=e){if(!t&&2==e){this.jlxPullVisible=!0,this.modalTitle="台区召回",this.jlxLocate();var p=this.getPullReferenceCentre(this.tqDataFl["8369317be250"]);for(var d in console.log("台区分类为：",this.tqDataFl["shiLine"]),this.tqDataFl){var c=this.tqDataFl[d][0].geometry.type;if("Point"==c){for(var g=0;g<this.tqDataFl[d].length;g++){var y=this.tqDataFl[d][g].geometry.coordinates[0]-p[0],f=this.tqDataFl[d][g].geometry.coordinates[1]-p[1];this.tqDataFl[d][g].geometry.coordinates=[this.targerCoor[0]+y,this.targerCoor[1]+f]}this.layerGetSource(d,this.tqDataFl[d])}else if("LineString"==c){for(var u=0;u<this.tqDataFl[d].length;u++)for(var m=this.tqDataFl[d][u].geometry.coordinates.length,D=0;D<m;D++){var b=this.tqDataFl[d][u].geometry.coordinates[D][0]-p[0],x=this.tqDataFl[d][u].geometry.coordinates[D][1]-p[1];this.tqDataFl[d][u].geometry.coordinates[D]=[this.targerCoor[0]+b,this.targerCoor[1]+x]}this.layerGetSource(d,this.tqDataFl[d])}else if("Polygon"==c){for(var v=0;v<this.tqDataFl[d].length;v++)for(var L=this.tqDataFl[d][v].geometry.coordinates[0],I=0;I<L;I++){var P=this.tqDataFl[d][v].geometry.coordinates[0][I][0]-p[0],F=this.tqDataFl[d][v].geometry.coordinates[0][I][1]-p[1];this.tqDataFl[d][v].geometry.coordinates[0][I]=[this.targerCoor[0]+P,this.targerCoor[1]+F]}this.layerGetSource(d,this.tqDataFl[d])}}this.sgYxsbArr=[],this.$nextTick((function(){i.$refs.YcsbDistinguish.getList()}))}}else this.jlxPullVisible=!0,this.modalTitle="表箱召回",this.jlxLocate(),this.jlxRelativeOffset(this.sgYxsbArr)},jlxPull:function(){this.jlxPullVisible=!1},jlxRelativeOffset:function(t){var e=this,i=this.getPullReferenceCentre(t);t.forEach((function(t){for(var r=t.geometry.coordinates[0]-i[0],a=t.geometry.coordinates[1]-i[1],s=e.tqDataFl["shiLine"].length,o=0;o<s;o++)-1!==e.tqDataFl["shiLine"][o].properties.connection.indexOf(t.properties.connection)&&(e.tqDataFl["shiLine"][o].geometry.coordinates[0].toString()==t.geometry.coordinates.toString()?e.tqDataFl["shiLine"][o].geometry.coordinates[0]=[e.targerCoor[0]+r,e.targerCoor[1]+a]:e.tqDataFl["shiLine"][o].geometry.coordinates[1]=[e.targerCoor[0]+r,e.targerCoor[1]+a]);e.layerGetSource("shiLine",e.tqDataFl["shiLine"]);for(var n=e.tqDataFl["8369317be250"].length,l=0;l<n;l++)e.tqDataFl["8369317be250"][l].properties.psrId==t.properties.psrId&&(e.tqDataFl["8369317be250"][l].geometry.coordinates=[e.targerCoor[0]+r,e.targerCoor[1]+a]);e.layerGetSource("8369317be250",e.tqDataFl["8369317be250"])})),this.sgYxsbArr=[],console.log("点击表箱召回后的 this.sgYxsbArr",this.sgYxsbArr),this.$nextTick((function(){e.$refs.YcsbDistinguish.getList()}))},getPullReferenceCentre:function(t){for(var e=0,i=0,r=0;r<t.length;r++)e+=t[r].geometry.coordinates[0],i+=t[r].geometry.coordinates[1];var a=e/t.length,s=i/t.length,o=[a,s];return 0==this.centreCoord.length&&(this.centreCoord=JSON.parse(JSON.stringify(o))),console.log("获取到偏移点了",o),this.centreCoord},aiDistinguishLocation:function(t){var e={};for(var i in this.tqDataFl)this.tqDataFl[i].map((function(i){i.properties.psrId===t.properties.psrId&&(e=i)}));this.searchLocation(e)},ycsbDistinguishCancel:function(t){this.ycsbDistinguishVisible=!1,this.jlxLocationInfoVisible=!1,21==this.ycsbToolsType&&this.map.getLayer("yxsbLocationLayer")&&this.map.setLayoutProperty("yxsbLocationLayer","visibility","none"),400!==this.marginRightV&&(this.rightPanelShow(),this.reInitMap())},openJhxAutoRouting:function(){this.jhxAutoRoutingVisible=!0},openJhxRoutingCancel:function(){this.jhxAutoRoutingVisible=!1,this.jhxRoutingCancelVisible=!0},closeJhxRoutingCancel:function(){this.jhxRoutingCancelVisible=!1},jhxAutoRouting:function(t){var e=this;if(console.log("-----------this.tqDataFl[shiLine]",this.tqDataFl["shiLine"]),console.log("-----------this.lightData",this.lightData),this.tqDataFl["8369317be250"]||this.$message.warning("该存量图纸无低压营销设备，无法进行入户线布局操作!"),-1==this.defaultCheckedKeys.indexOf("yingxiao")){var i=Object(s["a"])(this.defaultCheckedKeys);i.push("yingxiao"),this.defaultCheckedKeys=i,this.isShowYxEquipment(!0)}var r,a=[];if(1==t){if(this.jhxAutoRoutingVisible=!1,0==this.awalkingRoutesLayerArray.length)(r=a).push.apply(r,Object(s["a"])(JSON.parse(JSON.stringify(this.tqDataFl["shiLine"]))));else if(0!=this.awalkingRoutesLayerArray.length)return}else if(2==t)this.rightMenuType="",a=[],a.push(JSON.parse(JSON.stringify(this.tqDataFl["shiLine"][this.lightData["shiLine"][0].properties.dataInTypeIndex]))),console.log("-----------jhxAutoRouting(2)",JSON.parse(JSON.stringify(a)));else if(0==t)this.isDragEditBx=!0,this.stepCancelData.stepTqData.push(JSON.parse(JSON.stringify(this.tqDataFl["shiLine"]))),console.log("this.stepCancelData",this.stepCancelData),this.jhxAutoRoutingCancel(),this.tqDataFl["shiLine"]=JSON.parse(JSON.stringify(this.jhxAutoRoutingArr)),this.removeLightLayer(),this.layerGetSource("shiLine",this.tqDataFl["shiLine"]),this.dealJHXOfPsrArr();else if(3==t){void 0!==this.map.getLayer("walkingRoutesLayer")&&this.jhxAutoRoutingCancel();for(var o=this.tqDataFl["shiLine"],n=0;n<o.length;n++){var l=o[n];if(l.properties.hasOwnProperty("deviceType")&&"yxsb"==l.properties.deviceType){var h=l.geometry.coordinates,p=h.length,d=[];d.push(h[0]),d.push(h[p-1]),l.geometry.coordinates=d}}this.dealJHXOfPsrArr(),this.layerGetSource("shiLine",this.tqDataFl["shiLine"]),this.jhxRoutingCancelVisible=!1}else if(4==t){var c=[],g=this.rightClickData.geometry.coordinates.length;if(c.push(this.rightClickData.geometry.coordinates[0]),c.push(this.rightClickData.geometry.coordinates[g-1]),this.tqDataFl["shiLine"][this.rightClickData.properties.dataInTypeIndex].geometry.coordinates=c,this.layerGetSource("shiLine",this.tqDataFl["shiLine"]),this.layerGetSource("lightshiLine",this.lightData["shiLine"]),this.dealJHXOfPsrArr(),0!==this.awalkingRoutesLayerArray.length)for(var y=0;y<this.awalkingRoutesLayerArray.length;y++){var f=this.awalkingRoutesLayerArray[y];f.properties.id==this.rightClickData.properties.id&&(this.awalkingRoutesLayerArray.splice(y,1),0!==this.awalkingRoutesLayerArray.length?this.map.getSource("walkingRoutesLayer").setData({type:"FeatureCollection",features:this.awalkingRoutesLayerArray}):0==this.awalkingRoutesLayerArray.length&&this.jhxAutoRoutingCancel())}this.rightMenuType=""}if(0!==t&&3!==t&&4!==t){void 0==this.map.getLayer("walkingRoutesLayer")&&this.map.addLayer({id:"walkingRoutesLayer",type:"line",source:{type:"geojson",data:{type:"FeatureCollection",features:this.awalkingRoutesLayerArray}},paint:{"line-color":"#606266","line-width":2,"line-dasharray":[3,2]}});var u=new this.gisName.DirectionsTask;this.getWalkingRoutes(a,u,(function(i){e.removeLightLayer(),1==t?(e.jhxAutoRoutingArr=i,e.awalkingRoutesLayerArray=[]):2==t&&(console.log("-------------result",i),0==e.jhxAutoRoutingArrCopy.length?e.jhxAutoRoutingArr=JSON.parse(JSON.stringify(e.tqDataFl["shiLine"])):e.jhxAutoRoutingArr=JSON.parse(JSON.stringify(e.jhxAutoRoutingArrCopy)),e.jhxAutoRoutingArr[i[0].properties.dataInTypeIndex].geometry.coordinates=i[0].geometry.coordinates,e.jhxAutoRoutingArrCopy=JSON.parse(JSON.stringify(e.jhxAutoRoutingArr))),e.dealEditJHX(i)}))}},dealEditJHX:function(t){var e=this;t.forEach((function(t){t.properties.hasOwnProperty("deviceType")&&"yxsb"==t.properties.deviceType&&e.awalkingRoutesLayerArray.push(t)})),this.map.getSource("walkingRoutesLayer").setData({type:"FeatureCollection",features:this.awalkingRoutesLayerArray}),this.jhxAutoRoutingVisible=!0},dealJHXOfPsrArr:function(){if(0!=this.tqDataFl["shiLine"].length)for(var t=this.tqDataFl["shiLine"].length,e=0;e<t;e++){var i=this.tqDataFl["shiLine"][e];if(i.properties.hasOwnProperty("deviceType")&&"yxsb"==i.properties.deviceType)for(var r=i.properties.ofPsrArr,a=r.length,s=i.geometry.coordinates.length,o=0;o<a;o++)if(r[o].onLineIndex>0){i.properties.ofPsrArr[o].onLineIndex=s-1;for(var n=this.tqDataFl[r[o].layerName][r[o].onTqFlIndex].properties.ofLineArr,l=n.length,h=0;h<l;h++)if(n[h].id==i.properties.id&&n[h].onLineIndex>0){this.tqDataFl[r[o].layerName][r[o].onTqFlIndex].properties.ofLineArr[h].onLineIndex=i.properties.ofPsrArr[o].onLineIndex;break}}}},getWalkingRoutes:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(e,i,r){var a,n,l,h,p,d,c;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.jhxAutoRoutingTipsShow=!0,0==e.length){t.next=33;break}n=e.length,l=0;case 4:if(!(l<n)){t.next=32;break}if(h=e[l],!h.properties.hasOwnProperty("deviceType")||"yxsb"!=h.properties.deviceType){t.next=29;break}return t.prev=7,t.next=10,i.searchByWalking({startPoint:h.geometry.coordinates[0],endPoint:h.geometry.coordinates[h.geometry.coordinates.length-1],isEncode:!1});case 10:a=t.sent,t.next=18;break;case 13:return t.prev=13,t.t0=t["catch"](7),this.jhxAutoRoutingVisible=!1,this.$message.error("获取思极步行导航,道路分布数据异常！"),t.abrupt("break",32);case 18:if(console.log("-------------searchByWalking.result",a),2!=a.routes[0].feature.features[0].geometry.coordinates.length){t.next=24;break}if(p=a.routes[0].feature.features[0].geometry.coordinates[0],d=a.routes[0].feature.features[0].geometry.coordinates[1],p!==d){t.next=24;break}return t.abrupt("continue",29);case 24:c=[],c.push(h.geometry.coordinates[0]),c.push.apply(c,Object(s["a"])(a.routes[0].feature.features[0].geometry.coordinates)),c.push(h.geometry.coordinates[h.geometry.coordinates.length-1]),e[l].geometry.coordinates=c;case 29:l++,t.next=4;break;case 32:a&&(console.log("----------getWalkingRoutes.arr",e),r(e));case 33:this.jhxAutoRoutingTipsShow=!1;case 34:case"end":return t.stop()}}),t,this,[[7,13]])})));function e(e,i,r){return t.apply(this,arguments)}return e}(),jhxAutoRoutingCancel:function(){this.jhxAutoRoutingVisible=!1,this.map.removeLayer("walkingRoutesLayer"),this.map.removeSource("walkingRoutesLayer"),this.awalkingRoutesLayerArray=[]},toOpenSetLineSizeDialog:function(){console.info("this.type",this.type),this.updateAndRemoveLightLayer(),this.needRecallDataArr=[],this.toolsIndex=9,this.dialogSetLineSizeVisible=!0,"03"==this.type&&(this.lineForm.zdcd=this.checkConfigInfo.td.all,this.lineForm.zdcdOfdl=0,this.lineForm.zdcdOfcljx=0,this.lineForm.zdcdOfdjd=0,this.gyRecallVal=""),"01"==this.type&&(this.lineForm.zdcd=this.checkConfigInfo.ds.ljx,this.lineForm.zdcdOfdl=this.checkConfigInfo.ds.dld,this.lineForm.zdcdOfcljx=this.checkConfigInfo.ds.cljx,this.lineForm.zdcdOfdjd=this.checkConfigInfo.ds.djd),"02"==this.type&&this.getFdfxSetting(),this.recallPositon={lng:"",lat:"",layerPros:{}}},queryFdFx:function(){var t=this;console.log("检测飞点飞线--------------",JSON.stringify(this.flyingTableData));var e=this.flyingTableData.length,i=!1;if("03"==this.type?this.lineForm.zdcd!=this.checkConfigInfo.td.all&&(i=!0):(this.lineForm.zdcd!=this.checkConfigInfo.ds.ljx&&(i=!0),this.lineForm.zdcdOfdl!=this.checkConfigInfo.ds.dld&&(i=!0),this.lineForm.zdcdOfcljx!=this.checkConfigInfo.ds.cljx&&(i=!0),this.lineForm.zdcdOfdjd!=this.checkConfigInfo.ds.djd&&(i=!0)),this.isNeedRetestLongLine&&(i=this.isNeedRetestLongLine),i)this.getTooLongLineFn();else if(e>0){var r=this.getNeddCallFxData();this.getTooLongLineFn(!1,r)}if(0==this.needRecallDataArr.length)this.$message.warning("没有可召回的飞点飞线");else{this.lineForm.syPsrId="";var a=this.needRecallDataArr.length;this.$confirm("检测到"+a+"条飞线，确认召回？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){t.mapLoading=!0,setTimeout((function(){t.confirmRecallFdfx()}),200)})).catch((function(){t.toolsIndex=0,t.removeLightLayer()}))}},getNeddCallFxData:function(){var t=[],e=this.flyingTableData,i=e.length;if(i>0)for(var r=0;r<i;r++){var a=e[r].type,s=e[r].onDataIndex;1==this.tqDataFl[a][s].properties.customOpacity&&(this.isYxyh?this.tqDataFl[a][s].properties.hasOwnProperty("deviceType")&&t.push(this.tqDataFl[a][s]):t.push(this.tqDataFl[a][s]))}return t},confirmRecallFdfx:function(){for(var t=this,e=this.needRecallDataArr.length,i=function(e){setTimeout((function(){t.findNextPsrByLine(t.needRecallDataArr[e].line,"",e,"")}),20)},r=0;r<e;r++)i(r);setTimeout((function(){t.judgeLoopEndFn()}),20)},dialogToQueryLines:function(){var t=this;if(this.lineForm.isRound=this.selectedValue.value,console.log(this.lineForm.isRound),""!==this.lineForm.zdcd&&this.lineForm.zdcd>0){if(this.longLineSize=this.lineForm.zdcd,this.dialogSetLineSizeVisible=!1,"03"==this.type){if(""==this.lineForm.syPsrId)return void this.$message.warning("请先选择做为上游的设备")}else if(("01"==this.type||"02"==this.type)&&this.lineForm.zdcdOfdl<=0)return void this.$message.warning("请正确填写电缆段召回距离！");setTimeout((function(){t.queryFdFx()}),200)}else this.$message.warning("线段长度输入不正确，请重新输入")},dialogCancelFdfxzh:function(){this.dialogSetLineSizeVisible=!1,this.toolsIndex=0,this.lineForm.syPsrId="",this.removeLightLayer()},toChooseGysyd:function(){this.dialogSetLineSizeVisible=!1,this.isChooseSy=!0},compareDataToGetChangeData:function(){for(var t in this.beChangeData=[],this.originalTqData)if("bdzdyd"!=t)for(var e=this.originalTqData[t],i=e.length,r=0;r<i;r++){var a=e[r].properties.dataInTypeIndex,s=JSON.stringify(e[r].geometry.coordinates),o=JSON.stringify(this.tqDataFl[t][a].geometry.coordinates);if(s!==o){if(e[r].properties.hasOwnProperty("oldLineToDianIndex")&&this.onePointToLineChange(this.tqDataFl[t][a],t),this.tqDataFl[t][a].properties.hasOwnProperty("parentPole")&&(this.tqDataFl[t][a].properties.id=this.tqDataFl[t][a].properties.id.replace("_yxgt","")),"LineString"==this.tqDataFl[t][a].geometry.type&&this.tqDataFl[t][a].properties.hasOwnProperty("oldOnBdzPoint")){var n=e[r].properties.oldOnBdzPoint,l=n.onLineIndex,h=(JSON.parse(JSON.stringify(n.zb)),this.tqDataFl[t][a].geometry.coordinates.length);0!==l&&l!==h-1&&(l=h-1)}this.beChangeData.push(this.tqDataFl[t][a])}}},otherTqChangeFn:function(){0==this.topMenuIndexVal?this.topMenuIndexVal=3:this.topMenuIndexVal=0},handleOtherTqCheckChange:function(t,e){console.log("其他台区勾选-图层：",JSON.stringify(t),e);var i=e.checkedKeys,r=i.length,a=!1;if(r>0){for(var s=0;s<r;s++)if(t.id==i[s]){console.log("选中----------"),a=!0;var o=this.chooseOtherTqData(t.id);console.log(t.id),this.setLayerData(o,!0);break}a||(console.log("取消----------"),this.removeSomeOtherLayer(t.id))}else this.removeAllOtherLayer()},removeSomeOtherLayer:function(t){for(var e in this.otherTqGeoFl){var i=this.otherTqGeoFl[e],r=i.length;if(r>0)for(var a=0;a<r;a++)t!=i[a].properties.taiquNo||(i.splice(a,1),a--,r--);this.layerGetSource(e,i)}},removeAllOtherLayer:function(){if(0!==Object.keys(this.otherTqGeoFl).length)for(var t in this.otherTqGeoFl)void 0!==this.map.getLayer(t)&&(this.map.removeLayer(t),this.map.removeSource(t),this.map.hasImage(t.replace("other","")+"Img")&&this.map.removeImage(t.replace("other","")+"Img"),delete this.otherTqGeoFl[t])},chooseOtherTqData:function(t){for(var e={},i=this.otherTqGeoData.length,r=0;r<i;r++)if(t==this.otherTqGeoData[r].id){e=this.otherTqGeoData[r];break}return e},toLoadOtherTqGeo:function(){this.otherTqGeoData=[];for(var t=this.otherTqTreeData.length,e=0;e<t;e++){for(var r=i("76a6")("./"+this.otherTqTreeData[e].id+".json"),a=r.features,s=a.length,o=0;o<s;o++)if(30200002==a[o].properties.objType){this.otherTqTreeData[e].label=a[o].properties.name;break}this.otherTqGeoData.push(r)}},thisPsrLocation:function(t){console.log("thisPsrLocation:---",JSON.stringify(t)),this.map.setCenter(t.sbzb),this.removeLightLayer(),this.addToLightData(this.tqDataFl[t.onDataItem][t.onDataIndex],this.lightData,!0)},showStationPsrFn:function(){this.rightMenuVisible=!1;var t=this.rightClickData.properties.psrNo,e=this.rightClickData.properties.dataInTypeIndex;if(t!=this.znsbOnStation.item||e!=this.znsbOnStation.index){if(this.removeZnsbLayer(),this.znsbOnStation.item=t,this.znsbOnStation.index=e,"bdzdyd"==t){var i=this.tqDataFl[t][e].properties.relateMian;return t=i.layerId,void(e=i.onItemIndex)}this.getAllPsrInStation(this.rightClickData.properties.id,this.rightClickData.properties.objType,this.rightClickData.properties.negType)}else this.removeZnsbLayer()},removeZnsbLayer:function(){""!==this.znsbOnStation.item&&(this.removeCustomLayer(this.otherTqGeoFl),this.otherTqGeoFl={},this.znsbOnStation.item="",this.znsbOnStation.index=0)},getAllPsrInStation:function(t,e,i){var r=this;this.mapLoading=!0,Object(I["H"])(t,e,i).then((function(t){r.mapLoading=!1;var e=JSON.parse(t.data);"string"==typeof e&&(e=JSON.parse(e)),r.setLayerData(e,!0,"map"),r.rightClickData={}})).catch((function(t){r.mapLoading=!1,r.rightClickData={}}))},editThisPsr:function(){""!=this.rightBxInf.zcbh&&("bdz"!=this.rightBxInf.layerId&&"bdzdyd"!=this.rightBxInf.layerId&&"qyfjd"!=this.rightBxInf.layerId?"02"!=this.type||"xsb"!=this.rightBxInf.layerId&&"pds"!=this.rightBxInf.layerId&&"byq"!=this.rightBxInf.layerId?!this.isYxyh||this.tqDataFl[this.rightBxInf.layerId][this.rightBxInf.onItemIndex].properties.hasOwnProperty("deviceType")?(this.rtBoxCanEdit=!0,this.rightBxInf.zbType="2",this.changeThisZbType("2")):this.$message.warning("该设备不允许坐标编辑！"):this.$message.warning("低压台区所属电源点,不支持坐标编辑！"):this.$message.warning("变电站不支持坐标编辑！"))},updateThisPsr:function(){var t=this;if(this.rtBoxCanEdit=!1,""!=this.rightBxInf.zcbh)if("2"==this.rightBxInf.zbType&&""!==this.rightBxInf.ddzb){var e=this.rightBxInf.ddzb.replace(/\s*/g,"");e=e.replace(/，/gi,","),console.log(this.rightBxInf.ddzb,e);var i=new this.gisName.ConvertTask;i.convertCoord([[e]],{from:1}).then((function(e){t.rightBxInf.wz=e[0].toString(),t.toChangePsrCoorVal(e[0],t.rightBxInf)}))}else if("1"==this.rightBxInf.zbType){var r=this.rightBxInf.wz.split(",");r[0]=Number(r[0]),r[1]=Number(r[1]),this.toChangePsrCoorVal(r,this.rightBxInf)}},toChangePsrCoorVal:function(t,e){var i=this,r=e.layerId,a=e.onItemIndex,s=e.layerType,o=null,n=null;if("Polygon"==s){var l=this.getPolygonCenterZb(this.tqDataFl[r][a].geometry.coordinates);o=t[0]-l[0],n=t[1]-l[1];for(var h=this.tqDataFl[r][a].geometry.coordinates[0].length,p=0;p<h;p++)this.tqDataFl[r][a].geometry.coordinates[0][p][0]=this.tqDataFl[r][a].geometry.coordinates[0][p][0]+o,this.tqDataFl[r][a].geometry.coordinates[0][p][1]=this.tqDataFl[r][a].geometry.coordinates[0][p][1]+n}else if("Point"==s)o=t[0]-this.tqDataFl[r][a].geometry.coordinates[0],n=t[1]-this.tqDataFl[r][a].geometry.coordinates[1],this.tqDataFl[r][a].geometry.coordinates=t,this.tqDataFl[r][a].properties.hasOwnProperty("oldLineToDianIndex")&&this.changeOldLineOtherDian(this.tqDataFl[r][a],this.oldLineToDian[r]);else if("LineString"==s){var d=this.tqDataFl[r][a].properties.ofPsrArr,c=d[0].onLineIndex,g=(d[1].onLineIndex,[]),y=[];0==c?(g=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].geometry.coordinates,y=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].geometry.coordinates):0!=c&&(y=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].geometry.coordinates,g=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].geometry.coordinates);var f=Math.abs(g[0]-t[0][0]),u=Math.abs(g[1]-t[0][1]),m=Math.abs(y[0]-t[t.length-1][0]),D=Math.abs(y[1]-t[t.length-1][1]);f>5e-6||u>5e-6?m>5e-6||D>5e-6?(t.splice(0,0,g),t.push(y)):m<5e-7&&m<5e-7&&(t.splice(0,0,g),t.pop(),t.push(y)):f<5e-7&&u<5e-7&&(m>5e-6||D>5e-6?(t.splice(0,1,g),t.push(y)):m<5e-7&&m<5e-7&&(t.splice(0,1,g),t.pop(),t.push(y))),this.tqDataFl[r][a].geometry.coordinates=t;for(var b=this.tqDataFl[r][a],x=b.properties.ofPsrArr,v=x.length,L=b.geometry.coordinates.length,I=0;I<v;I++)if(x[I].onLineIndex>0){b.properties.ofPsrArr[I].onLineIndex=L-1;for(var P=this.tqDataFl[x[I].layerName][x[I].onTqFlIndex].properties.ofLineArr,F=P.length,T=0;T<F;T++)if(P[T].id==b.properties.id&&P[T].onLineIndex>0){this.tqDataFl[x[I].layerName][x[I].onTqFlIndex].properties.ofLineArr[T].onLineIndex=b.properties.ofPsrArr[I].onLineIndex;break}}for(var q=0;q<this.plEditArr.length;q++){var O=this.plEditArr[q].id,S=this.tqDataFl[r][a].properties.id;O==S&&(this.plEditArr[q].sjzb=t,console.log("this.plEditArr[i].sjzb",this.plEditArr[q].sjzb))}this.$nextTick((function(){i.$refs.BatchEditPage.getList()}))}if(this.layerGetSource("light"+r,this.lightData[r]),this.layerGetSource(r,this.tqDataFl[r]),"Polygon"==s?(console.log("变更面上的线------------"),this.resetLineData(this.tqDataFl[r][a],"",o,n),this.layerGetSource(r+"-symbol",this.tqDataFl[r])):"Point"==s&&this.resetLineData(this.tqDataFl[r][a],t,o,n),this.tqDataFl[r][a].properties.hasOwnProperty("psrPoledInf"))for(var N=this.tqDataFl[r][a].properties.psrPoledInf,w=N.length,A=0;A<w;A++){var C=N[A].layerId,z=N[A].dataIndex;this.tqDataFl[C][z].geometry.coordinates=t,this.layerGetSource("light"+C,this.lightData[C]),this.addToLightData(this.tqDataFl[C][z],this.lightData,!0),this.resetLineData(this.tqDataFl[C][z],t,o,n)}this.setFbRecord()},toChangeDLDCoorVal:function(t,e){var i=e.layerId,r=e.onItemIndex,a=this.tqDataFl[i][r].properties.ofPsrArr,s=a[0].onLineIndex,o=(a[1].onLineIndex,[]),n=[];0==s?(o=this.tqDataFl[a[0].layerName][a[0].onTqFlIndex].geometry.coordinates,n=this.tqDataFl[a[1].layerName][a[1].onTqFlIndex].geometry.coordinates):0!=s&&(n=this.tqDataFl[a[0].layerName][a[0].onTqFlIndex].geometry.coordinates,o=this.tqDataFl[a[1].layerName][a[1].onTqFlIndex].geometry.coordinates);var l=Math.abs(o[0]-t[0][0]),h=Math.abs(o[1]-t[0][1]),p=Math.abs(n[0]-t[t.length-1][0]),d=Math.abs(n[1]-t[t.length-1][1]);l>5e-6||h>5e-6?p>5e-6||d>5e-6?(t.splice(0,0,o),t.push(n)):p<5e-7&&p<5e-7&&(t.splice(0,0,o),t.pop(),t.push(n)):l<5e-7&&h<5e-7&&(p>5e-6||d>5e-6?(t.splice(0,1,o),t.push(n)):p<5e-7&&p<5e-7&&(t.splice(0,1,o),t.pop(),t.push(n))),this.tqDataFl[i][r].geometry.coordinates=t;for(var c=this.tqDataFl[i][r],g=c.properties.ofPsrArr,y=g.length,f=c.geometry.coordinates.length,u=0;u<y;u++)if(g[u].onLineIndex>0){c.properties.ofPsrArr[u].onLineIndex=f-1;for(var m=this.tqDataFl[g[u].layerName][g[u].onTqFlIndex].properties.ofLineArr,D=m.length,b=0;b<D;b++)if(m[b].id==c.properties.id&&m[b].onLineIndex>0){this.tqDataFl[g[u].layerName][g[u].onTqFlIndex].properties.ofLineArr[b].onLineIndex=c.properties.ofPsrArr[u].onLineIndex;break}}this.layerGetSource("light"+i,this.lightData[i]),this.layerGetSource(i,this.tqDataFl[i]),this.setFbRecord()},getPolygonCenterZb:function(t){var e=(t[0][1][0]-t[0][0][0])/2+t[0][0][0],i=(t[0][1][1]-t[0][2][1])/2+t[0][2][1];return[e,i]},changeThisZbType:function(t){if(this.rightBxInf.ddzb="","2"==t&&""!==this.rightBxInf.wz){var e=this.rightBxInf.layerId,i=this.rightBxInf.onItemIndex,r=JSON.parse(JSON.stringify(this.tqDataFl[e][i].geometry.coordinates));if("Point"==this.tqDataFl[e][i].geometry.type)this.toGetDdTwoThousandZb([r]);else if("LineString"==this.tqDataFl[e][i].geometry.type)this.toGetDdTwoThousandZb(r);else{var a=this.getPolygonCenterZb(r);this.toGetDdTwoThousandZb([a])}}},toGetDdTwoThousandZb:function(t){var e=this;Object(I["p"])(t).then((function(t){e.rightBxInf.ddzb=t.data.toString()})).catch((function(t){}))},toDdTwoThousandZb:function(){var t=Object(n["a"])(Object(o["a"])().mark((function t(e){var i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(I["p"])({coorVal:e});case 2:return i=t.sent,t.abrupt("return",i.data);case 4:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),setFbRecord:function(){var t=this.stepCancelData.lightTqData.length;JSON.stringify(this.stepCancelData.lightTqData[t-1])!==JSON.stringify(this.lightData)&&(this.stepCancelData.lightTqData.push(JSON.parse(JSON.stringify(this.lightData))),this.stepCancelData.stepTqData.push(JSON.parse(JSON.stringify(this.tqDataFl))),this.isNeedRetestLongLine=!0)},lineToStraighten:function(){this.toolsIndex=12,this.resetOfLazhiData(),"{}"!==JSON.stringify(this.lightData)&&this.updateAndRemoveLightLayer(),this.dialogLazhiLineVisible=!0},inflectionPointImport:function(){this.toolsIndex=15,this.resetOfDjxData(),this.inflectionPointImportVisible=!0,this.toolsIndex=0,0!==this.djxEditArr.length?this.isDrBtnDisabled=!1:this.isDrBtnDisabled=!0;for(var t=this.tqDataFl["dianLine"],e=0;e<t.length;e++)this.addToDjxEditData(t[e],1)},toChooseLazhiPsr:function(t){console.log("选择点：---",t),this.choosedLzPsrType=t,this.dialogLazhiLineVisible=!1},toChooseinflectionPointPsr:function(t){this.choosedDjxPsrType=t,this.inflectionPointImportVisible=!1,0!==this.djxEditArr.length?this.isDrBtnDisabled=fasle:this.isDrBtnDisabled=!0},dialogToLazhiLines:function(){""!==this.lazhiForm.startPsrId&&""!==this.lazhiForm.endPsrId?this.lazhiForm.startPsrId==this.lazhiForm.endPsrId?this.$message.warning("起点终点不能一样，请重新选择！"):(this.choosedLzPsrType="",this.dialogLazhiLineVisible=!1,this.toolsIndex=0,this.findLazhiNextPsr(this.lazhiForm.startPsrItem,this.lazhiForm.startPsrIndex,"",""),this.judgeLazhiLoopEnd()):this.$message.warning("请选择起始点！")},dialogCancelLazhiLine:function(){this.dialogLazhiLineVisible=!1,this.resetOfLazhiData(),this.toolsIndex=0},inflectionPointCancelExport:function(){this.inflectionPointImportVisible=!1,this.resetOfDjxData(),this.toolsIndex=0},resetOfLazhiData:function(){this.lazhiForm={startPsrId:"",startPsrItem:"",startPsrIndex:"",endPsrId:"",endPsrItem:"",endPsrIndex:""},this.needLazhiData={},this.needLazhiGroup="",this.hasStartAndEndDataArr=[],this.choosedLzPsrType=""},resetOfDjxData:function(){var t=this;this.inflectionPointForm={inflectionPointId:"",inflectionPointItem:"",inflectionPointIndex:""},this.djxEditArr=[],this.djxEditArrAll=[],this.choosedDjxPsrType="",this.$nextTick((function(){t.$refs.SpanLineExport.getList()}))},findLazhiNextPsr:function(t,e,i,r){if(!(this.hasStartAndEndDataArr.length>0)){var a=!1;if(this.isQueryEndPsrLoop=!1,this.tqDataFl[t][e].properties.hasOwnProperty("ofLineArr"))for(var s=this.tqDataFl[t][e].properties.ofLineArr,o=s.length,n=0,l=0;l<o;l++){var h=[];if(""==i){this.$set(this.needLazhiData,"group"+l,[]);var p={pointItem:t,pointIndex:e,prePointId:""};this.needLazhiData["group"+l].push(p),this.needLazhiData.hasOwnProperty("groupMaxIndex")||this.$set(this.needLazhiData,"groupMaxIndex",0),this.needLazhiData["groupMaxIndex"]=o-1}else o>2&&(h=JSON.parse(JSON.stringify(this.needLazhiData[i])));var d=s[l].layerName,c=s[l].onTqFlIndex;if(this.tqDataFl[d][c].properties.hasOwnProperty("ofPsrArr")&&r!==this.tqDataFl[d][c].properties.id){var g=0;n++,n>1&&""!==i&&(this.needLazhiData["groupMaxIndex"]++,console.log("groupMaxIndex-----------------:",this.needLazhiData["groupMaxIndex"]),g=this.needLazhiData["groupMaxIndex"],this.$set(this.needLazhiData,"group"+g,h),i="group"+g);for(var y=this.tqDataFl[d][c].properties.ofPsrArr,f=y.length,u=0;u<f;u++){var m=y[u].layerName,D=y[u].onTqFlIndex,b=this.tqDataFl[m][D].properties.customOpacity,x=this.tqDataFl[m][D].properties.customLightOpacity;if(b+x!=0&&(m!==t||m==t&&D!==e)){var v={pointItem:m,pointIndex:D,prePointId:this.tqDataFl[t][e].properties.id};if(""==i)this.needLazhiData["group"+l].push(v),this.tqDataFl[m][D].properties.id==this.lazhiForm.endPsrId&&D==this.lazhiForm.endPsrIndex?(a=!1,this.isQueryEndPsrLoop=!0,this.hasStartAndEndDataArr=this.needLazhiData["group"+l],this.needLazhiGroup="group"+l,this.toLazhiStartToEndPsr()):(this.findLazhiNextPsr(m,D,"group"+l,this.tqDataFl[d][c].properties.id),a=!0);else{if("Polygon"==this.tqDataFl[m][D].geometry.type){this.needLazhiData.hasOwnProperty("hasPolygonGroup")||this.$set(this.needLazhiData,"hasPolygonGroup","");var L=this.needLazhiData["hasPolygonGroup"];""==L?this.needLazhiData["hasPolygonGroup"]=i:-1==L.indexOf(i)&&(this.needLazhiData["hasPolygonGroup"]=L+","+i),console.log("含有面的值-------------------------------：",this.tqDataFl[m][D].properties.id,this.needLazhiData["hasPolygonGroup"])}this.needLazhiData[i].push(v),this.tqDataFl[m][D].properties.id==this.lazhiForm.endPsrId&&D==this.lazhiForm.endPsrIndex?(a=!1,this.isQueryEndPsrLoop=!0,this.hasStartAndEndDataArr=this.needLazhiData[i],this.needLazhiGroup=i,this.toLazhiStartToEndPsr()):(this.findLazhiNextPsr(m,D,i,this.tqDataFl[d][c].properties.id),a=!0)}}}}}a||(this.isQueryEndPsrLoop=!0)}},judgeLazhiLoopEnd:function(){var t=this;setTimeout((function(){if(t.isQueryEndPsrLoop){var e=t.hasStartAndEndDataArr.length;0==e&&(t.$message.warning("未找到终点，线路中可能存在断联，无法拉直线路！"),t.toolsIndex=0,t.removeLightTcByMsgHide())}else console.log("judgeLazhiLoopEnd-isQueryEndPsrLoop-false"),t.judgeLazhiLoopEnd()}),100)},toLazhiStartToEndPsr:function(){if(this.needLazhiData.hasOwnProperty("hasPolygonGroup")&&this.needLazhiData.hasPolygonGroup.split(",").includes(this.needLazhiGroup))return console.log("线路中含有面，无法拉直:",this.needLazhiGroup),this.toolsIndex=0,void this.$message.warning("拉直的线路中含有站房，无法拉直！");var t=this.hasStartAndEndDataArr,e=t.length;if(2!=e){for(var i=this.tqDataFl[this.lazhiForm.startPsrItem][this.lazhiForm.startPsrIndex].geometry.coordinates,r=this.tqDataFl[this.lazhiForm.endPsrItem][this.lazhiForm.endPsrIndex].geometry.coordinates,a=(r[0]-i[0])/(e-1),s=(r[1]-i[1])/(e-1),o=0;o<e-1;o++){var n=t[o].pointItem,l=t[o].pointIndex;if(0==o){if(this.addToLightData(this.tqDataFl[n][l],this.lightData),this.tqDataFl[n][l].properties.hasOwnProperty("parentPole")&&this.tqDataFl[n][l].properties.hasOwnProperty("psrPoledInf")){var h=this.tqDataFl[n][l].properties.psrPoledInf[0].layerId,p=this.tqDataFl[n][l].properties.psrPoledInf[0].dataIndex;this.addToLightData(this.tqDataFl[h][p],this.lightData);var d=this.tqDataFl[h][p].properties.psrPoledInf,c=d.length;if(c>1)for(var g=0;g<c;g++){var y=d[g].layerId,f=d[g].dataIndex;this.addToLightData(this.tqDataFl[y][f],this.lightData)}}}else{var u=this.tqDataFl[n][l].geometry.coordinates[0],m=this.tqDataFl[n][l].geometry.coordinates[1];this.tqDataFl[n][l].geometry.coordinates[0]=a*o+i[0],this.tqDataFl[n][l].geometry.coordinates[1]=s*o+i[1];var D=this.tqDataFl[n][l].geometry.coordinates[0]-u,b=this.tqDataFl[n][l].geometry.coordinates[1]-m;if(this.addToLightData(this.tqDataFl[n][l],this.lightData),this.layerGetSource(n,this.tqDataFl[n]),this.layerGetSource("light"+n,this.lightData[n]),this.resetLineData(this.tqDataFl[n][l],this.tqDataFl[n][l].geometry.coordinates,D,b),this.tqDataFl[n][l].properties.hasOwnProperty("parentPole")&&this.tqDataFl[n][l].properties.hasOwnProperty("psrPoledInf")){var x=this.tqDataFl[n][l].properties.psrPoledInf[0].layerId,v=this.tqDataFl[n][l].properties.psrPoledInf[0].dataIndex;this.tqDataFl[x][v].geometry.coordinates[0]=this.tqDataFl[x][v].geometry.coordinates[0]+D,this.tqDataFl[x][v].geometry.coordinates[1]=this.tqDataFl[x][v].geometry.coordinates[1]+b,this.addToLightData(this.tqDataFl[x][v],this.lightData),this.layerGetSource(x,this.tqDataFl[x]),this.layerGetSource("light"+x,this.lightData[x]);var L=this.tqDataFl[x][v].properties.psrPoledInf,I=L.length;if(I>1)for(var P=0;P<I;P++){var F=L[P].layerId,T=L[P].dataIndex;(F!==n||F==n&&T!==l)&&(this.tqDataFl[F][T].geometry.coordinates[0]=this.tqDataFl[F][T].geometry.coordinates[0]+D,this.tqDataFl[F][T].geometry.coordinates[1]=this.tqDataFl[F][T].geometry.coordinates[1]+b,this.addToLightData(this.tqDataFl[F][T],this.lightData),this.layerGetSource(F,this.tqDataFl[F]),this.layerGetSource("light"+F,this.lightData[F])),this.addToLightData(this.tqDataFl[F][T],this.lightData)}}}}this.lightDataToLoadLayer(),this.toolsIndex=0,this.setFbRecord()}else this.$message.warning("无需拉直线路，若需修改成直线可选中该线右击“设置成直线”！")},removeLightTcByMsgHide:function(){var t=this;setTimeout((function(){t.removeLightLayer(),"{}"!==JSON.stringify(t.dianData)&&t.removeLightDian()}),3e3)},batchToEdit:function(){if(!this.plEditVisible){"{}"!==JSON.stringify(this.lightData)&&(this.updateAndRemoveLightLayer(),this.oldTqDataFl=JSON.parse(JSON.stringify(this.tqDataFl))),this.toolsIndex=13,this.plEditVisible=!0,0!==this.marginRightV&&(this.marginRightV=0,this.rtBoxRtVal=-400,this.reInitMap());var t=Object(s["a"])(this.defaultCheckedKeys);t.push("yingxiao"),this.defaultCheckedKeys=t,this.isShowYxEquipment(!0)}},sbplEditConfirm:function(t){var e=this;console.log("批量编辑确认----",JSON.stringify(t)),this.plEditArr=[],this.$nextTick((function(){e.$refs.BatchEditPage.getList()})),this.updateDragBx(),this.toolsIndex=0,this.plEditVisible=!1,400!==this.marginRightV&&(this.rightPanelShow(),this.reInitMap())},sbplEditCancel:function(t){this.recoveryEditData(),this.toolsIndex=0,this.plEditVisible=!t,400!==this.marginRightV&&(this.rightPanelShow(),this.reInitMap())},recoveryEditData:function(){var t=this;this.plEditArr=[],this.isDragEditBx=!1,"{}"!==JSON.stringify(this.lightData)&&(this.clearRightPanelSbInf(),this.removeLightLayer());var e=this.stepCancelData.lightTqData.length;if(e>0){if(e>1)for(var i=0;i<e;i++)this.stepCancelData.lightTqData.splice(i,1),i--,e--;this.resetDragBx()}this.$nextTick((function(){t.$refs.BatchEditPage.getList()}))},addToPlEditData:function(t,e){var i=this;if(console.info("获取大地2000坐标"),console.log("targetVal",t),!t.properties.hasOwnProperty("parentPole")){var r="",a="",s="",o="",n="",l="",h="",p="";if("LineString"==t.geometry.type){var d=t.properties.ofPsrArr;if(0==d[0].onLineIndex){n=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrId;var c=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.name.toString(),g=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrName.toString();l=c+"_"+g}if(0!=d[1].onLineIndex){h=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrId;var y=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.name.toString(),f=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrName.toString();p=y+"_"+f}if(0!=d[0].onLineIndex){h=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrId;var u=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.name.toString(),m=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrName.toString();p=u+"_"+m}if(0==d[1].onLineIndex){n=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrId;var D=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.name.toString(),b=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrName.toString();l=D+"_"+b}}t.properties.hasOwnProperty("psrId")&&(r=t.properties.psrId),t.properties.hasOwnProperty("name")&&(a=t.properties.name),s=t.geometry.coordinates,e&&(o=e);var x={id:t.properties.id,zyId:r,mc:a,layerId:t.properties.psrNo,psrTypeName:t.properties.psrName,onItemIndex:t.properties.dataInTypeIndex,layerType:t.geometry.type,onLightDataIndex:t.properties.onLightDataIndex,sjzb:s,ddzb:o,dldFristPsrId:n,dldFristNameAndType:l,dldEndPsrId:h,dldEndNameAndType:p};this.dataProToCompareArr(x,this.plEditArr,!1,(function(){i.plEditArr.push(x)}))}},addToDjxEditData:function(t,e){var i=this;this.djxEditArr=[];var r="",a="",s="",o="",n="",l="",h="",p="",d=t.properties.ofPsrArr;if(0==d[0].onLineIndex){n=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrId;var c=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.name.toString(),g=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrName.toString();l=c+"_"+g}if(0!=d[1].onLineIndex){h=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrId;var y=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.name.toString(),f=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrName.toString();p=y+"_"+f}if(0!=d[0].onLineIndex){h=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrId;var u=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.name.toString(),m=this.tqDataFl[d[0].layerName][d[0].onTqFlIndex].properties.psrName.toString();p=u+"_"+m}if(0==d[1].onLineIndex){n=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrId;var D=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.name.toString(),b=this.tqDataFl[d[1].layerName][d[1].onTqFlIndex].properties.psrName.toString();l=D+"_"+b}t.properties.hasOwnProperty("psrId")&&(r=t.properties.psrId),t.properties.hasOwnProperty("name")&&(a=t.properties.name),s=t.geometry.coordinates;var x={id:t.properties.id,zyId:r,mc:a,layerId:t.properties.psrNo,psrTypeName:t.properties.psrName,onItemIndex:t.properties.dataInTypeIndex,layerType:t.geometry.type,onLightDataIndex:t.properties.onLightDataIndex,sjzb:s,ddzb:o,dldFristPsrId:n,dldFristNameAndType:l,dldEndPsrId:h,dldEndNameAndType:p};0==e?(this.djxEditArr.push(x),this.$nextTick((function(){i.$refs.SpanLineExport.getList()}))):1==e&&this.djxEditArrAll.push(x)},uploadFileByExcel:function(t){var e=this;console.log("导入的设备为：",t),this.plEditArr=[],"{}"!==JSON.stringify(this.lightData)&&(this.clearRightPanelSbInf(),this.removeLightLayer());for(var i=t.length,r=this.getAllNotLineData(this.tqDataFl),a=r.length,s=this.getAllLineData(this.tqDataFl),o=s.length,n=0,l=0;l<i;l++)for(var h,p=function(){if(!s[d].properties.hasOwnProperty("psrId"))return 0;if(s[d].properties.hasOwnProperty("parentPole"))return 0;var i=s[d].properties.psrId;if(t[l].psrId==i){var r=s[d].properties.psrNo,a=s[d].properties.dataInTypeIndex,o=s[d].geometry.type;e.addToLightData(e.tqDataFl[r][a],e.lightData);for(var n=t[l].zbVal.split(/[;,]/).map(Number),h=[],p=0;p<n.length;p+=2)h.push([n[p],n[p+1]]);console.log("currEditZb",h);var c=new e.gisName.ConvertTask;return c.convertCoord(h,{from:1}).then((function(t){console.log("aaaaaaaaaaaaaaa:---",JSON.stringify(t),t);var s={id:i,layerId:r,onItemIndex:a,layerType:o};e.toChangePsrCoorVal(t,s),e.addToPlEditData(e.tqDataFl[r][a],h)})),1}},d=0;d<o;d++)if(h=p(),0!==h&&1===h)break;for(var c=0;c<i;c++)for(var g,y=function(){if(!r[f].properties.hasOwnProperty("psrId"))return 0;if(r[f].properties.hasOwnProperty("parentPole"))return 0;var i=r[f].properties.psrId;if(t[c].psrId==i){var a=r[f].properties.psrNo,s=r[f].properties.dataInTypeIndex,o=r[f].geometry.type;e.addToLightData(e.tqDataFl[a][s],e.lightData);var l=t[c].zbVal.replace(/\s*/g,"");if(l=l.replace(/，/gi,","),n++,"Polygon"==o){var h=l.split(","),p=h.length;if(p>2){if(10!=p)return n--,0;var d=[[[],[],[],[],[]]];d[0][0].push(Number(h[0])),d[0][0].push(Number(h[1])),d[0][1].push(Number(h[2])),d[0][1].push(Number(h[3])),d[0][2].push(Number(h[4])),d[0][2].push(Number(h[5])),d[0][3].push(Number(h[6])),d[0][3].push(Number(h[7])),d[0][4].push(Number(h[8])),d[0][4].push(Number(h[9])),l=e.getPolygonCenterZb(d).toString(),console.log(l)}}var g=new e.gisName.ConvertTask;return g.convertCoord([[l]],{from:1}).then((function(t){console.log("aaaaaaaaaaaaaaa:---",JSON.stringify(t),t);var r={id:i,layerId:a,onItemIndex:s,layerType:o};e.toChangePsrCoorVal(t[0],r),e.addToPlEditData(e.tqDataFl[a][s],l)})),1}},f=0;f<a;f++)if(g=y(),0!==g&&1===g)break;n>0?this.lightDataToLoadLayer():this.$message.warning("未找到相应的设备！"),this.setFbRecord()},uploadInflectionPointByExcel:function(t){var e=this;console.log("导入的设备为：",t),this.djxEditArr=[],this.removeLightLayer();for(var i=t.length,r=this.getAllLineData(this.tqDataFl),a=r.length,s=0;s<i;s++)for(var o,n=function(){if(!r[l].properties.hasOwnProperty("psrId"))return 0;if(r[l].properties.hasOwnProperty("parentPole"))return 0;var i=r[l].properties.psrId;if(t[s].psrId==i){for(var a=r[l].properties.psrNo,o=r[l].properties.dataInTypeIndex,n=r[l].geometry.type,h=t[s].zbVal.split(/[;,]/).map(Number),p=[],d=0;d<h.length;d+=2)p.push([h[d],h[d+1]]);var c=new e.gisName.ConvertTask;return c.convertCoord(p,{from:1}).then((function(t){var r={id:i,layerId:a,onItemIndex:o,layerType:n};e.toChangeDLDCoorVal(t,r),e.inflectionPointImportVisible=!1})),1}},l=0;l<a;l++)if(o=n(),0!==o&&1===o)break;this.setFbRecord()},beforeunloadHandler:function(t){if(t=t||window.event,t.preventDefault(),this.compareDataToGetChangeData(),this.beChangeData.length>0){window.confirm("确定离开此页面？");var e="离开此页面？";return t&&(t.returnValue=e),e}}},destroyed:function(){var t=this;window.removeEventListener("beforeunload",(function(e){return t.beforeunloadHandler(e)}))},getCurrTime:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),a=t.getHours(),s=t.getMinutes(),o=t.getSeconds();return e+""+i+r+a+s+o}},T=F,q=(i("26d9"),i("9839"),i("2877")),O=Object(q["a"])(T,r,a,!1,null,"66501f68",null);e["default"]=O.exports},"24cf":function(t,e,i){"use strict";i("d504")},"26d9":function(t,e,i){"use strict";i("ae88")},"29d5":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-card",{directives:[{name:"show",rawName:"v-show",value:t.editVisible,expression:"editVisible"}],staticClass:"batchEditBox hasHeaderCard",attrs:{shadow:"always","body-style":{height:"calc(100% - 40px)",position:"relative",padding:"0 0 66px"}}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("h3",{staticClass:"font-16"},[t._v("批量编辑")]),i("div",{staticClass:"editCloseBtn",on:{click:t.plEditCancel}},[i("i",{staticClass:"el-icon-close"})])]),i("div",{staticClass:"batchEditBox-body"},[i("el-row",{staticClass:"margin-b-10"},[i("el-button",{attrs:{type:"primary"},on:{click:t.kxMultiplePsr}},[t._v("框选设备")]),t.listArr.length>0?[i("excel-export",{staticClass:"margin-l-10",attrs:{downloadData:t.listArr},on:{downloadExcel:t.downloadExcel}}),i("excel-import",{attrs:{isBtnDisabled:t.isDrBtnDisabled},on:{uploadFileByExcel:t.uploadFileByExcel}})]:t._e(),t.listArr.length>0?i("el-button",{staticClass:"fr",attrs:{type:"warning"},on:{click:t.clearMultiplePsr}},[t._v("清空")]):t._e()],2),t._l(t.listArr,(function(e,r){return i("el-card",{key:e.id,staticClass:"margin-b-10",attrs:{shadow:"never"}},[i("el-row",[i("span",{staticClass:"pointer",on:{click:function(i){return t.gotoPsrLocation(e)}}},[i("span",[t._v(t._s(e.psrTypeName))]),i("i",{staticClass:"el-icon-location-outline color-30a89e"})]),i("i",{staticClass:"el-icon-delete editRemoveBtn",on:{click:function(i){return t.delThisPsr(e.id,r)}}})]),i("el-form",{ref:"form",refInFor:!0,attrs:{model:e,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"资源ID",prop:"zyId"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"请输入资源ID",disabled:""},model:{value:e.zyId,callback:function(i){t.$set(e,"zyId",i)},expression:"item.zyId"}})],1),i("el-form-item",{attrs:{label:"名称",prop:"mc"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"请输入名称",disabled:""},model:{value:e.mc,callback:function(i){t.$set(e,"mc",i)},expression:"item.mc"}})],1),i("el-form-item",{attrs:{label:"展示坐标(思极)",prop:"sjzb"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"经度,纬度",clearable:""},on:{blur:function(i){return t.sjzbChange(e.sjzb,r,e.layerType)}},model:{value:e.sjzb,callback:function(i){t.$set(e,"sjzb",i)},expression:"item.sjzb"}})],1),i("el-form-item",{attrs:{label:"输入坐标(大地)",prop:"ddzb"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"经度,纬度",clearable:""},on:{blur:function(i){return t.ddzbChange(e.ddzb,r,e.currZbType)}},model:{value:e.ddzb,callback:function(i){t.$set(e,"ddzb",i)},expression:"item.ddzb"}})],1)],1)],1)}))],2),i("div",{staticClass:"batchEditBox-foot"},[i("el-button",{staticStyle:{"margin-right":"10px"},on:{click:t.plEditCancel}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.plEditConfirm}},[t._v("确认")])],1)])},a=[],s=(i("a481"),i("6b54"),i("c5f6"),i("28a5"),i("8cd3")),o=i("c9e0"),n={name:"BatchEditPage",components:{ExcelExport:s["a"],ExcelImport:o["a"]},props:{editVisible:{type:Boolean,default:!1},listArr:{type:Array,default:function(){return[]}},plEditArr:{type:Array,default:function(){return[]}}},data:function(){return{zbTypeOption:[{label:"点",value:"Point"},{label:"线",value:"LineString"},{label:"面",value:"Polygon"}],isHaveExPort:!1,isDrBtnDisabled:!0}},created:function(){this.getList()},methods:{plEditCancel:function(){this.$emit("plEditCancel",this.editVisible)},plEditConfirm:function(){this.$emit("plEditConfirm",this.listArr)},kxMultiplePsr:function(){this.$emit("kxMultiplePsr")},getList:function(){this.listArr=this.plEditArr},sjzbChange:function(t,e,i){if(""!=t){var r=[];if("LineString"==i){for(var a=t.split(/[;,]/).map(Number),s=0;s<a.length;s+=2)r.push([a[s],a[s+1]]);console.log("thisCoorVal",r)}else r=t.split(","),r[0]=Number(r[0]),r[1]=Number(r[1]);this.$parent.toChangePsrCoorVal(r,this.listArr[e])}},ddzbChange:function(t,e,i){var r=this;if(""!=t){var a=new epgis.ConvertTask;if("LineString"==i){for(var s=t.split(/[;,]/).map(Number),o=0;o<s.length;o+=2)thisCoorVal.push([s[o],s[o+1]]);a.convertCoord(newDDzb,{from:1}).then((function(t){r.listArr[e].sjzb=t[0].toString(),r.$parent.toChangePsrCoorVal(t[0],r.listArr[e])}))}else{var n=t.replace(/\s*/g,"");n=n.replace(/，/gi,","),a.convertCoord([[n]],{from:1}).then((function(t){r.listArr[e].sjzb=t[0].toString(),r.$parent.toChangePsrCoorVal(t,r.listArr[e])}))}}},delThisPsr:function(t,e){var i=this,r=this.listArr[e].layerId,a=this.listArr[e].onItemIndex,s=this.listArr[e].onLightDataIndex;if(this.$parent.oldTqDataFl[r][a].properties.id==t){var o=this.$parent.oldTqDataFl[r][a].geometry.coordinates;"Polygon"==this.listArr[e].layerType&&(o=this.$parent.getPolygonCenterZb(o)),o.toString()!==this.listArr[e].sjzb?this.delEditDataConfirm((function(){i.$parent.toChangePsrCoorVal(o,i.listArr[e]),i.removeOnListData(e,r,a,s)})):this.removeOnListData(e,r,a,s)}},removeOnListData:function(t,e,i,r){this.listArr.splice(t,1),this.$parent.tqDataFl[e][i].properties.customOpacity=1,this.$parent.tqDataFl[e][i].properties.customLightOpacity=0,this.$parent.lightData[e].splice(r,1),this.$parent.layerGetSource(e,this.$parent.tqDataFl[e]),this.$parent.layerGetSource("light"+e,this.$parent.lightData[e])},clearMultiplePsr:function(){var t=this,e=this.$parent.stepCancelData.lightTqData.length;e>0?this.delEditDataConfirm((function(){t.$parent.recoveryEditData()})):(this.$parent.plEditArr=[],this.$parent.removeLightLayer(),this.listArr=[])},delEditDataConfirm:function(t,e){this.$confirm("编辑过的数据将被还原，是否继续?","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t&&t()})).catch((function(){e&&e()}))},gotoPsrLocation:function(t){var e=[];if(console.log("item",t),"dianLine"==t.layerId){e=t.sjzb.toString().split(",");var i=[];i.push(e[0]),i.push(e[1]),this.$parent.map.setCenter(i)}else e=t.sjzb.toString().split(","),this.$parent.map.setCenter(e)},uploadFileByExcel:function(t,e){this.$emit("uploadFileByExcel",t)},downloadExcel:function(t){"模板"==t?console.log("导出模板"):this.isDrBtnDisabled=!1}}},l=n,h=(i("abdc"),i("2877")),p=Object(h["a"])(l,r,a,!1,null,"725e6da0",null);e["a"]=p.exports},3:function(t,e){},3740:function(t,e,i){"use strict";i("555e")},"48dd":function(t,e){t.exports='(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob(["\\uFEFF",a],{type:a.type}):a}function c(b,c,d){var e=new XMLHttpRequest;e.open("GET",b),e.responseType="blob",e.onload=function(){a(e.response,c,d)},e.onerror=function(){console.error("could not download file")},e.send()}function d(a){var b=new XMLHttpRequest;return b.open("HEAD",a,!1),b.send(),200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(a,b,d,e){if(e=e||open("","_blank"),e&&(e.document.title=e.document.body.innerText="downloading..."),"string"==typeof a)return c(a,b,d);var g="application/octet-stream"===a.type,h=/constructor/i.test(f.HTMLElement)||f.safari,i=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((i||g&&h)&&"object"==typeof FileReader){var j=new FileReader;j.onloadend=function(){var a=j.result;a=i?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),e?e.location.href=a:location=a,e=null},j.readAsDataURL(a)}else{var k=f.URL||f.webkitURL,l=k.createObjectURL(a);e?e.location=l:location.href=l,e=null,setTimeout(function(){k.revokeObjectURL(l)},4E4)}});f.saveAs=a.saveAs=a,"undefined"!=typeof module&&(module.exports=a)});\n\n//# sourceMappingURL=FileSaver.min.js.map'},"4ad8":function(t,e,i){},"555e":function(t,e,i){},"5aa2":function(t,e,i){},"6c31":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rightPanelPage box",style:{right:t.rtBoxRtVal+"px"}},[i("div",{staticClass:"box_header"}),i("div",{staticClass:"box_body"},[i("el-row",{staticClass:"txt-rt margin-b-10"},[i("el-button",{staticClass:"downloadFileButton",attrs:{type:"primary",disabled:t.isCome},on:{click:t.downloadFileInfo}},[t._v("图纸异常导出")]),i("div",{staticClass:"uploadFileBox"},[i("input",{staticClass:"uploadFileInput",attrs:{type:"file",accept:".txt, .json",placeholder:"上传文件"},on:{change:function(e){return t.uploadFile(e)}}}),i("el-button",{attrs:{type:"primary"}},[t._v("导入数据")])],1),i("el-button",{attrs:{type:"primary",disabled:t.isRead},on:{click:t.gisSave}},[t._v("图形发布")])],1),t.fdfxTableData.length>0?i("el-row",[i("e-table",{ref:"fdfxTable",attrs:{columns:t.fdfxColumns,customTableHeight:200,data:t.fdfxTableData,listLoading:t.fdfxTableLoading,pages:t.pages,showIndex:""},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}})],1):t._e(),i("el-row",[i("el-card",{staticClass:"hasHeaderCard",attrs:{shadow:"never"}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("h3",{staticClass:"font-16"},[t._v("设备属性")])]),[i("bx-detail",{attrs:{bxForm:t.rightBxForm,canEdit:t.rtBoxCanEdit},on:{setBxAngle:t.setBxAngle,editCurrPsr:t.editCurrPsr,updateCurrPsr:t.updateCurrPsr,changeZbType:t.changeCurrZbType}})]],2)],1)],1),i("div",{staticClass:"boxSide",on:{mousedown:t.sidebarLs}}),i("div",{staticClass:"switchBox"},[i("div",{staticClass:"switchBox-btn",on:{click:t.toggleRightSideBar}},[i("i",{class:0==t.rtBoxRtVal?"el-icon-caret-right":"el-icon-caret-left"})])])])},a=[],s=(i("6762"),i("2fdb"),i("28a5"),i("7f7f"),i("c5f6"),i("f773")),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-container"},[i("el-form",{ref:"form",attrs:{model:t.bxForm,rules:t.rules,"label-width":"120px"}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"设备ID",prop:"sbId"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"请输入设备ID",clearable:"",disabled:!0},model:{value:t.bxForm.sbId,callback:function(e){t.$set(t.bxForm,"sbId",e)},expression:"bxForm.sbId"}})],1)],1),i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"资源ID",prop:"zcbh"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"请输入资源ID",clearable:"",disabled:!0},model:{value:t.bxForm.zcbh,callback:function(e){t.$set(t.bxForm,"zcbh",e)},expression:"bxForm.zcbh"}})],1)],1),i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"名称",prop:"mc"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"请输入名称",clearable:"",disabled:!0},model:{value:t.bxForm.mc,callback:function(e){t.$set(t.bxForm,"mc",e)},expression:"bxForm.mc"}})],1)],1)],1),i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"坐标切换"}},[i("el-radio-group",{on:{change:t.changeZbType},model:{value:t.bxForm.zbType,callback:function(e){t.$set(t.bxForm,"zbType",e)},expression:"bxForm.zbType"}},[i("el-radio",{attrs:{label:"1"}},[t._v("思极")]),i("el-radio",{attrs:{label:"2"}},[t._v("大地2000")])],1)],1)],1),"1"==t.bxForm.zbType?i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"Polygon"!==t.bxForm.layerType?"思极坐标":"中心点坐标",prop:"wz"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"经度,纬度",clearable:"",disabled:!t.canEdit},model:{value:t.bxForm.wz,callback:function(e){t.$set(t.bxForm,"wz",e)},expression:"bxForm.wz"}})],1)],1):t._e(),"2"==t.bxForm.zbType?i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"Polygon"!==t.bxForm.layerType?"大地2000坐标":"中心点坐标",prop:"ddzb"}},[i("el-input",{staticClass:"filter-item",attrs:{placeholder:"经度,纬度",clearable:"",disabled:!t.canEdit},model:{value:t.bxForm.ddzb,callback:function(e){t.$set(t.bxForm,"ddzb",e)},expression:"bxForm.ddzb"}})],1)],1):t._e(),i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"角度",prop:"jiaodu"}},[i("el-input",{staticClass:"filter-item",attrs:{type:"number",placeholder:"请输入角度",clearable:"",disabled:!0},on:{input:t.setBxAngle},model:{value:t.jiaodu,callback:function(e){t.jiaodu=e},expression:"jiaodu"}})],1)],1)],1),i("el-row",{staticClass:"txt-center"},[t.canEdit||""===t.bxForm.zcbh||"LineString"===t.bxForm.layerType?t._e():i("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.editCurrPsr}},[t._v("坐标编辑")]),t.canEdit&&""!==t.bxForm.zcbh&&"LineString"!==t.bxForm.layerType?i("el-button",{attrs:{type:"primary"},on:{click:t.updateCurrPsr}},[t._v("完成")]):t._e()],1)],1)],1)},n=[],l=i("3835"),h={name:"BxDetail",props:{bxForm:{type:Object},canEdit:{type:Boolean,default:!1},isRead:{type:Boolean,default:!1}},computed:{zcbh:function(){return this.bxForm.zcbh}},watch:{zcbh:function(t){this.jiaodu=this.bxForm.oldAngle}},data:function(){var t=function(t,e,i){if(e){var r=e.split(",");2!=r.length&&i(new Error("请输入正确的经纬度格式"));var a=Object(l["a"])(r,2),s=a[0],o=a[1],n=parseFloat(s.trim()),h=parseFloat(o.trim());if(isNaN(n))return void i(new Error("经度必须为数字"));if(isNaN(h))return void i(new Error("纬度必须为数字"));if(n<-180||n>180)return void i(new Error("经度范围在-180到180"));if(h<-90||h>90)return void i(new Error("纬度范围在-90到90"));i()}else i()};return{rules:{wz:[{validator:t,trigger:"blur"}],ddzb:[{validator:t,trigger:"blur"}]},jrdmcOptions:[],pbmcOptions:[],jiaodu:this.bxForm.oldAngle,oldZcbh:""}},methods:{setBxAngle:function(){this.$emit("setBxAngle",this.jiaodu)},editCurrPsr:function(){this.$emit("editCurrPsr")},updateCurrPsr:function(){var t=this;this.$refs.form.validate((function(e){e?t.$emit("updateCurrPsr"):t.$message.error("校验未通过！")}))},changeZbType:function(t){this.$emit("changeZbType",t)}}},p=h,d=(i("be0e"),i("2877")),c=Object(d["a"])(p,o,n,!1,null,"7957d108",null),g=c.exports,y=i("a93d"),f={name:"RightPanel",components:{ETable:s["a"],BxDetail:g},props:{rtBoxRtVal:{type:Number,default:0},isCome:{type:Boolean,default:!0},isRead:{type:Boolean,default:!1},rightBxForm:{type:Object},rtBoxCanEdit:{type:Boolean,default:!1},fdfxTableData:{type:Array,default:function(){return[]}}},data:function(){return{fdfxColumns:[],fdfxTableLoading:!1,pages:{page:1,limit:20,total:0}}},methods:{setBxAngle:function(t){this.$emit("bxAngleReset",t)},downloadFileInfo:function(){this.$emit("downloadFileInfo")},gisSave:function(){this.$emit("gisSave")},uploadFile:function(t){var e=t.target.files[0];if(void 0!==e){var i=e.name,r=i.split(".").pop().toLowerCase();if("txt"===r||"json"===r){var a=new FileReader,s=this;a.readAsText(e),a.onload=function(t){t.target.result.includes("features")&&JSON.parse(t.target.result).features.length>0?s.$emit("uploadFile",t.target.result):s.$message.warning("当前选择的文件不包含坐标数据！请重新选择文件")}}else this.$message.warning("请选择对应的txt或者json为后缀的文件进行导入！")}},handleSizeChange:function(t){console.log("页码：",t)},handleCurrentChange:function(t){console.log("当前页码：",t)},queryFdFx:function(){this.$emit("queryFdFx")},editCurrPsr:function(){this.$emit("editThisPsr")},updateCurrPsr:function(){this.$emit("updateThisPsr")},changeCurrZbType:function(t){this.$emit("changeCurrZbType",t)},sidebarLs:function(t){var e=this;Object(y["a"])(t,{type:"reverse",minWid:340},(function(t){e.$parent.setRightSideParams(t),console.log("右边栏宽度----",t)}))},toggleRightSideBar:function(){this.$emit("toggleRightSideBar")}}},u=f,m=(i("06ff"),Object(d["a"])(u,r,a,!1,null,"34191319",null));e["a"]=m.exports},"76a6":function(t,e){function i(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i.keys=function(){return[]},i.resolve=i,t.exports=i,i.id="76a6"},8506:function(t,e,i){},"874b":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"box",style:{left:t.ltBoxLtVal+"px"}},[i("p",{staticClass:"box_header"},[t._v("电网设备图形维护")]),i("el-input",{attrs:{placeholder:"输入关键字搜索"},on:{input:t.onSearch},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),i("div",{staticClass:"boxTree"},[i("el-tree",{ref:"leftTree",attrs:{data:t.sbtxTree,"node-key":"id",accordion:"","highlight-current":"","default-expanded-keys":t.expandedKeys,"filter-node-method":t.filterNodeLtTree},on:{"node-click":t.handleNodeClick},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.node,a=e.data;return i("span",{staticClass:"custom-tree-node"},[!a.hasOwnProperty("svgClass")||""===a.svgClass?t._e():i("svg-icon",{class:a.type,attrs:{"icon-class":a.svgClass}}),i("span",{attrs:{title:r.label}},[t._v(t._s(r.label))])],1)}}])})],1),i("div",{staticClass:"boxSide",on:{mousedown:t.sidebarLs}}),i("div",{staticClass:"switchBox"},[i("div",{staticClass:"switchBox-btn",on:{click:t.toggleLeftSideBar}},[i("i",{class:0==t.ltBoxLtVal?"el-icon-caret-left":"el-icon-caret-right"})])])],1)},a=[],s=i("b85c"),o=(i("6762"),i("2fdb"),i("ac6a"),i("c5f6"),i("a93d")),n={name:"LeftPanel",props:{ltBoxLtVal:{type:Number,default:0},leftTreeData:{type:Array,default:function(){return[]}},filterText:{type:String,default:""}},watch:{filterText:function(t){this.$refs.leftTree.filter(t)}},data:function(){return{sbtxTree:JSON.parse(JSON.stringify(this.leftTreeData)),expandedKeys:[1],searchText:""}},methods:{updateTreeChildren:function(t,e){this.$refs.leftTree.updateKeyChildren(t,e)},handleNodeClick:function(t){this.$emit("handleNodeClick",t)},onSearch:function(){var t=this;this.sbtxTree=JSON.parse(JSON.stringify(this.sbtxTree)),this.expandedKeys=[1],this.removeMenuBackColor(),this.searchText&&this.searchText.trim()&&(this.sbtxTree[0].children.forEach((function(e){return t.filterMenu(e)})),this.setMenuBackColor("yellow"))},filterMenu:function(t){var e=this;t.label.includes(this.searchText)&&!this.expandedKeys.includes(t.id)&&this.expandedKeys.push(t.id),t.children&&t.children.length&&t.children.forEach((function(t){return e.filterMenu(t)}))},setMenuBackColor:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"yellow";this.$nextTick((function(){var i,r=document.querySelectorAll("span[class='custom-tree-node'] span"),a=Object(s["a"])(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.innerText.includes(t.searchText.trim())&&(o.style.backgroundColor=e)}}catch(n){a.e(n)}finally{a.f()}}))},removeMenuBackColor:function(){this.$nextTick((function(){var t,e=document.querySelectorAll("span[class='custom-tree-node'] span"),i=Object(s["a"])(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.removeAttribute("style")}}catch(a){i.e(a)}finally{i.f()}}))},filterNodeLtTree:function(t,e,i){return""==t||-1==e.label.indexOf(t)},packUpTreeNode:function(){var t=this;this.$nextTick((function(){for(var e=0;e<t.$refs.leftTree.store._getAllNodes().length;e++)1!==t.$refs.leftTree.store._getAllNodes()[e].data.id&&(t.$refs.leftTree.store._getAllNodes()[e].expanded=!1)}))},sidebarLs:function(t){var e=this;Object(o["a"])(t,{type:"normal"},(function(t){e.$parent.setLeftSideParams(t)}))},toggleLeftSideBar:function(){this.$emit("toggleLeftSideBar")}}},l=n,h=(i("24cf"),i("2877")),p=Object(h["a"])(l,r,a,!1,null,"322c7117",null);e["a"]=p.exports},"8cd3":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uploadFileBox"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.templateDownLoad(t.downloadData)}}},[t._v(t._s(t.downloadData.length>0?"导出":"模板导出"))])],1)},a=[],s=i("c7eb"),o=(i("6b54"),i("96cf"),i("1da1")),n=i("cd77"),l=i("18e3"),h={name:"ExcelExport",props:{downloadData:{type:Array,default:function(){return[]}}},methods:{templateDownLoad:function(){var t=Object(o["a"])(Object(s["a"])().mark((function t(e){var i,r,a,o,h,p,d,c;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=[],r="模板",console.log("xzData",e),!(e.length>0)){t.next=11;break}return t.next=5,Object(l["r"])(JSON.stringify(e));case 5:for(a=t.sent,o=0;o<a.data.length;o++)"LineString"==a.data[o].layerType?(h=a.data[o].ddzb,p=h.join(";"),a.data[o].ddzb=p):"Polygon"==a.data[o].layerType&&(d=this.getPolygonCenterZb(a.data[o].ddzb),a.data[o].ddzb=d);i=a.data.map((function(t){return{"资源ID":t.zyId,"设备类型":t.psrTypeName,"设备名称":t.mc,"只支持大地2000坐标(x,y;x,y;x,y)":t.ddzb.toString(),"电缆段起点资源ID":t.dldFristPsrId,"电缆段起点设备名称_类型":t.dldFristNameAndType,"电缆段终点资源ID":t.dldEndPsrId,"电缆段终点设备名称_类型":t.dldEndNameAndType}})),r="批量编辑设备"+this.getCurrTime(),t.next=12;break;case 11:i=[{"设备类型":"杆塔","设备名称":"樱花12线11","资源ID":"14000456132124","经纬度":"119.864409998059,31.8097580000758","电缆段起点资源ID":"","电缆段起点设备名称_类型":"","电缆段终点资源ID":"","电缆段终点设备名称_类型":""},{"设备类型":"杆塔","设备名称":"合欢121线12","资源ID":"14000456132126","经纬度":"119.864258997142,31.8094649985433","电缆段起点资源ID":"","电缆段起点设备名称_类型":"","电缆段终点资源ID":"","电缆段终点设备名称_类型":""}];case 12:c=[{wpx:120},{wpx:140},{wpx:180},{wpx:260},{wpx:260},{wpx:260},{wpx:260},{wpx:260}],n["a"].exportExcel(i,r,c),this.$emit("downloadExcel",r);case 15:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleXzData:function(){var t=Object(o["a"])(Object(s["a"])().mark((function t(e){var i,r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["r"])(JSON.stringify(e));case 2:i=t.sent,r=[],r=i.data.map((function(t){return{"资源ID":t.zyId,"设备类型":t.psrTypeName,"设备名称":t.mc,"经纬度(x,y),只支持大地2000坐标":t.ddzb.toString(),"电缆段起点资源ID":"","电缆段起点设备名称_类型":"","电缆段终点资源ID":"","电缆段终点设备名称_类型":""}})),console.log("mbData",r);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getCurrTime:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),a=t.getHours(),s=t.getMinutes(),o=t.getSeconds();return e+""+i+r+a+s+o},getPolygonCenterZb:function(t){var e=(t[0][1][0]-t[0][0][0])/2+t[0][0][0],i=(t[0][1][1]-t[0][2][1])/2+t[0][2][1];return[e,i]}}},p=h,d=(i("a398"),i("2877")),c=Object(d["a"])(p,r,a,!1,null,"5f226302",null);e["a"]=c.exports},"8e9b":function(t,e,i){},9839:function(t,e,i){"use strict";i("8506")},"9ab1":function(t,e,i){"use strict";i("a785")},"9e28":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-card",{directives:[{name:"show",rawName:"v-show",value:t.ycsbDistinguishVisible,expression:"ycsbDistinguishVisible"}],staticClass:"ycsbDistinguishBox hasHeaderCard",attrs:{shadow:"always","body-style":{height:"calc(100% - -23px)",position:"relative",padding:"0 0 66px"}}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("h3",{staticClass:"font-16"},[t._v("异常设备列表")]),i("div",{staticClass:"editCloseBtn",on:{click:t.plEditCancel}},[i("i",{staticClass:"el-icon-close"})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:21==t.ycsbToolsType,expression:"ycsbToolsType == 21"}],staticStyle:{"border-bottom":"rgb(146, 145, 145) solid 1px","border-bottom-width":"thick"}},[i("el-button",{staticStyle:{"margin-bottom":"8px","margin-left":"10px","margin-top":"8px"},attrs:{type:"primary"},on:{click:t.tqLocationDevice}},[i("i",{staticClass:"el-icon-location-outline"}),t._v(" 台区定位 ")]),i("el-button",{staticStyle:{"margin-bottom":"8px","margin-left":"15px","margin-top":"8px"},attrs:{type:"warning"},on:{click:function(e){return t.jlxPullBack(null,1)}}},[t._v("表箱召回")]),i("el-button",{staticStyle:{"margin-bottom":"8px","margin-left":"15px","margin-top":"8px"},attrs:{type:"warning"},on:{click:function(e){return t.jlxPullBack(null,2)}}},[t._v("台区召回")])],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.show,expression:"show"}],staticClass:"ycsbDistinguishBox-body"},[t._l(t.equipList,(function(e,r){return i("div",{key:r,staticClass:"equipList itemMag"},[i("div",{staticClass:"dsfx"},[i("i",{staticClass:"el-icon-location-outline color-30a89e curP",staticStyle:{"margin-top":"6px"},on:{click:function(i){return t.locationDevice(e)}}}),i("div",{staticClass:"nameLeft"},[t._v(t._s(t.itemNameOne))]),i("input",{staticStyle:{width:"150px","margin-top":"-4px","font-size":"10px"},attrs:{disabled:!0},domProps:{value:21==t.ycsbToolsType?e.properties.custName:e.properties.gtname?e.properties.gtname:e.properties.name}}),i("el-button",{directives:[{name:"show",rawName:"v-show",value:21==t.ycsbToolsType,expression:"ycsbToolsType == 21"}],staticClass:"buttonItem",attrs:{type:"primary"},on:{click:function(i){return t.jlxPullBack(e)}}},[t._v("表箱召回")])],1),i("div",{staticClass:"idItem dsfx itemMag"},[i("div",{staticClass:"idLeft"},[t._v(t._s(t.itemNameTwo))]),i("input",{staticStyle:{width:"150px","margin-top":"-2px","margin-bottom":"-10px","font-size":"10px"},style:{"margin-right":21==t.ycsbToolsType?"90px":"66px"},attrs:{disabled:!0},domProps:{value:21==t.ycsbToolsType?e.properties.ecAddr:e.properties.psrId}})]),i("div",{staticClass:"dsfx itemMag"},[i("div",{staticClass:"beforeIcon2"}),i("div",{staticClass:"leftItem"},[t._v("思极坐标：")]),i("div",{staticClass:"XItem"},[t._v(" X:"+t._s(e.geometry.coordinates[0].toFixed(8))+" ")]),i("div",{staticClass:"YItem"},[t._v(" Y:"+t._s(e.geometry.coordinates[1].toFixed(8))+" ")])]),e.geometry.ddcoordinates?i("div",{staticClass:"dsfx itemMag"},[i("div",{staticClass:"beforeIcon"}),i("div",{staticClass:"leftItem"},[t._v("大地坐标：")]),i("div",{staticClass:"XItem"},[t._v(" X:"+t._s(e.geometry.ddcoordinates[0].toFixed(8))+" ")]),i("div",{staticClass:"YItem"},[t._v(" Y:"+t._s(e.geometry.ddcoordinates[1].toFixed(8))+" ")])]):t._e()])})),i("div",{directives:[{name:"show",rawName:"v-show",value:0==t.equipList.length,expression:"equipList.length == 0"}],staticStyle:{"margin-left":"118px","font-size":"20px","margin-top":"20px"}},[t._v(" 暂无异常数据!!! ")])],2)])},a=[],s=(i("c5f6"),i("8cd3")),o=i("c9e0"),n=i("18e3"),l={name:"YcsbDistinguish",components:{ExcelExport:s["a"],ExcelImport:o["a"]},props:{ycsbDistinguishVisible:{type:Boolean,default:!1},ycsbToolsType:{type:Number,default:0},listArr:{type:Array,default:function(){return[]}},sgYxsbArr:{type:Array,default:function(){return[]}},bounds:{type:Array,default:function(){return[]}},lineType:{type:String,default:function(){return""}}},data:function(){return{equipList:[],zbTypeOption:[{label:"点",value:"Point"},{label:"线",value:"LineString"},{label:"面",value:"Polygon"}],itemNameOne:"",itemNameTwo:"",show:!0}},created:function(){this.getList()},methods:{getList:function(){var t=this;this.show=!0,20==this.ycsbToolsType?(this.equipList=[],this.itemNameOne="设备名称：",this.itemNameTwo="设备ID：",Object(n["i"])(JSON.stringify(this.sgYxsbArr),this.bounds,this.lineType).then((function(e){t.equipList=e.data.features,t.show=!1}))):21==this.ycsbToolsType&&(this.itemNameOne="用户名称：",this.itemNameTwo="用户地址：",this.equipList=this.sgYxsbArr,this.show=!1),console.log("------------------------异常列表",this.equipList)},plEditCancel:function(){this.$emit("ycsbDistinguishCancel",this.ycsbDistinguishVisible)},jlxPullBack:function(t,e){var i=this;this.locationDevice(t,1),this.$emit("jlxPullBack",t,e),this.equipList.map((function(e,r){t.properties.psrId==e.properties.psrId&&i.equipList.splice(r,1)}))},locationDevice:function(t,e){21==this.ycsbToolsType&&t&&this.$parent.isShowYxEquipment(!0),e||this.$emit("aiDistinguishLocation",t)},tqLocationDevice:function(){this.$parent.map.easeTo({center:this.bounds,zoom:16.5}),this.$emit("jlxLocate")}}},h=l,p=(i("18d8"),i("2877")),d=Object(p["a"])(h,r,a,!1,null,"7a6c7987",null);e["a"]=d.exports},"9fd2":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mapStyleBox"},[i("div",{staticClass:"mapStyleBox-curr",style:{backgroundImage:"url("+t.currStyle.backImg+")"}},[i("p",[t._v(t._s(t.currStyle.name))])]),i("ul",{staticClass:"map-stylesList"},t._l(t.mapStyleList,(function(e,r){return i("li",{key:r,class:e.active&&"active-style",style:{backgroundImage:"url("+e.backImg+")"},on:{click:function(i){return t.setMapStyle(e)}}},[i("div",[t._v(t._s(e.name))])])})),0)])},a=[],s=(i("7f7f"),i("ac6a"),{data:function(){return{mapStyleList:[{name:"街道图",style:"aegis://styles/aegis/Streets",backImg:i("6135"),active:!0},{name:"影像图",style:"aegis://styles/aegis/Satellite512",backImg:i("ad89"),active:!1},{name:"夜景图",style:"aegis://styles/aegis/StreetsDark",backImg:i("1574"),active:!1},{name:"路网图",style:"aegis://styles/aegis/Road",backImg:i("ecac"),active:!1}],currStyle:{name:"街道图",style:"aegis://styles/aegis/Streets",backImg:i("6135"),active:!0}}},methods:{setMapStyle:function(t){var e=this;t.active||(this.mapStyleList.forEach((function(i){i.name===t.name?(i.active=!0,e.currStyle=i):i.active=!1})),this.$emit("changeMapStyle",t.style))}}}),o=s,n=(i("ee62"),i("2877")),l=Object(n["a"])(o,r,a,!1,null,"2b791dd8",null);e["a"]=l.exports},a398:function(t,e,i){"use strict";i("8e9b")},a785:function(t,e,i){},a80d:function(t,e,i){},abdc:function(t,e,i){"use strict";i("afd9")},ae88:function(t,e,i){},afd9:function(t,e,i){},be0e:function(t,e,i){"use strict";i("4ad8")},c0de:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uploadFileBox"},[i("input",{ref:"fileInput",staticClass:"uploadFileInput",attrs:{type:"file",accept:".xlsx, .xls",placeholder:"批量导入坐标",disabled:t.isBtnDisabled},on:{change:function(e){return t.uploadExcelFile(e)}}}),i("el-button",{staticClass:"uploadFileBtn",attrs:{type:"primary",disabled:t.isBtnDisabled}},[t._v("导入")])],1)},a=[],s=i("cd77"),o={name:"SpanLineImport",props:{isBtnDisabled:{type:Boolean,default:!1},uploadData:{type:Array,default:function(){return[]}}},data:function(){return{excelData:[],psrIdIndex:null,idIndex:null,zbIndex:null,dataArr:[],idbData:null}},methods:{uploadExcelFile:function(t){var e=this,i=t.target.files;i&&i[0]&&s["a"].readExcelFile(i[0],(function(t,i){e.multiplePsrData=[],e.psrIdIndex=null,e.zbIndex=null,e.excelData=t,e.toGetDataIndex()}))},toGetDataIndex:function(){for(var t=this.excelData[0],e=t.length,i=0;i<e;i++)"资源ID"==t[i]&&(this.psrIdIndex=i),"只支持大地2000坐标(x,y;x,y;x,y)"==t[i]&&(this.zbIndex=i);this.getExcelDataToJson()},getExcelDataToJson:function(){if(null!=this.psrIdIndex&&null!=this.zbIndex){var t=this.excelData.length;if(t>1){for(var e=!1,i=1;i<t;i++){var r={psrId:this.excelData[i][this.psrIdIndex],zbVal:this.excelData[i][this.zbIndex].trim()};if(this.multiplePsrData.push(r),""==this.excelData[i][this.zbIndex]||void 0===this.excelData[i][this.zbIndex]){e=!0;break}}if(console.log("scsj-------------",JSON.stringify(this.multiplePsrData)),e)return this.$refs.fileInput.value="",void this.$message.warning("坐标不能为空，请检查并填写完整！");this.$emit("uploadInflectionPointByExcel",this.multiplePsrData)}}else this.$message.warning("文件数据格式不正确！")}}},n=o,l=(i("9ab1"),i("2877")),h=Object(l["a"])(n,r,a,!1,null,"17d08a23",null);e["a"]=h.exports},c9e0:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uploadFileBox"},[i("input",{ref:"fileInput",staticClass:"uploadFileInput",attrs:{type:"file",accept:".xlsx, .xls",placeholder:"批量导入坐标",disabled:t.isBtnDisabled},on:{change:function(e){return t.uploadExcelFile(e)}}}),i("el-button",{staticClass:"uploadFileBtn",attrs:{type:"primary",disabled:t.isBtnDisabled}},[t._v("导入")])],1)},a=[],s=i("cd77"),o={name:"ExcelImport",props:{isBtnDisabled:{type:Boolean,default:!1}},data:function(){return{excelData:[],multiplePsrData:[],psrIdIndex:null,zbIndex:null}},methods:{uploadExcelFile:function(t){var e=this,i=t.target.files;i&&i[0]&&s["a"].readExcelFile(i[0],(function(t,i){e.multiplePsrData=[],e.psrIdIndex=null,e.zbIndex=null,e.excelData=t,e.toGetDataIndex()}))},toGetDataIndex:function(){console.info("1111111111111111111");for(var t=this.excelData[0],e=t.length,i=0;i<e;i++)"资源ID"==t[i]&&(this.psrIdIndex=i),"只支持大地2000坐标(x,y;x,y;x,y)"==t[i]&&(this.zbIndex=i);this.getExcelDataToJson()},getExcelDataToJson:function(){if(null!=this.psrIdIndex&&null!=this.zbIndex){var t=this.excelData.length;if(t>1){for(var e=!1,i=1;i<t;i++){var r={psrId:this.excelData[i][this.psrIdIndex],zbVal:this.excelData[i][this.zbIndex].trim()};if(this.multiplePsrData.push(r),""==this.excelData[i][this.zbIndex]||void 0===this.excelData[i][this.zbIndex]){e=!0;break}}if(console.log("scsj-------------",JSON.stringify(this.multiplePsrData)),e)return this.$refs.fileInput.value="",void this.$message.warning("坐标不能为空，请检查并填写完整！");this.$emit("uploadFileByExcel",this.multiplePsrData)}}else this.$message.warning("文件数据格式不正确！")}}},n=o,l=(i("009c"),i("2877")),h=Object(l["a"])(n,r,a,!1,null,"37503b79",null);e["a"]=h.exports},ca3d:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"800px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticStyle:{height:"500px"}},[i("div",{staticStyle:{margin:"20px"}},[t.isSave?t._e():i("span",{staticStyle:{color:"red"}},[t._v("本次治理对【对侧线路】以下设备造成了飞线问题，请按照实际位置进行治理！")]),t.isSave?i("span",{staticStyle:{color:"red"}},[t._v("本次治理对【对侧线路】以下设备造成了飞线问题，")]):t._e(),t.isSave?i("span",[i("span",[t._v(" 是否继续发布？ ")]),i("el-button",{attrs:{type:"primary"},on:{click:t.handleSave}},[t._v(" 确认发布 ")])],1):t._e()]),i("el-table",{staticStyle:{width:"100%"},attrs:{height:"450",data:t.tableData}},[i("el-table-column",{attrs:{align:"center",prop:"psrId",label:"线路资源ID"}}),i("el-table-column",{attrs:{align:"center",prop:"fxPsrId",label:"飞线设备ID"}}),i("el-table-column",{attrs:{align:"center",prop:"fxName",label:"飞线设备名称"}}),i("el-table-column",{attrs:{align:"center",prop:"fxType",label:"飞线设备类型"}})],1)],1)])},a=[],s=i("2909"),o=(i("7f7f"),i("1115")),n=i("18e3"),l={props:{childTableData:{type:Array,default:function(){return[]}},isSave:{type:Boolean,default:!1}},data:function(){return{currentPage4:4,dialogVisible:!1,tableData:[]}},methods:{handleClose:function(){this.$emit("tableClose",!0)},handleSizeChange:function(){this.tableData=[],this.$emit("tableClose",!0)},handleSave:function(){this.$emit("dialogTxfbQrBtn")},handleClick:function(t){var e=this,i=window.document.location.pathname,r=i.substring(0,i.substr(1).indexOf("/")+1),a=this.$parent.isYxyh;if(console.log(t),console.log("是否营销",a),a){var s="isYxyh="+a+"&psrId="+t.psrId+"&psrType="+t.psrType+"&lineType="+t.type+"&sbmc="+encodeURI(t.name);window.open(r+"/#/equipManage?"+Object(o["b"])(s))}else Object(n["q"])(t.psrId,t.type).then((function(i){var a=JSON.parse(i.data);if(a)e.$message.warning("该图纸已被锁定,请在客户端完成对应图模信息维护后,再进行坐标治理！");else{var s="psrId="+t.psrId+"&psrType="+t.psrType+"&lineType="+t.type+"&sbmc="+encodeURI(t.name);window.open(r+"/#/equipManage?"+Object(o["b"])(s))}}))}},created:function(){this.tableData=Object(s["a"])(this.childTableData),this.dialogVisible=!0}},h=l,p=i("2877"),d=Object(p["a"])(h,r,a,!1,null,null,null);e["a"]=d.exports},d504:function(t,e,i){},ee62:function(t,e,i){"use strict";i("5aa2")},f2b5:function(t,e){t.exports=function(t){function e(t){"undefined"!==typeof console&&(console.error||console.log)("[Script Loader]",t)}function i(){return"undefined"!==typeof attachEvent&&"undefined"===typeof addEventListener}try{"undefined"!==typeof execScript&&i()?execScript(t):"undefined"!==typeof eval?eval.call(null,t):e("EvalError: No eval function available")}catch(r){e(r)}}}}]);